
<!DOCTYPE html>
<html lang="zh" data-figures="" class="page" data-mode="lit">
  <head>
<title>Learn Assembly Language æ±‡ç¼–è¯­è¨€å­¦ä¹ (æ‹™è¯‘) | Looper çš„åšå®¢</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-175169252-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-175169252-1');
</script>

<meta property="og:locale" content="zh" />

<meta property="og:type" content="article">
<meta name="description" content="Index-0 åŸå€ï¼šhttps://asmtutor.com/ ç¯å¢ƒï¼šnasm on x64 linux
TL;DR  åŠ¨æœºï¼šç¨‹åºå‘˜â€”â€”å¤šæŒæ¡å‡ é—¨è®¡ç®—æœºè¯­è¨€ï¼Œè¿˜æ˜¯æœ‰å¥½å¤„çš„ ä¸»é¢˜ï¼šæ±‡ç¼–è¯­è¨€â€”â€”æœ‰å…¶ä¸å¯æ›¿ä»£çš„ä½œç”¨ å‘ˆç¤ºï¼šå¤©ä¸‹è¯­è¨€é€¾åƒâ€”â€”æ±‡ç¼–ç¬‘çœ‹æ²‰èˆŸä¾§ç•” å±•å¼€ï¼šæ¬²çŸ¥ç¨‹åºçœŸç›¸â€”â€”åç¼–è¯‘éš¾ï¼Œåæ±‡ç¼–æ˜“ å†ç°ï¼šå¤§é“å™¨ä¹Ÿä¸å™¨â€”â€”åˆè§ â€¦">
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="@newlooper">
<meta name="twitter:title" content="Learn Assembly Language æ±‡ç¼–è¯­è¨€å­¦ä¹ (æ‹™è¯‘)" />
<meta property="og:url" content="/post/trans/learn-assembly-language/" />
<meta property="og:title" content="Learn Assembly Language æ±‡ç¼–è¯­è¨€å­¦ä¹ (æ‹™è¯‘)" />
<meta property="og:description" content="Index-0 åŸå€ï¼šhttps://asmtutor.com/ ç¯å¢ƒï¼šnasm on x64 linux
TL;DR  åŠ¨æœºï¼šç¨‹åºå‘˜â€”â€”å¤šæŒæ¡å‡ é—¨è®¡ç®—æœºè¯­è¨€ï¼Œè¿˜æ˜¯æœ‰å¥½å¤„çš„ ä¸»é¢˜ï¼šæ±‡ç¼–è¯­è¨€â€”â€”æœ‰å…¶ä¸å¯æ›¿ä»£çš„ä½œç”¨ å‘ˆç¤ºï¼šå¤©ä¸‹è¯­è¨€é€¾åƒâ€”â€”æ±‡ç¼–ç¬‘çœ‹æ²‰èˆŸä¾§ç•” å±•å¼€ï¼šæ¬²çŸ¥ç¨‹åºçœŸç›¸â€”â€”åç¼–è¯‘éš¾ï¼Œåæ±‡ç¼–æ˜“ å†ç°ï¼šå¤§é“å™¨ä¹Ÿä¸å™¨â€”â€”åˆè§ â€¦" />
<meta property="og:image" content="/images/post/trans/asm.jpg" />

<link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
<link rel="manifest" href="/icons/site.webmanifest">

<link rel="canonical" href="/post/trans/learn-assembly-language/">

    

    
    
    <link rel="preload" href="/css/styles.ee3b9488ef041710052f5c22837bf044d13ac251377aac559881157179229b04be4ae0027ad7b3c9b0cf469d0b37c82b8fcc5956709efe67b73f0e08a76bba3d.css" integrity = "sha512-7juUiO8EFxAFL1wig3vwRNE6wlE3eqxVmIEVcXkimwS&#43;SuACetezybDPRp0LN8grj8xZVnCe/me3Pw4Ip2u6PQ==" as="style" crossorigin="anonymous">
    <link rel="preload" href="/js/bundle.min.14825dc619648aeca2e4e66c65ef7d06ea216e6a64cd503f64d2fe77950ee425c47fc0f2cf993c2d656f534914619a2c47c8313438a810ed5008db38a46a812d.js" as="script" integrity=
    "sha512-FIJdxhlkiuyi5OZsZe99BuohbmpkzVA/ZNL&#43;d5UO5CXEf8Dyz5k8LWVvU0kUYZosR8gxNDioEO1QCNs4pGqBLQ==" crossorigin="anonymous">

    
    <link rel="stylesheet" type="text/css" href="/css/styles.ee3b9488ef041710052f5c22837bf044d13ac251377aac559881157179229b04be4ae0027ad7b3c9b0cf469d0b37c82b8fcc5956709efe67b73f0e08a76bba3d.css" integrity="sha512-7juUiO8EFxAFL1wig3vwRNE6wlE3eqxVmIEVcXkimwS&#43;SuACetezybDPRp0LN8grj8xZVnCe/me3Pw4Ip2u6PQ==" crossorigin="anonymous"><link rel="stylesheet" href="/css/custom.css">
    
  </head>
  
  
    
  
  <body data-code="7" data-lines="false" id="documentTop">

<header class="nav_header" >
  <nav class="nav"><a href='/' class="nav_brand nav_item" title="Looper çš„åšå®¢">
  <img src="/logos/avatar-icon.png" class="logo" alt="Looper çš„åšå®¢">
  <div class="nav_close">
    <div><svg class="icon">
  <use xlink:href="#open-menu"></use>
</svg><svg class="icon">
  <use xlink:href="#closeme"></use>
</svg></div>
  </div>
</a>

    <div class='nav_body nav_body_left'>
      
      
      
        

  <div class="nav_parent">
    <a href="/" class="nav_item" title="é¦–é¡µ">é¦–é¡µ </a>
  </div>
  <div class="nav_parent">
    <a href="/archives/" class="nav_item" title="å½’æ¡£">å½’æ¡£ </a>
  </div>
  <div class="nav_parent">
    <a href="/" class="nav_item" title="å¤–éƒ¨é“¾æ¥">å¤–éƒ¨é“¾æ¥ <img src='/icons/caret-icon.svg' alt="icon" class="nav_icon"></a>
    <div class="nav_sub">
      <span class="nav_child"></span>
        <a href="https://github.com/newlooper" class="nav_child nav_item" title="Github">Github</a>
        <a href="https://twitter.com/newlooper" class="nav_child nav_item" title="Twitter">Twitter</a>
    </div>
  </div>
  <div class="nav_parent">
    <a href="/about/" class="nav_item" title="å…³äº">å…³äº </a>
  </div>
      
      <div class="nav_parent">
        <a href="#" class="nav_item">ğŸŒ</a>
        <div class="nav_sub">
          <span class="nav_child"></span>
          
          <a href="/" class="nav_child nav_item">ç®€ä½“ä¸­æ–‡</a>
          
          <a href="/en/" class="nav_child nav_item"></a>
          
        </div>
      </div>
<div class='follow'>
  <a href="https://github.com/newlooper">
    <svg class="icon">
  <use xlink:href="#github"></use>
</svg>
  </a>
  <a href="https://twitter.com/newlooper">
    <svg class="icon">
  <use xlink:href="#twitter"></use>
</svg>
  </a>
    
  <a href="/index.xml">
    <svg class="icon">
  <use xlink:href="#rss"></use>
</svg>
  </a>
<div class="color_mode">
  <input type="checkbox" class="color_choice" id="mode">
</div>

</div>

    </div>
  </nav>
</header>

    <main>
  
<div class="grid-inverse wrap content">
  <article class="post_content">
    <h1 class="post_title">Learn Assembly Language æ±‡ç¼–è¯­è¨€å­¦ä¹ (æ‹™è¯‘)</h1>
  <div class="post_meta">
    <span><svg class="icon">
  <use xlink:href="#calendar"></use>
</svg></span>
    <span class="post_date">
      Aug 1, 2020</span>
    <span class="post_time"> Â· 52 min read</span><span>&nbsp;Â· <a href='/tags/assembly-language' title="Assembly Language" class="post_tag button button_translucent">Assembly Language
        </a><a href='/tags/nasm' title="NASM" class="post_tag button button_translucent">NASM
        </a><a href='/tags/programming' title="Programming" class="post_tag button button_translucent">Programming
        </a>
    </span>
    <span class="page_only">&nbsp;Â·
  <div class="post_share">
    åˆ†äº«åˆ°:
    <a href="https://twitter.com/intent/tweet?text=Learn%20Assembly%20Language%20%e6%b1%87%e7%bc%96%e8%af%ad%e8%a8%80%e5%ad%a6%e4%b9%a0%28%e6%8b%99%e8%af%91%29&url=%2fpost%2ftrans%2flearn-assembly-language%2f&tw_p=tweetbutton" class="twitter" title="åˆ†äº«åˆ° Twitter" target="_blank" rel="nofollow">
      <svg class="icon">
  <use xlink:href="#twitter"></use>
</svg>
    </a>
    <a href="https://www.facebook.com/sharer.php?u=%2fpost%2ftrans%2flearn-assembly-language%2f&t=Learn%20Assembly%20Language%20%e6%b1%87%e7%bc%96%e8%af%ad%e8%a8%80%e5%ad%a6%e4%b9%a0%28%e6%8b%99%e8%af%91%29" class="facebook" title="åˆ†äº«åˆ° Facebook" target="_blank" rel="nofollow">
      <svg class="icon">
  <use xlink:href="#facebook"></use>
</svg>
    </a>
    <a href="#linkedinshare" id = "linkedinshare" class="linkedin" title="åˆ†äº«åˆ° LinkedIn" rel="nofollow">
      <svg class="icon">
  <use xlink:href="#linkedin"></use>
</svg>
    </a>
    <a href="/post/trans/learn-assembly-language/" title="Copy Link" class="link link_yank">
      <svg class="icon">
  <use xlink:href="#copy"></use>
</svg>
    </a>
  </div>
  </span>
  </div>

    <h2 id="index-0">Index-0</h2>
<p>åŸå€ï¼šhttps://asmtutor.com/ <br>
ç¯å¢ƒï¼šnasm on x64 linux</p>
<h2 id="tldr">TL;DR</h2>
<ul>
<li>åŠ¨æœºï¼šç¨‹åºå‘˜â€”â€”å¤šæŒæ¡å‡ é—¨è®¡ç®—æœºè¯­è¨€ï¼Œè¿˜æ˜¯æœ‰å¥½å¤„çš„</li>
<li>ä¸»é¢˜ï¼šæ±‡ç¼–è¯­è¨€â€”â€”æœ‰å…¶ä¸å¯æ›¿ä»£çš„ä½œç”¨</li>
<li>å‘ˆç¤ºï¼šå¤©ä¸‹è¯­è¨€é€¾åƒâ€”â€”æ±‡ç¼–ç¬‘çœ‹æ²‰èˆŸä¾§ç•”</li>
<li>å±•å¼€ï¼šæ¬²çŸ¥ç¨‹åºçœŸç›¸â€”â€”åç¼–è¯‘éš¾ï¼Œåæ±‡ç¼–æ˜“</li>
<li>å†ç°ï¼šå¤§é“å™¨ä¹Ÿä¸å™¨â€”â€”åˆè§æ—¶å¦‚èŒ¶å‘³ç”˜è‹¦ï¼Œæ´æ‚‰åè‹¥çŒé¡¶é†é†ï¼›åŸä»¥ä¸ºå¬å¤šè¯´å¤šçš†å·²æ˜¨ï¼Œå¿½å›é¦–ä¼¼æ›¾ç›¸è¯†åˆå¦‚é™Œï¼›ç½¢ï¼Œé£æµä¸åœ¨è°ˆå³°å¥ï¼Œç›¸å¯¹æ— è¨€å‘³æ›´é•¿â€¦â€¦</li>
</ul>
<hr>
<p>åŸæ–‡ä½œè€…è‡ªå·±è¯´ ã€<em>This project was put together to teach myself NASM assembly language on linux.</em>ã€</p>
<p>æ¬¸~ï¼ŒåŸæ¥æ˜¯å¾ˆçª„ä¼—çš„å“¦ã€‚</p>
<p>å†™çš„è™½ç„¶é€šä¿—ï¼Œä½†ä¾ç„¶èƒ½æ„Ÿåˆ°å…¶é¢å‘çš„å¹¶ä¸æ˜¯æ¯«æ— ç¼–ç¨‹åŸºç¡€çš„äººç¾¤ï¼Œæ‰€è°“â€œæŸå­ä¸èƒ½éšçœŸæ¶â€ï¼Œæ— è®ºæ€æ ·åŠªåŠ›çš„å°†å¤§é‡æ¦‚å¿µã€åŸç†ã€çŸ¥è¯†å®‰æ’åˆ°çœ‹ä¼¼èŠå¤©èˆ¬çš„æ–‡å­—ä¸­ï¼Œè¿™é‡Œéƒ½è¦æé†’è¯»è€…æ³¨æ„ï¼Œæé˜²å› ä¸ºå¥½å¥‡å¿ƒè€Œé™·å…¥é€’å½’å­¦ä¹ çš„æ³¥æ½­â€¦â€¦</p>
<hr>
<h2 id="lesson-1-hello-world">Lesson 1 Hello, world!</h2>
<h3 id="èƒŒæ™¯çŸ¥è¯†">èƒŒæ™¯çŸ¥è¯†</h3>
<p>æ±‡ç¼–è¯­è¨€æ˜¯ä¸€ç§<a href="https://zh.wikipedia.org/wiki/%E4%BD%8E%E7%BA%A7%E8%AF%AD%E8%A8%80">ä½çº§è¯­è¨€</a>ï¼Œæ±‡ç¼–ç¨‹åºå‘˜ä¸åº•å±‚ç¡¬ä»¶ä¹‹é—´å”¯ä¸€çš„æ¥å£åªæœ‰<a href="https://zh.wikipedia.org/wiki/%E5%86%85%E6%A0%B8">å†…æ ¸</a>æœ¬èº«ã€‚ç”¨æ±‡ç¼–è¯­è¨€ç¼–ç¨‹ï¼Œæ¶‰åŠåˆ° Linux å†…æ ¸æä¾›çš„<a href="https://zh.wikipedia.org/wiki/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8">ç³»ç»Ÿè°ƒç”¨</a>æœºåˆ¶ã€‚è¿™äº›ç³»ç»Ÿè°ƒç”¨æ˜¯æ“ä½œç³»ç»Ÿå†…ç½®çš„åº“å‡½æ•°ï¼Œæä¾›è¯¸å¦‚è¯»å–é”®ç›˜è¾“å…¥ä»¥åŠå°†è¾“å‡ºæ˜¾ç¤ºåˆ°å±å¹•ä¹‹ç±»çš„åŠŸèƒ½ã€‚</p>
<p>å½“ç”¨æˆ·ç¨‹åºå‘èµ·ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå†…æ ¸å°†ç«‹å³<a href="https://zh.wikipedia.org/wiki/%E6%8C%82%E8%B5%B7">æŒ‚èµ·</a>è¯¥ç¨‹åºï¼Œè¿›è€Œé€šè¿‡é©±åŠ¨ç¨‹åºè®©ç›¸å…³ç¡¬ä»¶å®Œæˆç”¨æˆ·ç¨‹åºæ‰€å‘èµ·çš„ä»»åŠ¡è¯·æ±‚ï¼Œæœ€åï¼Œå°†æ§åˆ¶æƒäº¤è¿˜ç»™ç”¨æˆ·ç¨‹åºã€‚</p>

<div class="notices tip">
    <div class="label">æç¤º</div>
    <p>é©±åŠ¨ç¨‹åºçš„é©±åŠ¨äºŒå­—ï¼Œå½¢è±¡çš„æè¿°äº†å†…æ ¸å¯¹ç¡¬ä»¶çš„æ§åˆ¶</p>

  </div>

<p>åœ¨æ±‡ç¼–è¯­è¨€ä¸­å‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œéœ€è¦å‘<code>EAX</code><a href="https://zh.wikipedia.org/wiki/%E5%AF%84%E5%AD%98%E5%99%A8">å¯„å­˜å™¨</a>å†™å…¥ç›¸åº”è°ƒç”¨çš„å‡½æ•°ç¼–å·(ä¹Ÿå³ï¼šæ“ä½œç <code>OPCODE</code>)ï¼ŒåŒæ—¶è®¾ç½®å…¶ä»–å‡ ä¸ªå¯„å­˜å™¨çš„å€¼ä½œä¸ºå®é™…å‚æ•°ï¼Œä¸€åˆ‡å‡†å¤‡åœå½“åï¼ŒæŒ‡ä»¤<code>INT</code>å‘é€ä¸€ä¸ªè½¯<a href="https://zh.wikipedia.org/wiki/%E4%B8%AD%E6%96%B7">ä¸­æ–­</a>ï¼Œå†…æ ¸æ”¶åˆ°ä¸­æ–­è¯·æ±‚åæ¥å—å‚æ•°å¹¶æ‰§è¡Œç›¸åº”çš„åº“å‡½æ•°ã€‚ç®€å•ç›´æ¥ã€‚</p>
<h3 id="æ¥å†™æˆ‘ä»¬çš„ç¬¬å£¹ä¸ªæ±‡ç¼–ç¨‹åºå§ç¾ç‰æœ‰ç‘•">æ¥å†™æˆ‘ä»¬çš„ç¬¬å£¹ä¸ªæ±‡ç¼–ç¨‹åºå§â€”â€”ç¾ç‰æœ‰ç‘•</h3>
<p>è¿˜æ˜¯ä»è‘—åçš„ä¾‹å­â€”â€”$$Hello, world! $$ å¼€å§‹ï¼Œæˆ‘ä»¬çš„æ±‡ç¼–ç¨‹åºå°†æŠŠè¿™ä¸ªè®©æ— æ•°ç¨‹åºå‘˜äº§ç”Ÿ<code>æˆ‘å·²ç»å­¦ä¼šè¿™ç§è¯­è¨€äº†</code>çš„é”™è§‰çš„å­—ç¬¦ä¸²æ‰“å°åˆ°<a href="https://zh.wikipedia.org/wiki/%E6%A8%99%E6%BA%96%E4%B8%B2%E6%B5%81#%E6%A8%99%E6%BA%96%E8%BC%B8%E5%87%BA_(stdout)">æ ‡å‡†è¾“å‡º</a>ä¸Šã€‚</p>
<p>é¦–å…ˆï¼Œåœ¨æ•°æ®æ®µå®šä¹‰ä¸€ä¸ª<code>msg</code>å˜é‡ï¼Œå¹¶èµ‹ç»™å…¶ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼ä½œä¸ºç¨‹åºçš„è¾“å‡ºã€‚è€Œåœ¨ä»£ç æ®µä¸­ï¼Œé€šè¿‡ç¼–å†™å…¨å±€æ ‡ç­¾<code>_start:</code>ï¼Œå‘Šè¯‰å†…æ ¸æˆ‘ä»¬(å†™çš„è¯—)ç¨‹åºå¼€å§‹çš„åœ°æ–¹(æ²¡æœ‰è¿œæ–¹)</p>
<p>å®é™…å‚æ•°é€šè¿‡ä»¥ä¸‹å¯„å­˜å™¨ä¼ ç»™å†…æ ¸ï¼š</p>
<ul>
<li><code>EDX</code>å­˜å‚¨å­—ç¬¦ä¸²çš„é•¿åº¦(å­—èŠ‚æ•°)</li>
<li><code>ECX</code>å­˜å‚¨å­—ç¬¦ä¸²çš„é¦–åœ°å€(å®šä¹‰åœ¨æ•°æ®æ®µä¸­çš„<code>msg</code>å˜é‡åŠ è½½åˆ°å†…å­˜åæ‰€åœ¨çš„ä½ç½®)</li>
<li><code>EBX</code>å­˜å‚¨å­—ç¬¦ä¸²å†™æ“ä½œçš„ç›®æ ‡æ–‡ä»¶â€”â€”æœ¬ä¾‹ä¸­æ˜¯<code>STDOUT</code></li>
</ul>
<p>æ•°æ®ç±»å‹å’Œå®é™…å‚æ•°çš„å«ä¹‰å¯ä»¥åœ¨å‡½æ•°å®šä¹‰ä¸­æŸ¥åˆ°ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="ln">1</span><span class="cp"># https:</span><span class="c1">//github.com/torvalds/linux/blob/master/include/linux/syscalls.h
</span><span class="ln">2</span><span class="c1"></span><span class="n">asmlinkage</span> <span class="kt">long</span> <span class="nf">sys_write</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">count</span><span class="p">);</span>
</code></pre></div><p>æ¥ä¸‹æ¥ï¼Œç¼–è¯‘ã€é“¾æ¥ã€è¿è¡Œç¨‹åº</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Hello World Program - asmtutor.com</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf helloworld.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld.o -o helloworld</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./helloworld</span>
<span class="ln"> 5</span> 
<span class="ln"> 6</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 7</span><span class="nf">msg</span>     <span class="nv">db</span>      <span class="s">&#39;Hello World!&#39;</span><span class="p">,</span> <span class="mh">0Ah</span>     <span class="c1">; assign msg variable with your message string</span>
<span class="ln"> 8</span> 
<span class="ln"> 9</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">10</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="nl">_start:</span>
<span class="ln">13</span> 
<span class="ln">14</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">13</span>     <span class="c1">; number of bytes to write - one for each letter plus 0Ah (line feed character)</span>
<span class="ln">15</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">msg</span>    <span class="c1">; move the memory address of our message string into ecx</span>
<span class="ln">16</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>      <span class="c1">; write to the STDOUT file</span>
<span class="ln">17</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>      <span class="c1">; invoke SYS_WRITE (kernel opcode 4)</span>
<span class="ln">18</span>    <span class="nf">int</span>     <span class="mh">80h</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf helloworld.asm
<span class="ln">2</span>$ ld -m elf_i386 helloworld.o -o helloworld
<span class="ln">3</span>$ ./helloworld
<span class="ln">4</span>Hello World!
<span class="ln">5</span>Segmentation fault
</code></pre></div>
<div class="notices warning">
    <div class="label">é”™è¯¯</div>
    <p>ç³»ç»ŸæŠ¥å‘Šäº†é”™è¯¯â€”â€”Segmentation fault</p>

  </div>

<hr>
<h2 id="lesson-2-ç¨‹åºé€€å‡ºçš„æ­£ç¡®å§¿åŠ¿">Lesson 2 ç¨‹åºé€€å‡ºçš„æ­£ç¡®å§¿åŠ¿</h2>
<h3 id="è‹¥å¹²èƒŒæ™¯çŸ¥è¯†">è‹¥å¹²èƒŒæ™¯çŸ¥è¯†</h3>
<p>è®©æˆ‘ä»¬ä»ç¬¬ä¸€è¯¾æˆåŠŸå‘èµ·ç³»ç»Ÿè°ƒç”¨çš„çŸ­æš‚å–œæ‚¦ä¸­å›è¿‡ç¥æ¥ï¼Œå­¦ä¹ å†…æ ¸ä¸­å¦ä¸€ä¸ªæœ€é‡è¦çš„ç³»ç»Ÿè°ƒç”¨<code>sys_exit</code></p>
<p>è¿˜è®°å¾—ï¼Œä¸Šä¸€è¯¾ä¸­ï¼Œç¨‹åºè¿è¡Œå¹¶æ‰“å°äº† $$Hello, world!$$ å­—ç¬¦ä¸²åï¼Œè¿˜çœ‹åˆ°äº†ä¸€å¥<code>Segmentation fault</code>ï¼Ÿ</p>
<p>å˜›ï¼Œè®¡ç®—æœºç¨‹åºå¯çœ‹ä½œæ˜¯è£…è½½åˆ°å†…å­˜ä¸­ä¸”è¢«åˆ†å‰²æˆè‹¥å¹²èŠ‚(æˆ–æ®µ)çš„ä¸€é•¿æ¡çš„<a href="https://zh.wikipedia.org/wiki/%E6%8C%87%E4%BB%A4">æŒ‡ä»¤</a>åºåˆ—ï¼Œè¿™ä¸ªé€šç”¨çš„å†…å­˜æ± å®é™…ä¸Šè¢«æ‰€æœ‰ç¨‹åºå…±äº«ï¼Œä¿å­˜ç€å˜é‡ã€æŒ‡ä»¤ï¼Œå…¶ä»–ç¨‹åºç­‰ç­‰â€¦â€¦æ¯ä¸€ä¸ªæ®µéƒ½æœ‰ä¸€ä¸ªåœ°å€ï¼Œä»¥ä¾¿å…¶ä¸­å­˜å‚¨çš„äºŒè¿›åˆ¶ä¿¡æ¯ä¹‹åçš„å®šä½è®¿é—®ã€‚</p>
<p>è¦æ‰§è¡ŒåŠ è½½åˆ°å†…å­˜ä¸­çš„ç¨‹åºï¼Œæˆ‘ä»¬ä½¿ç”¨å…¨å±€æ ‡ç­¾<code>_start:</code>æ¥å‘Šè¯‰æ“ä½œç³»ç»Ÿä»å“ªé‡Œæ‰¾åˆ°å¹¶å¼€å§‹æ‰§è¡Œæˆ‘ä»¬çš„ç¨‹åºã€‚ä»é‚£ä¸ªä½ç½®å¼€å§‹ï¼Œå†…å­˜å°†ä¾æ®ç¨‹åºçš„é€»è¾‘æ‰€å†³å®šçš„ä¸‹ä¸€ä¸ªåœ°å€è¢«ä¾æ¬¡è®¿é—®ã€‚å†…æ ¸åœ¨è¿™äº›åœ°å€ä¸Šæ„‰æ‚¦çš„è·³æ¥è·³å»ï¼Œæ‰§è¡Œç€ç¨‹åºã€‚</p>
<p>ä¸å‘Šè¯‰å†…æ ¸<strong>ä¸€ä¸ªç¨‹åºä»å“ªé‡Œå¼€å§‹</strong>åŒæ ·é‡è¦çš„æ˜¯ï¼š<strong>ç¨‹åºåœ¨å“ªé‡Œç»“æŸ</strong>ã€‚è¿™æ­£æ˜¯ä¸Šä¸€è¯¾ä¸­çš„ç¨‹åºæ‰€ç¼ºå°‘çš„æ­¥éª¤ã€‚å› ä¸ºè¿™ä¸ªé‡è¦æ­¥éª¤çš„ç¼ºå¤±ï¼Œåœ¨è°ƒç”¨å®Œ<code>sys_write</code>ï¼Œå†…æ ¸æŠŠæ§åˆ¶æƒäº¤è¿˜ç»™æˆ‘ä»¬çš„ç¨‹åºä¹‹åï¼Œç¨‹åºç»§ç»­é¡ºåºæ‰§è¡Œå†…å­˜ä¸­ç´§æŒ¨åœ¨<code>int     80h</code>ä¹‹åçš„åœ°å€ä¸­çš„&quot;æŒ‡ä»¤&quot;(å¤©çŸ¥é“é‚£ä¸€åˆ»é‚£é‡Œå­˜çš„æ˜¯å•¥)ï¼Œæˆ‘ä»¬ä¸çŸ¥é“å†…æ ¸å°†æ‰§è¡Œä»€ä¹ˆæŒ‡ä»¤ï¼Œä½†æ˜¾ç„¶åœ¨è¿™ä¸ªä¾‹å­ä¸­å†…æ ¸å™ä½äº†ï¼Œå¹¶ä¸”ä¸é«˜å…´(éæ­£å¸¸)çš„ç»ˆæ­¢äº†è¿›ç¨‹ï¼Œä¸¥è‚ƒçš„æ‹›å¾…äº†æˆ‘ä»¬ä¸€ä¸ªï¼š<code>Segmentation fault</code></p>
<p>åœ¨ç¨‹åºçš„æœ«å°¾è°ƒç”¨<code>sys_exit</code>å§ï¼</p>
<h3 id="å¼€å†™æˆ‘ä»¬çš„ç¬¬è´°ä¸ªæ±‡ç¼–ç¨‹åºå–„å§‹å–„ç»ˆ">å¼€å†™æˆ‘ä»¬çš„ç¬¬è´°ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”å–„å§‹å–„ç»ˆ</h3>
<p><code>sys_exit</code>çš„å®šä¹‰ç®€å•æ˜äº†ã€‚åœ¨<a href="http://faculty.nps.edu/cseagle/assembly/sys_call.html">Linux ç³»ç»Ÿè°ƒç”¨è¡¨</a>ä¸­ï¼Œæ“ä½œç <code>OPCODE 1</code>è¢«åˆ†é…ç»™äº†å¥¹ï¼ŒåŒæ—¶å¥¹æ¯”<code>sys_write</code>èŠ‚çœä¸€äº›ï¼Œè°ƒç”¨å¥¹åªéœ€è¦ä¼ ä¸€ä¸ªå‚æ•°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="ln">1</span><span class="cp"># https:</span><span class="c1">//github.com/torvalds/linux/blob/master/include/linux/syscalls.h
</span><span class="ln">2</span><span class="c1"></span><span class="n">asmlinkage</span> <span class="kt">long</span> <span class="nf">sys_exit</span><span class="p">(</span><span class="kt">int</span> <span class="n">error_code</span><span class="p">);</span>
</code></pre></div><p>å¥¹è¦è¢«è¦è¿™æ ·è°ƒï¼š</p>
<ul>
<li><code>EBX</code>é‡Œå­˜<code>0</code>æ„ä¸º<code>é›¶ä¸ªé”™è¯¯</code></li>
<li><code>EAX</code>å½“ç„¶å°±å­˜<code>1</code>äº† (sys_exit çš„ OPCODE)</li>
<li>ç„¶åï¼Œè½¯ä¸­æ–­<code>INT 80h</code>å’Œä¸Šä¸€ä¸ªä¾‹å­ä¸€æ ·</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Hello World Program - asmtutor.com</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf helloworld.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld.o -o helloworld</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./helloworld</span>
<span class="ln"> 5</span> 
<span class="ln"> 6</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 7</span><span class="nf">msg</span>     <span class="nv">db</span>      <span class="s">&#39;Hello World!&#39;</span><span class="p">,</span> <span class="mh">0Ah</span>
<span class="ln"> 8</span> 
<span class="ln"> 9</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">10</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="nl">_start:</span>
<span class="ln">13</span> 
<span class="ln">14</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">13</span>
<span class="ln">15</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">msg</span>
<span class="ln">16</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln">17</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>
<span class="ln">18</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">19</span> 
<span class="ln">20</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">0</span>      <span class="c1">; return 0 status on exit - &#39;No Errors&#39;</span>
<span class="ln">21</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">1</span>      <span class="c1">; invoke SYS_EXIT (kernel opcode 1)</span>
<span class="ln">22</span>    <span class="nf">int</span>     <span class="mh">80h</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf helloworld.asm
<span class="ln">2</span>$ ld -m elf_i386 helloworld.o -o helloworld
<span class="ln">3</span>$ ./helloworld
<span class="ln">4</span>Hello World!
</code></pre></div><p>$$We\ will\ meet\ again,\ Segmentation\ fault$$</p>
<hr>
<h2 id="lesson-3-è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦">Lesson 3 è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦</h2>
<h3 id="åˆä¸€äº›èƒŒæ™¯çŸ¥è¯†">åˆä¸€äº›èƒŒæ™¯çŸ¥è¯†</h3>
<p>ä¸ºä»€ä¹ˆéœ€è¦è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Ÿ</p>
<p>å˜›ï¼Œ<code>sys_write</code>å¿…é¡»çŸ¥é“æˆ‘ä»¬ä¼ ç»™å¥¹çš„å­—ç¬¦ä¸²çš„æŒ‡é’ˆå’Œé•¿åº¦(å­—èŠ‚æ•°)ï¼Œæ‰èƒ½å¤Ÿæ‰“å°è¾“å‡ºã€‚å¦‚æœä¿®æ”¹äº†<code>msg</code>å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œä¹Ÿå¿…é¡»ç›¸åº”çš„æ›´æ–°å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå¦åˆ™æ‰“å°æ“ä½œå°†ä¸æ­£ç¡®ã€‚</p>
<p>ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ç”¨ç¬¬äºŒè¯¾ä¸­çš„ä¾‹å­ã€‚å°†<code>msg</code>å­—ç¬¦ä¸²ä¿®æ”¹ä¸ºï¼š(ä¸­æ‹¬å·å¸®åŠ©æ ‡è¯†è¾¹ç•Œç”¨)
$$[Hello,\ brave\ new\ world!]$$
ç¼–è¯‘ã€é“¾æ¥ã€æ‰§è¡Œä¿®æ”¹åçš„ç¨‹åºã€‚è¾“å‡ºå˜ä¸ºï¼š
$$[Hello,\ brave\ ]$$
(ä»…æœ‰å‰ 13 ä¸ª ascii å­—ç¬¦ï¼Œç©ºæ ¼ä¹Ÿç®—)ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å°†é•¿åº¦å®å‚çš„å€¼ä»åŸæ¥çš„ 13ï¼Œæ›´æ–°ä¸ºæ–°å­—ç¬¦ä¸²é•¿åº¦ 23</p>
<h3 id="æˆ‘ä»¬çš„ç¬¬åä¸ªæ±‡ç¼–ç¨‹åºç™»åœºé­”å°ºé“ä¸ˆ">æˆ‘ä»¬çš„ç¬¬åä¸ªæ±‡ç¼–ç¨‹åºç™»åœºâ€”â€”é­”å°ºé“ä¸ˆ</h3>
<p>è¦è®¡ç®—æŸä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè¿™é‡Œå¼•å…¥ä¸€ç§ç§°ä½œ<a href="https://www.tutorialspoint.com/cprogramming/c_pointer_arithmetic.htm">æŒ‡é’ˆç®—æ•°</a>çš„æŠ€æœ¯ã€‚å…·ä½“æ­¥éª¤ä¸ºï¼š</p>
<ul>
<li>é€‰ä¸¤ä¸ªå¯„å­˜å™¨åˆå§‹åŒ–ä¸ºç›¸åŒçš„å†…å­˜åœ°å€</li>
<li>ç”¨å…¶ä¸­ä¸€ä¸ªå¯„å­˜å™¨(æœ¬ä¾‹ä¸­ä½¿ç”¨<code>EAX</code>)éå†è¦è¾“å‡ºçš„å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼Œåœ¨æ¯æ¬¡é‡åˆ° 1 ä¸ªå­—ç¬¦çš„æ—¶å€™ç»™è‡ªå·±åŠ  1ï¼Œç›´åˆ°å…¶é‡åˆ°ä¸€ä¸ªä»£è¡¨å­—ç¬¦ä¸²ç»“å°¾çš„ç‰¹æ®Šå­—ç¬¦</li>
<li>æ­¤æ—¶ç”¨<code>EAX</code>å‡å»ä¸€å¼€å§‹åˆå§‹åŒ–ä¸ºç›¸åŒå€¼çš„å¦ä¸€ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œç»“æœå°±æ˜¯å­—ç¬¦çš„ä¸ªæ•°</li>
</ul>
<p>æœ‰ç‚¹åƒä¸¤ä¸ªæ•°ç»„åšå‡æ³•ï¼Œå·®è¡¨ç¤ºäº†ä¸¤ä¸ªåœ°å€ä¹‹é—´çš„å…ƒç´ çš„ä¸ªæ•°ã€‚æˆ‘ä»¬ç”¨è¿™ä¸ªå·®å€¼æ›¿ä»£æ—§ä¾‹å­ä¸­çš„<a href="https://zh.wikipedia.org/wiki/%E5%AF%AB%E6%AD%BB">ç¡¬ç¼–ç </a>å€¼ï¼Œä¼ é€’ç»™<code>sys_write</code></p>
<p>æ±‡ç¼–ç¨‹åºä¸­ï¼Œé€šå¸¸ç”¨<code>CMP</code>æŒ‡ä»¤è¿›è¡ŒæŸç§åˆ¤æ–­ï¼Œæ ¹æ®å…¶ä¸¤ä¸ªæ“ä½œæ•°çš„æ¯”è¾ƒç»“æœæ¥ç½®ä½æ ‡å¿—å¯„å­˜å™¨ï¼Œåç»­æŒ‡ä»¤æ ¹æ®æ ‡å¿—å¯„å­˜å™¨çš„å€¼æ¥å†³å®šå¦‚ä½•æ¨è¿›ç¨‹åºçš„æµç¨‹ã€‚</p>
<p>åœ¨æ¥ä¸‹æ¥çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯<code>ZF (Zero Flag)</code>æ ‡å¿—å¯„å­˜å™¨ã€‚å¦‚æœ<code>EAX</code>å¯„å­˜å™¨ä¸­çš„åœ°å€æ‰€æŒ‡å‘çš„å­—ç¬¦ ascii å€¼ç­‰äº 0ï¼Œåˆ™<code>ZF</code>è¢«ç½®ä½ã€‚è€Œå<code>JZ</code>æŒ‡ä»¤çœ‹åˆ°<code>ZF</code>ä¸º 1ï¼Œå°±è·³è½¬åˆ°å…¶æ“ä½œæ•°æ‰€æŒ‡æ˜çš„ä½ç½®(æµç¨‹æ”¹å˜)ï¼Œè¿™ä¸ªè·³è½¬ä¸ºçš„æ˜¯é€€å‡º nextchar å¾ªç¯ä»è€Œæ‰§è¡Œåç»­çš„ç¨‹åºä»£ç </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Hello World Program (Calculating string length)</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf helloworld-len.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-len.o -o helloworld-len</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./helloworld-len</span>
<span class="ln"> 5</span> 
<span class="ln"> 6</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 7</span><span class="nf">msg</span>     <span class="nv">db</span>      <span class="s">&#39;Hello, brave new world!&#39;</span><span class="p">,</span> <span class="mh">0Ah</span> <span class="c1">; we can modify this now without having to update anywhere else in the program</span>
<span class="ln"> 8</span> 
<span class="ln"> 9</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">10</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="nl">_start:</span>
<span class="ln">13</span> 
<span class="ln">14</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nv">msg</span>        <span class="c1">; move the address of our message string into EBX</span>
<span class="ln">15</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">ebx</span>        <span class="c1">; move the address in EBX into EAX as well (Both now point to the same segment in memory)</span>
<span class="ln">16</span> 
<span class="ln">17</span><span class="nl">nextchar:</span>
<span class="ln">18</span>    <span class="nf">cmp</span>     <span class="kt">byte</span> <span class="p">[</span><span class="nb">eax</span><span class="p">],</span> <span class="mi">0</span>   <span class="c1">; compare the byte pointed to by EAX at this address against zero (Zero is an end of string delimiter)</span>
<span class="ln">19</span>    <span class="nf">jz</span>      <span class="nv">finished</span>        <span class="c1">; jump (if the zero flagged has been set) to the point in the code labeled &#39;finished&#39;</span>
<span class="ln">20</span>    <span class="nf">inc</span>     <span class="nb">eax</span>             <span class="c1">; increment the address in EAX by one byte (if the zero flagged has NOT been set)</span>
<span class="ln">21</span>    <span class="nf">jmp</span>     <span class="nv">nextchar</span>        <span class="c1">; jump to the point in the code labeled &#39;nextchar&#39;</span>
<span class="ln">22</span> 
<span class="ln">23</span><span class="nl">finished:</span>
<span class="ln">24</span>    <span class="nf">sub</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">ebx</span>        <span class="c1">; subtract the address in EBX from the address in EAX</span>
<span class="ln">25</span>                            <span class="c1">; remember both registers started pointing to the same address (see line 15)</span>
<span class="ln">26</span>                            <span class="c1">; but EAX has been incremented one byte for each character in the message string</span>
<span class="ln">27</span>                            <span class="c1">; when you subtract one memory address from another of the same type</span>
<span class="ln">28</span>                            <span class="c1">; the result is number of segments between them - in this case the number of bytes</span>
<span class="ln">29</span> 
<span class="ln">30</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="nb">eax</span>        <span class="c1">; EAX now equals the number of bytes in our string</span>
<span class="ln">31</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">msg</span>        <span class="c1">; the rest of the code should be familiar now</span>
<span class="ln">32</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln">33</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>
<span class="ln">34</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">35</span> 
<span class="ln">36</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">0</span>
<span class="ln">37</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln">38</span>    <span class="nf">int</span>     <span class="mh">80h</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf helloworld-len.asm
<span class="ln">2</span>$ ld -m elf_i386 helloworld-len.o -o helloworld-len
<span class="ln">3</span>$ ./helloworld-len
<span class="ln">4</span>Hello, brave new world!
</code></pre></div><hr>
<h2 id="lesson-4-å­ä¾‹ç¨‹">Lesson 4 å­ä¾‹ç¨‹</h2>
<h3 id="å¼•å…¥å­ä¾‹ç¨‹">å¼•å…¥å­ä¾‹ç¨‹</h3>
<p>å­ä¾‹ç¨‹â€”â€”å‡½æ•°ä¹Ÿã€‚ä»–ä»¬æ˜¯å¯å¤ç”¨çš„ä»£ç ç‰‡æ®µï¼Œèƒ½å¤Ÿè¢«ç”¨æˆ·ç¨‹åºè°ƒç”¨å®Œæˆå„ç§å„æ ·çš„ä»»åŠ¡ã€‚å’Œå‰é¢å®šä¹‰ç¨‹åºå…¥å£ç‚¹ä¸€æ ·ï¼Œå­ä¾‹ç¨‹ä¹Ÿé€šè¿‡å®šä¹‰æ ‡ç­¾æ¥å£°æ˜å…¶èµ·å§‹ä½ç½®(å¦‚<code>strlen:</code>)ï¼Œç„¶è€Œä¸åŒä¹‹å¤„åœ¨äºç¨‹åºä¸ä½¿ç”¨<code>JMP</code>æŒ‡ä»¤æ¥è®¿é—®å­ä¾‹ç¨‹ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä½¿ç”¨<code>CALL</code>æŒ‡ä»¤ã€‚åŒæ ·ï¼Œå­ä¾‹ç¨‹æ‰§è¡Œå®Œæˆåçš„è·³è½¬å›åœ°å€ä¹Ÿä¸ä½¿ç”¨<code>JMP</code>è€Œæ˜¯ä½¿ç”¨<code>RET</code>ã€‚</p>
<p>åŒæ ·æ˜¯è·³è½¬åˆ°æŒ‡ä»¤çš„æ‰€åœ¨å¤„(memory address)ï¼Œä¸ºä»€ä¹ˆå­ä¾‹ç¨‹ä¸ä½¿ç”¨<code>JMP</code>å‘¢ï¼Ÿ</p>
<p>å­ä¾‹ç¨‹çš„å¨åŠ›åœ¨äºå…¶å¯å¤ç”¨æ€§ï¼Œæƒ³åœ¨ç¨‹åºä¸­çš„ä»»æ„ä½ç½®éšæ—¶è°ƒç”¨å­ä¾‹ç¨‹ï¼Œé™¤äº†è¦è·³è½¬åˆ°å­ä¾‹ç¨‹æ‰€åœ¨çš„åœ°å€å¤–ï¼Œè¿˜å¿…é¡»è¦ç¼–å†™ä¸€äº›é€»è¾‘æ¥ç¡®å®šå­ä¾‹ç¨‹è¿è¡Œå®Œåè·³è½¬å›çš„ä½ç½®ï¼Œå¦‚æœä½¿ç”¨<code>JMP</code>å°†å¯¼è‡´æˆ‘ä»¬çš„ä»£ç ä¸­åˆ°å¤„æ˜¯éå¿…è¦çš„æ ‡ç­¾ã€‚è€Œä½¿ç”¨<code>CALL</code>å’Œ<code>RET</code>ï¼Œæ±‡ç¼–è¯­è¨€å°†é‡‡ç”¨ç§°ä½œ<a href="https://zh.wikipedia.org/wiki/%E5%A0%86%E6%A0%88">å †æ ˆ</a>çš„æœºåˆ¶ä»£ä¸ºå¤„ç†è¿™äº›ç»†èŠ‚ã€‚</p>
<h3 id="å¼•å…¥æ ˆ">å¼•å…¥æ ˆ</h3>
<p>æ ˆä¹Ÿåœ¨å†…å­˜ä¸­ï¼Œç„¶è€ŒæŸä¸ªç¨‹åºçš„æ ˆå†…å­˜å¯¹å…¶è€Œè¨€å…·å¤‡ä¸€äº›ç‰¹æ®Šæ€§è´¨ã€‚æ ˆå†…å­˜çš„å­˜å–éµå¾ª<a href="https://zh.wikipedia.org/wiki/%E5%85%88%E9%80%B2%E5%85%88%E5%87%BA%E5%92%8C%E5%BE%8C%E9%80%B2%E5%85%88%E5%87%BA%E6%9C%83%E8%A8%88%E6%B3%95">åè¿›å…ˆå‡º</a> Last In First Out memory (LIFO)åŸåˆ™ã€‚å¯ä»¥å°†å…¶æƒ³è±¡æˆå¨æˆ¿ä¸­çš„ä¸€æ‘ç¢Ÿå­ï¼Œæœ€åä¸€ä¸ªæ”¾åœ¨é¡¶ä¸Šçš„ç¢Ÿå­ä¹Ÿæ­£æ˜¯ä¸‹ä¸€æ¬¡ç”¨ç¢Ÿå­æ—¶ç¬¬ä¸€ä¸ªè¢«å–èµ°çš„ã€‚</p>
<p>è¯šç„¶ï¼Œæ±‡ç¼–ä¸­çš„æ ˆå†…å­˜æ”¾ä¸ä¸‹ç¢Ÿå­ï¼Œä½†æ˜¯èƒ½æ”¾äºŒè¿›åˆ¶æ•°æ®ã€‚å˜é‡ã€åœ°å€ã€ç”šè‡³å…¶ä»–ç¨‹åºéƒ½å¯ä»¥æ”¾è¿›å»ã€‚å½“è°ƒç”¨å­ä¾‹ç¨‹æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ ˆæ¥ä¸´æ—¶å­˜æ”¾ä¸Šè¿°æ•°æ®ä»¥ä¾¿å­ä¾‹ç¨‹ä½¿ç”¨ã€‚</p>
<p>é€šå¸¸ï¼Œæ‰§è¡Œä¸­çš„ä¸€æ®µä»£ç æ‰€ä½¿ç”¨ç€çš„ä»»ä½•å¯„å­˜å™¨ï¼Œéƒ½åº”è¯¥åœ¨è°ƒç”¨å­ä¾‹ç¨‹ä¹‹å‰ï¼Œä½¿ç”¨<code>PUSH</code>æŒ‡ä»¤å°†å…¶ä¸­çš„æ•°æ®å‹å…¥æ ˆï¼Œä»¥æ­¤ç¡®ä¿å­ä¾‹ç¨‹è¿”å›åå¯ä»¥è¿˜åŸè¿™äº›å¯„å­˜å™¨çš„åŸæœ‰å€¼(å› ä¸ºå­ä¾‹ç¨‹æœ‰å¯èƒ½ä¼šä½¿ç”¨ä¸Šè¿°å¯„å­˜å™¨å­˜å‚¨æ–°çš„æ•°æ®ï¼Œä¸é¢„å…ˆä¿å­˜çš„è¯è¢«è¦†ç›–åå°±ä¸¢å¤±äº†)ï¼Œè¿˜åŸé€šè¿‡ä¸<code>PUSH</code>æŒ‡ä»¤æ‰§è¡Œé¡ºåºç›¸åçš„é¡ºåºæ‰§è¡Œ<code>POP</code>æŒ‡ä»¤æ¥å®Œæˆã€‚å¦‚æ­¤ï¼Œå°±ä¸å¿…æ‹…å¿ƒå­ä¾‹ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­å¯¹ä¸Šè¿°å¯„å­˜çš„ä¿®æ”¹ã€‚</p>
<p><code>CALL</code>å’Œ<code>RET</code>ä¸¤ä¸ªæŒ‡ä»¤ä¸<code>PUSH</code>å’Œ<code>POP</code>ç›¸ä¼¼ï¼Œä¹Ÿä½¿ç”¨åˆ°äº†å †æ ˆï¼Œä½†ä»–ä»¬é™¤äº†å‹æ ˆ/å¼¹æ ˆå¤–è¿˜åšäº†é¢å¤–çš„å·¥ä½œï¼Œå½“<code>CALL</code>ä¸€ä¸ªå­ä¾‹ç¨‹æ—¶ï¼Œ<code>CALL</code>æŒ‡ä»¤æ‰€åœ¨ä½ç½®çš„ä¸‹ä¸€ä¸ªå†…å­˜åœ°å€(return address)è¢«å‹å…¥æ ˆï¼ŒåŒæ—¶å­ä¾‹ç¨‹æ‰€åœ¨åœ°å€è¢«å­˜å…¥<code>EIP</code>ã€‚è¿™ä¸ªå­˜åœ¨æ ˆå†…å­˜ä¸­çš„åœ°å€(return address)å°†ç”±åœ¨å­ä¾‹ç¨‹ä¸­çš„<code>RET</code>æŒ‡ä»¤å¼¹ç»™<code>EIP</code>ä»è€Œè·³è½¬å›è°ƒç”¨è€…çš„ä»£ç ç»§ç»­æ‰§è¡Œã€‚å¸Œæœ›è¿™æ®µæè¿°èƒ½å¤Ÿäº›è®¸çš„æ¶ˆé™¤ã€å†…è”æ ‡ç­¾ä½¿ç”¨<code>JMP</code>ï¼Œè€Œå­ä¾‹ç¨‹(å‡½æ•°)è°ƒç”¨ä½¿ç”¨<code>CALL</code>ã€‘çš„ç–‘æƒ‘ã€‚</p>
<h3 id="æˆ‘ä»¬çš„ç¬¬è‚†ä¸ªæ±‡ç¼–ç¨‹åºç®¡ä¸­çª¥è±¹">æˆ‘ä»¬çš„ç¬¬è‚†ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”ç®¡ä¸­çª¥è±¹</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Hello World Program (Subroutines)</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf helloworld-len.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-len.o -o helloworld-len</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./helloworld-len</span>
<span class="ln"> 5</span> 
<span class="ln"> 6</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 7</span><span class="nf">msg</span>     <span class="nv">db</span>      <span class="s">&#39;Hello, brave new world!&#39;</span><span class="p">,</span> <span class="mh">0Ah</span>
<span class="ln"> 8</span> 
<span class="ln"> 9</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">10</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="nl">_start:</span>
<span class="ln">13</span> 
<span class="ln">14</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg</span>        <span class="c1">; move the address of our message string into EAX</span>
<span class="ln">15</span>    <span class="nf">call</span>    <span class="nv">strlen</span>          <span class="c1">; call our function to calculate the length of the string</span>
<span class="ln">16</span> 
<span class="ln">17</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="nb">eax</span>        <span class="c1">; our function leaves the result in EAX</span>
<span class="ln">18</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">msg</span>        <span class="c1">; this is all the same as before</span>
<span class="ln">19</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln">20</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>
<span class="ln">21</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">22</span> 
<span class="ln">23</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">0</span>
<span class="ln">24</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln">25</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">26</span> 
<span class="ln">27</span><span class="nl">strlen:</span>                     <span class="c1">; this is our first function declaration</span>
<span class="ln">28</span>    <span class="nf">push</span>    <span class="nb">ebx</span>             <span class="c1">; push the value in EBX onto the stack to preserve it while we use EBX in this function</span>
<span class="ln">29</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">eax</span>        <span class="c1">; move the address in EAX into EBX (Both point to the same segment in memory)</span>
<span class="ln">30</span> 
<span class="ln">31</span><span class="nl">nextchar:</span>                   <span class="c1">; this is the same as lesson3</span>
<span class="ln">32</span>    <span class="nf">cmp</span>     <span class="kt">byte</span> <span class="p">[</span><span class="nb">eax</span><span class="p">],</span> <span class="mi">0</span>
<span class="ln">33</span>    <span class="nf">jz</span>      <span class="nv">finished</span>
<span class="ln">34</span>    <span class="nf">inc</span>     <span class="nb">eax</span>
<span class="ln">35</span>    <span class="nf">jmp</span>     <span class="nv">nextchar</span>
<span class="ln">36</span> 
<span class="ln">37</span><span class="nl">finished:</span>
<span class="ln">38</span>    <span class="nf">sub</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">ebx</span>
<span class="ln">39</span>    <span class="nf">pop</span>     <span class="nb">ebx</span>             <span class="c1">; pop the value on the stack back into EBX</span>
<span class="ln">40</span>    <span class="nf">ret</span>                     <span class="c1">; return to where the function was called</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf helloworld-len.asm
<span class="ln">2</span>$ ld -m elf_i386 helloworld-len.o -o helloworld-len
<span class="ln">3</span>$ ./helloworld-len
<span class="ln">4</span>Hello, brave new world!
</code></pre></div><hr>
<h2 id="lesson-5-å¤–éƒ¨åŒ…å«æ–‡ä»¶">Lesson 5 å¤–éƒ¨åŒ…å«æ–‡ä»¶</h2>
<p>å¤–éƒ¨åŒ…å«æ–‡ä»¶ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿå°†ç¨‹åºçš„ä»£ç åˆ†æ•£ä¸åŒæ–‡ä»¶ä¸­ã€‚å¯¹äºæ’°å†™æ¸…æ™°ã€æ˜“ç»´æŠ¤çš„ç¨‹åºæ¥è¯´è¿™ä¸ªæŠ€æœ¯å¾ˆæœ‰ç”¨ã€‚å¯é‡ç”¨ä»£ç èƒ½å¤Ÿå†™æˆå­ä¾‹ç¨‹ä¿å­˜åœ¨åˆ†æ•£çš„æ–‡ä»¶ä¸­ï¼Œè¿™ç±»æ–‡ä»¶è¢«ç§°ä¸ºåº“ã€‚å½“ä½ æƒ³ä½¿ç”¨åº“ä¸­çš„æŸæ®µä»£ç æ—¶ï¼ŒåŒ…å«è¯¥åº“æ–‡ä»¶åˆ°ä½ çš„ç¨‹åºï¼Œå°±å¥½åƒè¯¥æ–‡ä»¶çš„å†…å®¹æ˜¯å°±æ˜¯ä½ ç¨‹åºçš„ä¸€éƒ¨åˆ†ä¸€æ ·ã€‚</p>
<p>æœ¬èŠ‚æˆ‘ä»¬æŠŠè®¡ç®—å­—ç¬¦ä¸²é•¿åº¦çš„å­ä¾‹ç¨‹ç§»åˆ°å¤–éƒ¨æ–‡ä»¶ä¸­ã€‚åŒæ—¶ï¼Œå°†å­—ç¬¦ä¸²æ‰“å°å’Œç¨‹åºé€€å‡ºé€»è¾‘ä¹Ÿéƒ½ä¿®ç¼®ä¸ºå­ä¾‹ç¨‹ä¸€å¹¶ç§»åˆ°å¤–éƒ¨æ–‡ä»¶é‡Œã€‚å¦‚æ­¤ï¼Œç˜¦èº«åçš„ç¨‹åºçœ‹èµ·æ¥æ›´åŠ æ¸…æ™°ã€æ˜“è¯»ã€‚</p>
<p>è¿™é‡Œå¤šå£°æ˜ä¸€æ¡æ¶ˆæ¯ï¼Œè°ƒç”¨ä¸¤æ¬¡å­—ç¬¦ä¸²æ‰“å°å­ä¾‹ç¨‹æ¥æ¼”ç¤ºå¯¹ä»£ç çš„å¤ç”¨ã€‚</p>

<div class="notices tip">
    <div class="label">æç¤º</div>
    <p>ä¹‹åçš„è¯¾ç¨‹ä¸­ï¼Œé™¤é functions.asm å‘ç”Ÿäº†æ”¹å˜ï¼Œå¦åˆ™å…¶ä»£ç å°†è¢«çœç•¥</p>

  </div>

<h3 id="æˆ‘ä»¬çš„ç¬¬ä¼ä¸ªæ±‡ç¼–ç¨‹åºä»–å±±ä¹‹çŸ³">æˆ‘ä»¬çš„ç¬¬ä¼ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”ä»–å±±ä¹‹çŸ³</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">;------------------------------------------</span>
<span class="ln"> 2</span><span class="c1">; functions.asm</span>
<span class="ln"> 3</span><span class="c1">;</span>
<span class="ln"> 4</span>
<span class="ln"> 5</span><span class="c1">; int slen(String message)</span>
<span class="ln"> 6</span><span class="c1">; String length calculation function</span>
<span class="ln"> 7</span><span class="nl">slen:</span>
<span class="ln"> 8</span>    <span class="nf">push</span>    <span class="nb">ebx</span>
<span class="ln"> 9</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">eax</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="nl">nextchar:</span>
<span class="ln">12</span>    <span class="nf">cmp</span>     <span class="kt">byte</span> <span class="p">[</span><span class="nb">eax</span><span class="p">],</span> <span class="mi">0</span>
<span class="ln">13</span>    <span class="nf">jz</span>      <span class="nv">finished</span>
<span class="ln">14</span>    <span class="nf">inc</span>     <span class="nb">eax</span>
<span class="ln">15</span>    <span class="nf">jmp</span>     <span class="nv">nextchar</span>
<span class="ln">16</span> 
<span class="ln">17</span><span class="nl">finished:</span>
<span class="ln">18</span>    <span class="nf">sub</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">ebx</span>
<span class="ln">19</span>    <span class="nf">pop</span>     <span class="nb">ebx</span>
<span class="ln">20</span>    <span class="nf">ret</span>
<span class="ln">21</span> 
<span class="ln">22</span> 
<span class="ln">23</span><span class="c1">;------------------------------------------</span>
<span class="ln">24</span><span class="c1">; void sprint(String message)</span>
<span class="ln">25</span><span class="c1">; String printing function</span>
<span class="ln">26</span><span class="nl">sprint:</span>
<span class="ln">27</span>    <span class="nf">push</span>    <span class="nb">edx</span>
<span class="ln">28</span>    <span class="nf">push</span>    <span class="nb">ecx</span>
<span class="ln">29</span>    <span class="nf">push</span>    <span class="nb">ebx</span>
<span class="ln">30</span>    <span class="nf">push</span>    <span class="nb">eax</span>
<span class="ln">31</span>    <span class="nf">call</span>    <span class="nv">slen</span>
<span class="ln">32</span> 
<span class="ln">33</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="nb">eax</span>
<span class="ln">34</span>    <span class="nf">pop</span>     <span class="nb">eax</span>
<span class="ln">35</span> 
<span class="ln">36</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">eax</span>
<span class="ln">37</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln">38</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>
<span class="ln">39</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">40</span> 
<span class="ln">41</span>    <span class="nf">pop</span>     <span class="nb">ebx</span>
<span class="ln">42</span>    <span class="nf">pop</span>     <span class="nb">ecx</span>
<span class="ln">43</span>    <span class="nf">pop</span>     <span class="nb">edx</span>
<span class="ln">44</span>    <span class="nf">ret</span>
<span class="ln">45</span> 
<span class="ln">46</span> 
<span class="ln">47</span><span class="c1">;------------------------------------------</span>
<span class="ln">48</span><span class="c1">; void exit()</span>
<span class="ln">49</span><span class="c1">; Exit program and restore resources</span>
<span class="ln">50</span><span class="nl">quit:</span>
<span class="ln">51</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">0</span>
<span class="ln">52</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln">53</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">54</span>    <span class="nf">ret</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Hello World Program (External file include)</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf helloworld-inc.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-inc.o -o helloworld-inc</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./helloworld-inc</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;                             </span><span class="c1">; include our external file
</span><span class="ln"> 7</span><span class="c1"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">msg1</span>    <span class="nv">db</span>      <span class="s">&#39;Hello, brave new world!&#39;</span><span class="p">,</span> <span class="mh">0Ah</span>              <span class="c1">; our first message string</span>
<span class="ln">10</span><span class="nf">msg2</span>    <span class="nv">db</span>      <span class="s">&#39;This is how we recycle in NASM.&#39;</span><span class="p">,</span> <span class="mh">0Ah</span>      <span class="c1">; our second message string</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">13</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">14</span> 
<span class="ln">15</span><span class="nl">_start:</span>
<span class="ln">16</span> 
<span class="ln">17</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg1</span>       <span class="c1">; move the address of our first message string into EAX</span>
<span class="ln">18</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>          <span class="c1">; call our string printing function</span>
<span class="ln">19</span> 
<span class="ln">20</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg2</span>       <span class="c1">; move the address of our second message string into EAX</span>
<span class="ln">21</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>          <span class="c1">; call our string printing function</span>
<span class="ln">22</span> 
<span class="ln">23</span>    <span class="nf">call</span>    <span class="nv">quit</span>            <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf helloworld-inc.asm
<span class="ln">2</span>$ ld -m elf_i386 helloworld-inc.o -o helloworld-inc
<span class="ln">3</span>$ ./helloworld-inc
<span class="ln">4</span>Hello, brave new world!
<span class="ln">5</span>This is how we recycle in NASM.
<span class="ln">6</span>This is how we recycle in NASM.
</code></pre></div>
<div class="notices warning">
    <div class="label">é”™è¯¯</div>
    <p>è²Œä¼¼ç¬¬äºŒæ¡æ¶ˆæ¯è¢«æ‰“å°äº†ä¸¤æ¬¡ï¼Œæˆ‘ä»¬åœ¨ä¸‹èŠ‚è¯¾ä¿®æ­£:-)</p>

  </div>

<hr>
<h2 id="lesson-6-null-ç»ˆæ­¢ç¬¦">Lesson 6 NULL ç»ˆæ­¢ç¬¦</h2>
<p>å¥½å§ï¼Œä¸Šä¸€èŠ‚çš„ç»“å°¾æˆ‘ç”¨â€œè²Œä¼¼â€äºŒå­—ä¿®é¥°äº†<code>msg2</code>è¢«æ‰“å°äº†ä¸¤æ¬¡è¿™ä¸€ç°è±¡ï¼Œå®é™…ä¸Šç¨‹åºå¹¶æ²¡æœ‰é€»è¾‘é”™è¯¯ï¼Œå¥¹å¿ å®çš„å±¥è¡Œäº†èŒè´£ï¼Œå®Œæˆäº†æˆ‘ä»¬çš„ä»»åŠ¡å§”æ‰˜ï¼Œä¹Ÿå³ï¼šä¸Šä¸€èŠ‚çš„ä»£ç å†™æ³•ï¼Œè¾“å‡ºå°±åº”è¯¥æ˜¯é‚£æ ·å­çš„ã€‚è§£é‡Šç°è±¡ä¹‹å‰ï¼Œå…ˆåˆ†åˆ«æ³¨é‡Šæ‰æ‰“å°<code>msg1</code>æˆ–<code>msg2</code>çš„ä»£ç ï¼Œåªç•™å…¶ä¸­ä¸€ä¸ªçœ‹çœ‹æ•ˆæœ</p>
<p>å¦‚æœï¼Œåªæ³¨é‡Š<code>msg1</code>çš„æ‰“å°æŒ‡ä»¤ï¼Œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln">1</span><span class="c1">;   mov     eax, msg1       ; move the address of our first message string into EAX</span>
<span class="ln">2</span><span class="c1">;   call    sprint          ; call our string printing function</span>
<span class="ln">3</span>    
<span class="ln">4</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg2</span>       <span class="c1">; move the address of our second message string into EAX</span>
<span class="ln">5</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>          <span class="c1">; call our string printing function</span>
</code></pre></div><p>è¾“å‡ºä¸ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>This is how we recycle in NASM.
</code></pre></div><p>è¾“å‡ºå’Œæˆ‘ä»¬é¢„æœŸçš„ç›¸ç¬¦ã€‚</p>
<p>å¦‚æœï¼Œåªæ³¨é‡Š<code>msg2</code>çš„æ‰“å°æŒ‡ä»¤ï¼Œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln">1</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg1</span>       <span class="c1">; move the address of our first message string into EAX</span>
<span class="ln">2</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>          <span class="c1">; call our string printing function</span>
<span class="ln">3</span>    
<span class="ln">4</span><span class="c1">;   mov     eax, msg2       ; move the address of our second message string into EAX</span>
<span class="ln">5</span><span class="c1">;   call    sprint          ; call our string printing function</span>
</code></pre></div><p>è¾“å‡ºä¸ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>Hello, brave new world!
<span class="ln">2</span>This is how we recycle in NASM.
</code></pre></div><p>ç­‰ä¸€ä¸‹ï¼Œæ‰“å°<code>msg1</code>çš„æŒ‡ä»¤ï¼Œæ€ä¹ˆæŠŠç¬¬äºŒä¸ªå­—ç¬¦ä¸²ä¹Ÿæ‰“å°äº†ï¼Ÿ</p>
<p>ç­”æ¡ˆåœ¨äºï¼Œå¯¹äº<code>msg1</code>å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬æ²¡æœ‰ç»™å‡ºæ˜ç¡®çš„ç»“å°¾ã€‚åœ¨æ•°æ®æ®µä¸­çš„ä¸¤æ¡ç›¸é‚»çš„<code>db</code>ä»£ç ï¼Œå†…å­˜çš„åˆ†é…ä¹Ÿæ˜¯ç›¸é‚»çš„ï¼Œå› æ­¤ï¼Œ<code>msg1</code>å­—ç¬¦ä¸²çš„æœ€åä¸€ä¸ªå­—èŠ‚ç´§æŒ¨ç€<code>msg2</code>çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ã€‚è®°å¾—ä¹‹å‰ï¼Œè®¡ç®—å­—ç¬¦ä¸²é•¿åº¦æ‰€é‡‡ç”¨çš„æ–¹æ³•â€”â€”é€šè¿‡æ¯”è¾ƒå€¼ä¸º 0 çš„å­—èŠ‚ä½œä¸ºç»“å°¾ï¼Lesson 5 çš„ä»£ç åœ¨è¿è¡Œåˆ°è®¡ç®—<code>msg1</code>çš„é•¿åº¦æ—¶ï¼Œå­ä¾‹ç¨‹è¯»å®Œäº†æ‰€æœ‰<code>msg1</code>çš„å­—èŠ‚åï¼Œå¹¶æ²¡æœ‰é‡åˆ°å€¼ä¸º 0 çš„å­—èŠ‚ï¼Œæ‰€ä»¥å¥¹è®¤ä¸ºè¿™ä¸ªå­—ç¬¦ä¸²è¿˜æ²¡å®Œï¼Œç¨‹åºç»§ç»­ä»<code>msg2</code>çš„ç¬¬ä¸€ä¸ªå­—èŠ‚é€ä¸ªæ¯”è¾ƒï¼Œç›´åˆ°<code>msg2</code>çš„æ‰€æœ‰å­—èŠ‚ä¹Ÿè¯»å®Œäº†ï¼Œæ‰æ‰¾åˆ°å­—ç¬¦ä¸²ç»“å°¾ã€‚</p>
<p>å› æ­¤çœ‹ä¸Šå»<code>msg2</code>è¢«æ‰“å°ä¸¤æ¬¡ï¼Œå®é™…ä¸Šæ˜¯è§†è§‰ä¸Šçš„é—®é¢˜ï¼Œå®é™…çš„è¾“å‡ºè¿‡ç¨‹æ˜¯ï¼š</p>
<p>å…ˆè¾“å‡ºäº†<code>Hello, brave new world!\nThis is how we recycle in NASM.\n</code>
åˆè¾“å‡ºäº†<code>This is how we recycle in NASM.\n</code></p>
<p>å†ç­‰ä¸€ä¸‹ï¼Œä½ æˆ–è®¸ä¼šé—®ï¼Œ<code>msg2</code>æˆ‘ä¹Ÿæ²¡çœ‹åˆ°æœ‰å­—ç¬¦ä¸²ç»“å°¾å•Šï¼Ÿè¢«ä½ é€®åˆ°äº†:-)è¿™æ˜¯å› ä¸ºæ•°æ®æ®µçš„å†…å­˜åœ¨å¼€è¾Ÿæ—¶ï¼Œéƒ½è¢«åˆå§‹åŒ–æˆäº† 0hã€‚</p>
<h3 id="æˆ‘ä»¬çš„ç¬¬é™†ä¸ªæ±‡ç¼–ç¨‹åºæ¥šæ²³æ±‰ç•Œ">æˆ‘ä»¬çš„ç¬¬é™†ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”æ¥šæ²³æ±‰ç•Œ</h3>

<div class="notices tip">
    <div class="label">æç¤º</div>
    <p>æ±‡ç¼–ç¨‹åºä¸­ï¼Œç”¨ 0h è¡¨ç¤º NULL å­—èŠ‚ï¼Œè€Œ NULL å­—èŠ‚æ ‡è¯†äº†å­—ç¬¦ä¸²çš„ç»“å°¾</p>

  </div>

<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Hello World Program (NULL terminating bytes)</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf helloworld-inc.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-inc.o -o helloworld-inc</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./helloworld-inc</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">msg1</span>    <span class="nv">db</span>      <span class="s">&#39;Hello, brave new world!&#39;</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="mh">0h</span>          <span class="c1">; NOTE the null terminating byte</span>
<span class="ln">10</span><span class="nf">msg2</span>    <span class="nv">db</span>      <span class="s">&#39;This is how we recycle in NASM.&#39;</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="mh">0h</span>  <span class="c1">; NOTE the null terminating byte</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">13</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">14</span> 
<span class="ln">15</span><span class="nl">_start:</span>
<span class="ln">16</span> 
<span class="ln">17</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg1</span>
<span class="ln">18</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>
<span class="ln">19</span> 
<span class="ln">20</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg2</span>
<span class="ln">21</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>
<span class="ln">22</span> 
<span class="ln">23</span>    <span class="nf">call</span>    <span class="nv">quit</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf helloworld-inc.asm
<span class="ln">2</span>$ ld -m elf_i386 helloworld-inc.o -o helloworld-inc
<span class="ln">3</span>$ ./helloworld-inc
<span class="ln">4</span>Hello, brave new world!
<span class="ln">5</span>This is how we recycle in NASM.
</code></pre></div><hr>
<h2 id="lesson-7-æ¢è¡Œ">Lesson 7 æ¢è¡Œ</h2>
<p>æ¢è¡Œçš„é‡è¦æ€§å¯¹äºæ§åˆ¶å°ç¨‹åºè€Œè¨€æ˜¯ä¸è¨€è€Œå–»çš„ï¼Œå°¤å…¶æ˜¯æ„å»ºéœ€è¦ç”¨æˆ·è¾“å…¥çš„ç¨‹åºæ—¶ï¼Œæ›´æ˜¯å¦‚æ­¤ã€‚ä½†æ˜¯æ¢è¡Œåˆæ˜¯éš¾ä»¥æ‘†å¼„çš„ï¼Œå¤„ç†å­—ç¬¦ä¸²æ—¶æœ‰æ—¶éœ€è¦åŒ…å«æ¢è¡Œï¼Œæœ‰æ—¶åˆéœ€è¦å»æ‰ä»–ã€‚å¦‚æœå§‹ç»ˆæŠŠè¡¨ç¤ºæ¢è¡Œç¬¦çš„ ascii ç  0Ah ç¡¬ç¼–ç åœ¨æˆ‘ä»¬çš„å˜é‡ä¸­ï¼Œå°±è¦é¢å¯¹ä¸€ä¸ªé—®é¢˜â€”â€”åœ¨ä¸éœ€è¦è¾“å‡ºæ¢è¡Œç¬¦çš„åœ°æ–¹å¾—å†™é¢å¤–çš„ä»£ç æ¥å»æ‰ä»–ã€‚</p>
<p>å¦‚æœæœ‰ä¸ªä¸“é—¨çš„å­ä¾‹ç¨‹è¾“å‡ºæˆ‘ä»¬æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼Œç”±è¯¥å­ä¾‹ç¨‹è´Ÿè´£åœ¨ç»“å°¾æ‰“å°ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚å°±å¯ä»¥åœ¨éœ€è¦æ‰“å°æ¢è¡Œç¬¦çš„åœ°æ–¹è°ƒç”¨è¿™ä¸ªå­ä¾‹ç¨‹ï¼Œè€Œåœ¨ä¸éœ€è¦æ‰“å°æ¢è¡Œç¬¦çš„åœ°æ–¹è¿˜ä½¿ç”¨æˆ‘ä»¬çš„<code>sprint</code>å­ä¾‹ç¨‹å°±å¯ä»¥äº†ã€‚</p>
<p>è®°å¾—å‰æ–‡ä¸­ï¼Œæƒ³è°ƒç”¨<code>sys_write</code>å¿…é¡»æä¾›è¦æ‰“å°å†…å®¹çš„åœ°å€åŠå…¶é•¿åº¦ï¼Œæ‰€ä»¥ä»…ä»…ä¼ é€’æ¢è¡Œç¬¦æ˜¯ä¸å¤Ÿçš„ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿä¸æƒ³ä»…ä»…ä¸ºäº†è¿™ä¸€ä¸ªå­—ç¬¦å•ç‹¬å®šä¹‰ä¸€ä¸ªå˜é‡æ¥ä¿å­˜ä»–ï¼Œå› æ­¤ä½¿ç”¨æ ˆå†…å­˜æ¥å®ç°æ–°çš„å­ä¾‹ç¨‹ã€‚</p>
<p>æ‹›æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ¢è¡Œç¬¦å­˜è¿›<code>EAX</code></li>
<li><code>PUSH EAX</code>çš„å€¼åˆ°æ ˆä¸Šï¼Œå¹¶è·å–<code>ESP</code>çš„å€¼(å½“å‰æ ˆé¡¶æ‰€åœ¨çš„åœ°å€)</li>
<li>é€šè¿‡å½“å‰çš„<code>ESP</code>çŸ¥é“äº†æ¢è¡Œç¬¦æ‰€åœ¨å†…å­˜åœ°å€ï¼Œé‚£ä¹ˆè°ƒç”¨<code>sys_write</code>çš„å¿…è¦æ¡ä»¶å·²ç„¶å…·å¤‡</li>
</ul>
<h3 id="ä¸”çœ‹æˆ‘ä»¬çš„ç¬¬æŸ’ä¸ªæ±‡ç¼–ç¨‹åºè·¯è½¬å³°å›">ä¸”çœ‹æˆ‘ä»¬çš„ç¬¬æŸ’ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”è·¯è½¬å³°å›</h3>

<div class="notices tip">
    <div class="label">æç¤º</div>
    <p>è§‚å¯Ÿ functions.asm ä¸­çš„ sprintLF å­ä¾‹ç¨‹</p>

  </div>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">;------------------------------------------</span>
<span class="ln"> 2</span><span class="c1">; int slen(String message)</span>
<span class="ln"> 3</span><span class="c1">; String length calculation function</span>
<span class="ln"> 4</span><span class="nl">slen:</span>
<span class="ln"> 5</span>    <span class="nf">push</span>    <span class="nb">ebx</span>
<span class="ln"> 6</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">eax</span>
<span class="ln"> 7</span> 
<span class="ln"> 8</span><span class="nl">nextchar:</span>
<span class="ln"> 9</span>    <span class="nf">cmp</span>     <span class="kt">byte</span> <span class="p">[</span><span class="nb">eax</span><span class="p">],</span> <span class="mi">0</span>
<span class="ln">10</span>    <span class="nf">jz</span>      <span class="nv">finished</span>
<span class="ln">11</span>    <span class="nf">inc</span>     <span class="nb">eax</span>
<span class="ln">12</span>    <span class="nf">jmp</span>     <span class="nv">nextchar</span>
<span class="ln">13</span> 
<span class="ln">14</span><span class="nl">finished:</span>
<span class="ln">15</span>    <span class="nf">sub</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">ebx</span>
<span class="ln">16</span>    <span class="nf">pop</span>     <span class="nb">ebx</span>
<span class="ln">17</span>    <span class="nf">ret</span>
<span class="ln">18</span> 
<span class="ln">19</span> 
<span class="ln">20</span><span class="c1">;------------------------------------------</span>
<span class="ln">21</span><span class="c1">; void sprint(String message)</span>
<span class="ln">22</span><span class="c1">; String printing function</span>
<span class="ln">23</span><span class="nl">sprint:</span>
<span class="ln">24</span>    <span class="nf">push</span>    <span class="nb">edx</span>
<span class="ln">25</span>    <span class="nf">push</span>    <span class="nb">ecx</span>
<span class="ln">26</span>    <span class="nf">push</span>    <span class="nb">ebx</span>
<span class="ln">27</span>    <span class="nf">push</span>    <span class="nb">eax</span>
<span class="ln">28</span>    <span class="nf">call</span>    <span class="nv">slen</span>
<span class="ln">29</span> 
<span class="ln">30</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="nb">eax</span>
<span class="ln">31</span>    <span class="nf">pop</span>     <span class="nb">eax</span>
<span class="ln">32</span> 
<span class="ln">33</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">eax</span>
<span class="ln">34</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln">35</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>
<span class="ln">36</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">37</span> 
<span class="ln">38</span>    <span class="nf">pop</span>     <span class="nb">ebx</span>
<span class="ln">39</span>    <span class="nf">pop</span>     <span class="nb">ecx</span>
<span class="ln">40</span>    <span class="nf">pop</span>     <span class="nb">edx</span>
<span class="ln">41</span>    <span class="nf">ret</span>
<span class="ln">42</span> 
<span class="ln">43</span> 
<span class="ln">44</span><span class="c1">;------------------------------------------</span>
<span class="ln">45</span><span class="c1">; void sprintLF(String message)</span>
<span class="ln">46</span><span class="c1">; String printing with line feed function</span>
<span class="ln">47</span><span class="nl">sprintLF:</span>
<span class="ln">48</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>
<span class="ln">49</span> 
<span class="ln">50</span>    <span class="nf">push</span>    <span class="nb">eax</span>         <span class="c1">; push eax onto the stack to preserve it while we use the eax register in this function</span>
<span class="ln">51</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mh">0Ah</span>    <span class="c1">; move 0Ah into eax - 0Ah is the ascii character for a linefeed</span>
<span class="ln">52</span>    <span class="nf">push</span>    <span class="nb">eax</span>         <span class="c1">; push the linefeed onto the stack so we can get the address</span>
<span class="ln">53</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">esp</span>    <span class="c1">; move the address of the current stack pointer into eax for sprint</span>
<span class="ln">54</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>      <span class="c1">; call our sprint function</span>
<span class="ln">55</span>    <span class="nf">pop</span>     <span class="nb">eax</span>         <span class="c1">; remove our linefeed character from the stack</span>
<span class="ln">56</span>    <span class="nf">pop</span>     <span class="nb">eax</span>         <span class="c1">; restore the original value of eax before our function was called</span>
<span class="ln">57</span>    <span class="nf">ret</span>                 <span class="c1">; return to our program</span>
<span class="ln">58</span> 
<span class="ln">59</span> 
<span class="ln">60</span><span class="c1">;------------------------------------------</span>
<span class="ln">61</span><span class="c1">; void exit()</span>
<span class="ln">62</span><span class="c1">; Exit program and restore resources</span>
<span class="ln">63</span><span class="nl">quit:</span>
<span class="ln">64</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">0</span>
<span class="ln">65</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln">66</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">67</span>    <span class="nf">ret</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Hello World Program (Print with line feed)</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf helloworld-lf.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-lf.o -o helloworld-lf</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./helloworld-lf</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">msg1</span>    <span class="nv">db</span>      <span class="s">&#39;Hello, brave new world!&#39;</span><span class="p">,</span> <span class="mh">0h</span>          <span class="c1">; NOTE we have removed the line feed character 0Ah</span>
<span class="ln">10</span><span class="nf">msg2</span>    <span class="nv">db</span>      <span class="s">&#39;This is how we recycle in NASM.&#39;</span><span class="p">,</span> <span class="mh">0h</span>  <span class="c1">; NOTE we have removed the line feed character 0Ah</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">13</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">14</span> 
<span class="ln">15</span><span class="nl">_start:</span>
<span class="ln">16</span> 
<span class="ln">17</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg1</span>
<span class="ln">18</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rintLF</span>    <span class="c1">; NOTE we are calling our new print with linefeed function</span>
<span class="ln">19</span> 
<span class="ln">20</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg2</span>
<span class="ln">21</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rintLF</span>    <span class="c1">; NOTE we are calling our new print with linefeed function</span>
<span class="ln">22</span> 
<span class="ln">23</span>    <span class="nf">call</span>    <span class="nv">quit</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf helloworld-lf.asm
<span class="ln">2</span>$ ld -m elf_i386 helloworld-lf.o -o helloworld-lf
<span class="ln">3</span>$ ./helloworld-lf
<span class="ln">4</span>Hello, brave new world!
<span class="ln">5</span>This is how we recycle in NASM.
</code></pre></div><hr>
<h2 id="lesson-8-å‘½ä»¤è¡Œå‚æ•°">Lesson 8 å‘½ä»¤è¡Œå‚æ•°</h2>
<p>åœ¨ NASM ä¸­ï¼Œæ¥æ”¶å‘½ä»¤è¡Œå‚æ•°ä¹Ÿä½¿ç”¨å †æ ˆã€‚ç¨‹åºå¯åŠ¨æ—¶ï¼Œæ‰€æœ‰å‚æ•°è¢«ååºçš„å‹å…¥å †æ ˆï¼Œç„¶åç¨‹åºåè¢«å‹å…¥æ ˆï¼Œæœ€åæ˜¯å‚æ•°çš„ä¸ªæ•°è¢«å‹å…¥æ ˆã€‚å¯¹äº NASM ç¼–å†™çš„ç¨‹åºï¼Œæœ€é¡¶ä¸Šçš„ä¸¤ä¸ªæ ˆå†…å­˜å•å…ƒæ€»æ˜¯ä¿å­˜ç€ç¨‹åºåå’Œå‚æ•°ä¸ªæ•°ã€‚</p>
<p>è¦å¤„ç†è¿™äº›å‚æ•°ï¼Œæˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯æ‰§è¡Œè‹¥å¹²æ¬¡<code>POP</code>é€ä¸ªå¼¹å‡ºå‚æ•°ä¿¡æ¯ï¼Œç„¶åè¿­ä»£æ¯ä¸€ä¸ªå‚æ•°å¹¶è¿è¡Œæˆ‘ä»¬çš„ç¨‹åºé€»è¾‘ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œç®€å•çš„è°ƒç”¨<code>sprintLF</code>å‡½æ•°æ‰“å°è¾“å‡ºã€‚</p>

<div class="notices note">
    <div class="label">æ³¨æ„</div>
    <p>æˆ‘ä»¬ä½¿ç”¨<code>ECX</code>å¯„å­˜å™¨ä½œä¸ºå¾ªç¯è®¡æ•°å™¨ã€‚è¿™ä¸ªé€šç”¨å¯„å­˜å™¨æœ€åˆçš„è®¾è®¡æ„å›¾å°±æ˜¯è®¡æ•°ã€‚</p>

  </div>

<h3 id="æˆ‘ä»¬çš„ç¬¬æŒä¸ªæ±‡ç¼–ç¨‹åºå…µæ¥å°†æŒ¡">æˆ‘ä»¬çš„ç¬¬æŒä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”å…µæ¥å°†æŒ¡</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Hello World Program (Passing arguments from the command line)</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf helloworld-args.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-args.o -o helloworld-args</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./helloworld-args</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln"> 9</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="nl">_start:</span>
<span class="ln">12</span> 
<span class="ln">13</span>    <span class="nf">pop</span>     <span class="nb">ecx</span>             <span class="c1">; first value on the stack is the number of arguments</span>
<span class="ln">14</span> 
<span class="ln">15</span><span class="nl">nextArg:</span>
<span class="ln">16</span>    <span class="nf">cmp</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mh">0h</span>         <span class="c1">; check to see if we have any arguments left</span>
<span class="ln">17</span>    <span class="nf">jz</span>      <span class="nv">noMoreArgs</span>      <span class="c1">; if zero flag is set jump to noMoreArgs label (jumping over the end of the loop)</span>
<span class="ln">18</span>    <span class="nf">pop</span>     <span class="nb">eax</span>             <span class="c1">; pop the next argument off the stack</span>
<span class="ln">19</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rintLF</span>        <span class="c1">; call our print with linefeed function</span>
<span class="ln">20</span>    <span class="nf">dec</span>     <span class="nb">ecx</span>             <span class="c1">; decrease ecx (number of arguments left) by 1</span>
<span class="ln">21</span>    <span class="nf">jmp</span>     <span class="nv">nextArg</span>         <span class="c1">; jump to nextArg label</span>
<span class="ln">22</span> 
<span class="ln">23</span><span class="nl">noMoreArgs:</span>
<span class="ln">24</span>    <span class="nf">call</span>    <span class="nv">quit</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf helloworld-args.asm
<span class="ln">2</span>$ ld -m elf_i386 helloworld-lf.o -o helloworld-args
<span class="ln">3</span>$ ./helloworld-args <span class="s2">&#34;This is one argument&#34;</span> <span class="s2">&#34;This is another&#34;</span> <span class="m">101</span>
<span class="ln">4</span>./helloworld-args
<span class="ln">5</span>This is one argument
<span class="ln">6</span>This is another
<span class="ln">7</span><span class="m">101</span>
</code></pre></div><hr>
<h2 id="lesson-9-å¤„ç†ç”¨æˆ·è¾“å‡º">Lesson 9 å¤„ç†ç”¨æˆ·è¾“å‡º</h2>
<h3 id="å¼•å…¥-bss-æ®µ">å¼•å…¥ bss æ®µ</h3>
<p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†ä»£ç æ®µ<code>.text</code>å’Œæ•°æ®æ®µ<code>.data</code>ã€‚æ¥ä¸‹æ¥å¼•å…¥<code>.bss</code>æ®µâ€”â€”å…¨ç§° BLOCK Started by Symbolã€‚è¿™å—å†…å­˜ç”¨æ¥ä¿å­˜ç¨‹åºä¸­çš„æœªåˆå§‹åŒ–å˜é‡ã€‚è¿™äº›é¢„ç•™çš„ç©ºé—´é€šå¸¸ç”¨æ¥å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œè¿™ç±»æ•°æ®çš„ç‰¹ç‚¹åœ¨äºæ— æ³•åœ¨ç¼–ç¨‹æ—¶çŸ¥é“å…¶å…·ä½“çš„å¤§å°ã€‚</p>
<p>å˜é‡å£°æ˜è¯­æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln">1</span><span class="k">SECTION</span> <span class="nv">.bss</span>
<span class="ln">2</span><span class="nl">variableName1:</span>      <span class="kd">RESB</span>    <span class="mi">1</span>       <span class="c1">; reserve space for 1 byte</span>
<span class="ln">3</span><span class="nl">variableName2:</span>      <span class="kd">RESW</span>    <span class="mi">1</span>       <span class="c1">; reserve space for 1 word</span>
<span class="ln">4</span><span class="nl">variableName3:</span>      <span class="kd">RESD</span>    <span class="mi">1</span>       <span class="c1">; reserve space for 1 double word</span>
<span class="ln">5</span><span class="nl">variableName4:</span>      <span class="kd">RESQ</span>    <span class="mi">1</span>       <span class="c1">; reserve space for 1 double precision float (quad word)</span>
<span class="ln">6</span><span class="nl">variableName5:</span>      <span class="kd">REST</span>    <span class="mi">1</span>       <span class="c1">; reserve space for 1 extended precision float</span>
</code></pre></div><p>æ˜¯æ—¶å€™å¼•å…¥å¦ä¸€ä¸ªé‡è¦çš„ç³»ç»Ÿè°ƒç”¨<code>sys_read</code>äº†ï¼Œè®©ç”¨æˆ·è¾“å…¥æ¥çš„æ›´çŒ›çƒˆäº›å§ã€‚åœ¨ Linux ç³»ç»Ÿè°ƒç”¨è¡¨ä¸­ï¼Œæ­¤å‡½æ•°çš„<code>OPCODE 3</code>ã€‚å’Œ<code>sys_write</code>ä¸€æ ·ä¹Ÿæ¥æ”¶ 3 ä¸ªå‚æ•°ï¼Œè¯¦æƒ…å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>EDX</code>è½½å…¥è¯»å–çš„æœ€å¤§é•¿åº¦(ä»¥å­—èŠ‚ä¸ºå•ä½)</li>
<li><code>ECX</code>è½½å…¥<code>.bss</code>ä¸­åˆ›å»ºçš„å˜é‡çš„åœ°å€</li>
<li><code>EBX</code>è½½å…¥è¦è¯»å–çš„æ–‡ä»¶æè¿°ç¬¦(åœ¨æœ¬ä¾‹ä¸­ä¸ºSTDIN)</li>
</ul>
<p>åŒæ ·ï¼Œå‡½æ•°å‚æ•°çš„æ•°æ®ç±»å‹å’Œå«ä¹‰å¯åœ¨è¡Œæ•°å®šä¹‰ä¸­æ‰¾åˆ°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="ln">1</span><span class="cp"># https:</span><span class="c1">//github.com/torvalds/linux/blob/master/include/linux/syscalls.h
</span><span class="ln">2</span><span class="c1"></span><span class="n">asmlinkage</span> <span class="kt">long</span> <span class="nf">sys_read</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">count</span><span class="p">);</span>
</code></pre></div><p><code>sys_read</code>çš„è¡Œä¸ºï¼šä¸€æ—¦è¯»åˆ°ä¸€ä¸ª<code>LF</code>ï¼Œå°±è¿”å›åˆ°è°ƒç”¨è€…ç¨‹åºï¼Œæ­¤æ—¶ä»–è‡³ä»Šä¸ºæ­¢è¯»åˆ°çš„å†…å®¹è¢«å­˜æ”¾åœ¨<code>ECX</code>ä¸­ä¿å­˜çš„åœ°å€æ‰€æŒ‡å‘çš„å†…å­˜ä¸­ã€‚</p>
<p>å»¶ä¼¸é˜…è¯»â€”â€”<a href="/post/original/cs/io/eof/">EOFï¼Œåˆ°åº•æ€ä¹ˆå›äº‹</a></p>
<h3 id="è¿™æ˜¯æˆ‘ä»¬çš„ç¬¬ç–ä¸ªæ±‡ç¼–ç¨‹åºä¸é¢„åˆ™åºŸ">è¿™æ˜¯æˆ‘ä»¬çš„ç¬¬ç–ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”ä¸é¢„åˆ™åºŸ</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Hello World Program (Getting input)</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf helloworld-input.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-input.o -o helloworld-input</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./helloworld-input</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">msg1</span>        <span class="nv">db</span>      <span class="s">&#39;Please enter your name: &#39;</span><span class="p">,</span> <span class="mh">0h</span>      <span class="c1">; message string asking user for input</span>
<span class="ln">10</span><span class="nf">msg2</span>        <span class="nv">db</span>      <span class="s">&#39;Hello, &#39;</span><span class="p">,</span> <span class="mh">0h</span>                       <span class="c1">; message string to use after user has entered their name</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="k">SECTION</span> <span class="nv">.bss</span>
<span class="ln">13</span><span class="nl">sinput:</span>     <span class="kd">resb</span>    <span class="mi">255</span>                                 <span class="c1">; reserve a 255 byte space in memory for the users input string</span>
<span class="ln">14</span> 
<span class="ln">15</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">16</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">17</span> 
<span class="ln">18</span><span class="nl">_start:</span>
<span class="ln">19</span> 
<span class="ln">20</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg1</span>
<span class="ln">21</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>
<span class="ln">22</span> 
<span class="ln">23</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">255</span>        <span class="c1">; number of bytes to read</span>
<span class="ln">24</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">si</span><span class="nv">nput</span>     <span class="c1">; reserved space to store our input (known as a buffer)</span>
<span class="ln">25</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; read from the STDIN file</span>
<span class="ln">26</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">3</span>          <span class="c1">; invoke SYS_READ (kernel opcode 3)</span>
<span class="ln">27</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">28</span> 
<span class="ln">29</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg2</span>
<span class="ln">30</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>
<span class="ln">31</span> 
<span class="ln">32</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">si</span><span class="nv">nput</span>     <span class="c1">; move our buffer into eax (Note: input contains a linefeed)</span>
<span class="ln">33</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>          <span class="c1">; call our print function</span>
<span class="ln">34</span> 
<span class="ln">35</span>    <span class="nf">call</span>    <span class="nv">quit</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf helloworld-input.asm
<span class="ln">2</span>$ ld -m elf_i386 helloworld-input.o -o helloworld-input
<span class="ln">3</span>$ ./helloworld-input
<span class="ln">4</span>Please enter your name: Daniel Givney
<span class="ln">5</span>Hello, Daniel Givney
</code></pre></div><hr>
<h2 id="lesson-10-æ•°åˆ°å">Lesson 10 æ•°åˆ°å</h2>
<h3 id="åˆæ¥äº†èƒŒæ™¯çŸ¥è¯†">åˆæ¥äº†ï¼ŒèƒŒæ™¯çŸ¥è¯†</h3>
<p>ä¸ç›´è§‰ä¸Šç›¸åï¼Œåœ¨æ±‡ç¼–è¯­è¨€ä¸­è®¡æ•°å¹¶ä¸é‚£ä¹ˆç®€å•ç›´æ¥ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¾—ä¼ é€’ä¸€ä¸ªåœ°å€ç»™<code>sys_write</code>ï¼Œä¸èƒ½ä»…ä»…å°†æ•°å­—åŠ è½½åˆ°å¯„å­˜å™¨ä¸­å¹¶è°ƒç”¨æˆ‘ä»¬çš„<code>print</code>å‡½æ•°ã€‚å…¶æ¬¡ï¼Œæ•°å­—å’Œå­—ç¬¦ä¸²åœ¨æ±‡ç¼–é‡Œå¤§ä¸ç›¸åŒã€‚å­—ç¬¦ä¸²è¢«æè¿°ä¸ºä¸€ç³»åˆ—çš„ ASCII å€¼ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå…³äº <a href="http://www.asciitable.com/">ASCII</a> çš„ä¸€ä¸ªä¸é”™çš„ç«™ç‚¹(æ€ä¹ˆæ‰“å¼€å‡€æ˜¯å¹¿å‘Šã€‚ã€‚ã€‚) ï¼Œè¿™å¥—ç¼–ç è¢«ç”¨æ¥è§„èŒƒè·¨è®¡ç®—æœºçš„å­—ç¬¦ä¸²è¡¨ç¤ºçš„ç»Ÿä¸€æ ‡å‡†ã€‚</p>
<p>Rememberï¼Œ<code>æ•°</code>æ˜¯æ— æ³•æ‰“å°çš„â€”â€”æ‰“å°å‡ºæ¥çš„éƒ½æ˜¯<code>å­—ç¬¦ä¸²</code>ã€‚ä¸ºäº†æ•°åˆ° 10ï¼Œéœ€è¦ä»æ ‡å‡†çš„æ•´æ•°åˆ°å¯¹åº”çš„ ASCII å­—ç¬¦ä¸²çš„è½¬æ¢ã€‚çœ‹è¿‡ ASCII ç è¡¨ä¹‹åï¼Œå¯ä»¥æ³¨æ„åˆ°ï¼Œæ•´æ•° 1 å¯¹åº”çš„ ASCII å€¼æ˜¯ 49ã€‚å®é™…ä¸Šï¼Œå¯¹äº 0 åˆ° 9 è¿™ 10 ä¸ªæ•´æ•°ï¼ŒåŠ  48 å°±æ˜¯å…¶å¯¹åº”çš„ ASCII ç ã€‚</p>
<h3 id="æˆ‘ä»¬çš„ç¬¬æ‹¾ä¸ªæ±‡ç¼–ç¨‹åºé‚¯éƒ¸å­¦æ­¥">æˆ‘ä»¬çš„ç¬¬æ‹¾ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”é‚¯éƒ¸å­¦æ­¥</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Hello World Program (Count to 10)</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf helloworld-10.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-10.o -o helloworld-10</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./helloworld-10</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln"> 9</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="nl">_start:</span>
<span class="ln">12</span> 
<span class="ln">13</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; ecx is initalised to zero.</span>
<span class="ln">14</span> 
<span class="ln">15</span><span class="nl">nextNumber:</span>
<span class="ln">16</span>    <span class="nf">inc</span>     <span class="nb">ecx</span>             <span class="c1">; increment ecx</span>
<span class="ln">17</span> 
<span class="ln">18</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">ecx</span>        <span class="c1">; move the address of our integer into eax</span>
<span class="ln">19</span>    <span class="nf">add</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">48</span>         <span class="c1">; add 48 to our number to convert from integer to ascii for printing</span>
<span class="ln">20</span>    <span class="nf">push</span>    <span class="nb">eax</span>             <span class="c1">; push eax to the stack</span>
<span class="ln">21</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">esp</span>        <span class="c1">; get the address of the character on the stack</span>
<span class="ln">22</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rintLF</span>        <span class="c1">; call our print function</span>
<span class="ln">23</span> 
<span class="ln">24</span>    <span class="nf">pop</span>     <span class="nb">eax</span>             <span class="c1">; clean up the stack so we don&#39;t have unneeded bytes taking up space</span>
<span class="ln">25</span>    <span class="nf">cmp</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">10</span>         <span class="c1">; have we reached 10 yet? compare our counter with decimal 10</span>
<span class="ln">26</span>    <span class="nf">jne</span>     <span class="nv">nextNumber</span>      <span class="c1">; jump if not equal and keep counting</span>
<span class="ln">27</span> 
<span class="ln">28</span>    <span class="nf">call</span>    <span class="nv">quit</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln"> 1</span>$ nasm -f elf helloworld-10.asm
<span class="ln"> 2</span>$ ld -m elf_i386 helloworld-10.o -o helloworld-10
<span class="ln"> 3</span>$ ./helloworld-10
<span class="ln"> 4</span><span class="m">1</span>
<span class="ln"> 5</span><span class="m">2</span>
<span class="ln"> 6</span><span class="m">3</span>
<span class="ln"> 7</span><span class="m">4</span>
<span class="ln"> 8</span><span class="m">5</span>
<span class="ln"> 9</span><span class="m">6</span>
<span class="ln">10</span><span class="m">7</span>
<span class="ln">11</span><span class="m">8</span>
<span class="ln">12</span><span class="m">9</span>
<span class="ln">13</span>:
</code></pre></div>
<div class="notices warning">
    <div class="label">é”™è¯¯</div>
    <p>å“¦å™¢ï¼šæˆ‘ä»¬çš„æ•°å­— 10 æ‰“å°æˆäº†å†’å·(:)ï¼Œå’‹äº†å‘¢ï¼Ÿ</p>

  </div>

<hr>
<h2 id="lesson-11-æ•°åˆ°å-itoa">Lesson 11 æ•°åˆ°å (itoa)</h2>

<div class="notices note">
    <div class="label">æ³¨æ„</div>
    <p>æ˜¯ itoaï¼Œä¸æ˜¯ iota</p>

  </div>

<p>ä¸ºä»€ä¹ˆ Lesson 10 çš„ç¨‹åºæŠŠ 10 æ‰“å°æˆäº†å†’å·(:)å‘¢ã€‚å—¯ï¼Œè®©æˆ‘ä»¬ç¿»å¼€ ASCII è¡¨ï¼Œèƒ½å¤Ÿçœ‹åˆ°å†’å·çš„ ASCII å€¼æ˜¯ 58 = 10 + 48ï¼Œæ‰€ä»¥æŒ‰ä¸ŠèŠ‚çš„ç¨‹åºå†™æ³•ï¼Œå°±åº”è¯¥è¾“å‡ºå†’å·å¹¶æ²¡æœ‰é”™ã€‚ä¸ŠèŠ‚æ‰€è¯´çš„ 0 åˆ° 9 è¿™ 10 ä¸ªæ•´æ•°ï¼Œå¯ä»¥åŠ  48 å¾—åˆ°å¯¹åº”çš„ ASCII å€¼ï¼Œç„¶åä¼ ç»™<code>sys_write</code>çš„è¾“å‡ºå¯¹åº”çš„å­—ç¬¦ä¸²ï¼›ä½†æ˜¯å¯¹äºæ•°å­— 10ï¼Œä»–æœ‰ä¸¤ä½ï¼Œæ²¡æœ‰ä¸€ä¸ªå•ç‹¬çš„ ASCII æ¥è¡¨ç¤º 10 çš„å­—ç¬¦ä¸²å½¢å¼ã€‚è¿™ä¸ªä¸¤ä½æ•°éœ€è¦ä¸¤ä¸ª ASCIIï¼Œä¸€ä¸ªè¡¨ç¤º 1ï¼Œä¸€ä¸ªè¡¨ç¤º 0ã€‚å› æ­¤ï¼Œä¼ ç»™<code>sys_write</code>ä¸€ä¸ª'4948'æ‰æ˜¯æ•°å­— 10 çš„æ­£ç¡®å­—ç¬¦ä¸²å½¢å¼ã€‚10 ç›´æ¥åŠ  48 ä¸è¡Œï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•°å­—çš„æ¯ä¸€ä½é™¤ä»¥ 10 åé€ä¸ªè½¬æ¢</p>
<p>è¿™é‡Œå¼•å…¥ä¸¤ä¸ªæ–°çš„å­ä¾‹ç¨‹ï¼Œ<code>iprint</code>å’Œ<code>iprintLF</code>ã€‚è¿™äº›å‡½æ•°ç”¨æ¥æ‰“å°æ•°å­—çš„å­—ç¬¦ä¸²å½¢å¼ï¼Œæ•°å€¼æœ¬èº«ä½¿ç”¨<code>EAX</code>è£…è½½ï¼Œ<code>ECX</code>ç”¨æ¥è®¡æ•°ã€‚ç„¶åé‡å¤é™¤ä»¥ 10 çš„è¿‡ç¨‹ï¼Œæ¯æ¬¡æŠŠä½™æ•°åŠ  48ï¼Œç»“æœå€¼<code>PUSH</code>åˆ°æ ˆä¸Šä»¥å¤‡åç”¨ã€‚å½“é™¤ä»¥ 10 çš„å•†(å­˜åœ¨<code>EAX</code>é‡Œ)ä¸º 0 æ—¶ï¼Œå°†é€€å‡ºå½“å‰å¾ªç¯ï¼Œè¿›å…¥å¦ä¸€ä¸ªå¾ªç¯ã€‚åœ¨è¯¥å¾ªç¯é‡Œæˆ‘ä»¬é€šè¿‡é€ä¸ª<code>POP</code>å¼¹æ ˆçš„æ–¹æ³•ï¼Œæ‰“å°æ¯ä¸€ä½æ•°å­—çš„å­—ç¬¦ä¸²å½¢å¼ã€‚å¼¹åˆ°ä»€ä¹ˆæ—¶å€™ä¸ºæ­¢å‘¢ï¼Ÿè¿™æ­£æ˜¯æˆ‘ä»¬åœ¨<code>ECX</code>å¯„å­˜å™¨é‡Œå­˜è®¡æ•°çš„ç›®çš„ï¼Œæ¯å¼¹ä¸€ä¸ªå€¼<code>ECX</code>å°±å‡ 1ï¼Œç›´åˆ°å‡åˆ° 0ã€‚æ‰€æœ‰çš„è¿™äº›éƒ½å®Œæˆåï¼Œç¨‹åºé€€å‡ºã€‚</p>
<p><strong>é™¤æ³•æŒ‡ä»¤ç®€ä»‹</strong></p>
<p><code>DIV</code>å’Œ<code>IDIV</code>æŒ‡ä»¤å°†<code>EAX</code>ä¸­çš„å€¼åšä¸ºè¢«é™¤æ•°ï¼Œé™¤ä»¥æŒ‡ä»¤çš„åŸæ“ä½œæ•°ï¼Œå•†çš„éƒ¨åˆ†å­˜åˆ°<code>EAX</code>(è¦†ç›–äº†åŸæ¥çš„è¢«é™¤æ•°)è€Œä½™æ•°éƒ¨åˆ†å­˜åœ¨<code>EDX</code>ä¸­ã€‚(ä½œè€…å†™çš„æŒºç®€å•ï¼Œå®ç°ä¸Šå¤æ‚çš„å¤šï¼šä¸åŒä½æ•°çš„ç­–ç•¥ï¼›é«˜ä½å­˜ä»€ä¹ˆã€ä½ä½å­˜ä»€ä¹ˆï¼›æœ‰ç¬¦å·ã€æ— ç¬¦å·çš„åŒºåˆ«ç­‰ç­‰ã€‚)</p>
<p>æ¯”å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln">1</span><span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">10</span>         <span class="c1">; move 10 into eax</span>
<span class="ln">2</span><span class="nf">mov</span>     <span class="nb">esi</span><span class="p">,</span> <span class="mi">10</span>         <span class="c1">; move 10 into esi</span>
<span class="ln">3</span><span class="nf">idiv</span>    <span class="nb">esi</span>             <span class="c1">; divide eax by esi (eax will equal 1 and edx will equal 0)</span>
<span class="ln">4</span><span class="nf">idiv</span>    <span class="nb">esi</span>             <span class="c1">; divide eax by esi again (eax will equal 0 and edx will equal 1)</span>
</code></pre></div><p><strong>åªå­˜ä½™æ•°ï¼Œæ„Ÿè§‰ä¼šæœ‰é—®é¢˜ï¼Ÿ</strong></p>
<p>ä¸ä¼šï¼Œå› ä¸ºè¿™äº›éƒ½æ˜¯æ•´æ•°ã€‚å³ä¾¿é™¤æ•°æ¯”è¢«é™¤æ•°å¤§ï¼Œä¾ç„¶èƒ½å¤Ÿåœ¨ä½™æ•°ä¸­æ‰¾åˆ°å…¶åŸå€¼ï¼Œè¿™æ˜¯å› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹<code>EAX</code>ç½® 0ï¼Œé™¤æ³•è¿ç®—è¿è¡Œäº† 0 æ¬¡ï¼Œè€Œè¢«é™¤æ•°çš„åŸå€¼ä½œä¸ºä½™æ•°è¢«æ”¾åˆ°äº†<code>EDX</code>ä¸­ã€‚çœŸå¥½~</p>
<h3 id="æˆ‘ä»¬çš„ç¬¬æ‹¾å£¹ä¸ªæ±‡ç¼–ç¨‹åºçŸ¥ä¹‹éè‰°">æˆ‘ä»¬çš„ç¬¬æ‹¾å£¹ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”çŸ¥ä¹‹éè‰°</h3>

<div class="notices note">
    <div class="label">æ³¨æ„</div>
    <p>ä»…åˆ—å‡ºäº†æ–°å‡½æ•°çš„æ³¨é‡Š</p>

  </div>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln">  1</span><span class="c1">;------------------------------------------</span>
<span class="ln">  2</span><span class="c1">; void iprint(Integer number)</span>
<span class="ln">  3</span><span class="c1">; Integer printing function (itoa)</span>
<span class="ln">  4</span><span class="nl">iprint:</span>
<span class="ln">  5</span>    <span class="nf">push</span>    <span class="nb">eax</span>             <span class="c1">; preserve eax on the stack to be restored after function runs</span>
<span class="ln">  6</span>    <span class="nf">push</span>    <span class="nb">ecx</span>             <span class="c1">; preserve ecx on the stack to be restored after function runs</span>
<span class="ln">  7</span>    <span class="nf">push</span>    <span class="nb">edx</span>             <span class="c1">; preserve edx on the stack to be restored after function runs</span>
<span class="ln">  8</span>    <span class="nf">push</span>    <span class="nb">esi</span>             <span class="c1">; preserve esi on the stack to be restored after function runs</span>
<span class="ln">  9</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; counter of how many bytes we need to print in the end</span>
<span class="ln"> 10</span> 
<span class="ln"> 11</span><span class="nl">divideLoop:</span>
<span class="ln"> 12</span>    <span class="nf">inc</span>     <span class="nb">ecx</span>             <span class="c1">; count each byte to print - number of characters</span>
<span class="ln"> 13</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; empty edx</span>
<span class="ln"> 14</span>    <span class="nf">mov</span>     <span class="nb">esi</span><span class="p">,</span> <span class="mi">10</span>         <span class="c1">; mov 10 into esi</span>
<span class="ln"> 15</span>    <span class="nf">idiv</span>    <span class="nb">esi</span>             <span class="c1">; divide eax by esi</span>
<span class="ln"> 16</span>    <span class="nf">add</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">48</span>         <span class="c1">; convert edx to it&#39;s ascii representation - edx holds the remainder after a divide instruction</span>
<span class="ln"> 17</span>    <span class="nf">push</span>    <span class="nb">edx</span>             <span class="c1">; push edx (string representation of an intger) onto the stack</span>
<span class="ln"> 18</span>    <span class="nf">cmp</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; can the integer be divided anymore?</span>
<span class="ln"> 19</span>    <span class="nf">jnz</span>     <span class="nb">di</span><span class="nv">videLoop</span>      <span class="c1">; jump if not zero to the label divideLoop</span>
<span class="ln"> 20</span> 
<span class="ln"> 21</span><span class="nl">printLoop:</span>
<span class="ln"> 22</span>    <span class="nf">dec</span>     <span class="nb">ecx</span>             <span class="c1">; count down each byte that we put on the stack</span>
<span class="ln"> 23</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">esp</span>        <span class="c1">; mov the stack pointer into eax for printing</span>
<span class="ln"> 24</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>          <span class="c1">; call our string print function</span>
<span class="ln"> 25</span>    <span class="nf">pop</span>     <span class="nb">eax</span>             <span class="c1">; remove last character from the stack to move esp forward</span>
<span class="ln"> 26</span>    <span class="nf">cmp</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; have we printed all bytes we pushed onto the stack?</span>
<span class="ln"> 27</span>    <span class="nf">jnz</span>     <span class="nv">printLoop</span>       <span class="c1">; jump is not zero to the label printLoop</span>
<span class="ln"> 28</span> 
<span class="ln"> 29</span>    <span class="nf">pop</span>     <span class="nb">esi</span>             <span class="c1">; restore esi from the value we pushed onto the stack at the start</span>
<span class="ln"> 30</span>    <span class="nf">pop</span>     <span class="nb">edx</span>             <span class="c1">; restore edx from the value we pushed onto the stack at the start</span>
<span class="ln"> 31</span>    <span class="nf">pop</span>     <span class="nb">ecx</span>             <span class="c1">; restore ecx from the value we pushed onto the stack at the start</span>
<span class="ln"> 32</span>    <span class="nf">pop</span>     <span class="nb">eax</span>             <span class="c1">; restore eax from the value we pushed onto the stack at the start</span>
<span class="ln"> 33</span>    <span class="nf">ret</span>
<span class="ln"> 34</span> 
<span class="ln"> 35</span> 
<span class="ln"> 36</span><span class="c1">;------------------------------------------</span>
<span class="ln"> 37</span><span class="c1">; void iprintLF(Integer number)</span>
<span class="ln"> 38</span><span class="c1">; Integer printing function with linefeed (itoa)</span>
<span class="ln"> 39</span><span class="nl">iprintLF:</span>
<span class="ln"> 40</span>    <span class="nf">call</span>    <span class="nv">iprint</span>          <span class="c1">; call our integer printing function</span>
<span class="ln"> 41</span> 
<span class="ln"> 42</span>    <span class="nf">push</span>    <span class="nb">eax</span>             <span class="c1">; push eax onto the stack to preserve it while we use the eax register in this function</span>
<span class="ln"> 43</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mh">0Ah</span>        <span class="c1">; move 0Ah into eax - 0Ah is the ascii character for a linefeed</span>
<span class="ln"> 44</span>    <span class="nf">push</span>    <span class="nb">eax</span>             <span class="c1">; push the linefeed onto the stack so we can get the address</span>
<span class="ln"> 45</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">esp</span>        <span class="c1">; move the address of the current stack pointer into eax for sprint</span>
<span class="ln"> 46</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>          <span class="c1">; call our sprint function</span>
<span class="ln"> 47</span>    <span class="nf">pop</span>     <span class="nb">eax</span>             <span class="c1">; remove our linefeed character from the stack</span>
<span class="ln"> 48</span>    <span class="nf">pop</span>     <span class="nb">eax</span>             <span class="c1">; restore the original value of eax before our function was called</span>
<span class="ln"> 49</span>    <span class="nf">ret</span>
<span class="ln"> 50</span> 
<span class="ln"> 51</span> 
<span class="ln"> 52</span><span class="c1">;------------------------------------------</span>
<span class="ln"> 53</span><span class="c1">; int slen(String message)</span>
<span class="ln"> 54</span><span class="c1">; String length calculation function</span>
<span class="ln"> 55</span><span class="nl">slen:</span>
<span class="ln"> 56</span>    <span class="nf">push</span>    <span class="nb">ebx</span>
<span class="ln"> 57</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">eax</span>
<span class="ln"> 58</span> 
<span class="ln"> 59</span><span class="nl">nextchar:</span>
<span class="ln"> 60</span>    <span class="nf">cmp</span>     <span class="kt">byte</span> <span class="p">[</span><span class="nb">eax</span><span class="p">],</span> <span class="mi">0</span>
<span class="ln"> 61</span>    <span class="nf">jz</span>      <span class="nv">finished</span>
<span class="ln"> 62</span>    <span class="nf">inc</span>     <span class="nb">eax</span>
<span class="ln"> 63</span>    <span class="nf">jmp</span>     <span class="nv">nextchar</span>
<span class="ln"> 64</span> 
<span class="ln"> 65</span><span class="nl">finished:</span>
<span class="ln"> 66</span>    <span class="nf">sub</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">ebx</span>
<span class="ln"> 67</span>    <span class="nf">pop</span>     <span class="nb">ebx</span>
<span class="ln"> 68</span>    <span class="nf">ret</span>
<span class="ln"> 69</span> 
<span class="ln"> 70</span> 
<span class="ln"> 71</span><span class="c1">;------------------------------------------</span>
<span class="ln"> 72</span><span class="c1">; void sprint(String message)</span>
<span class="ln"> 73</span><span class="c1">; String printing function</span>
<span class="ln"> 74</span><span class="nl">sprint:</span>
<span class="ln"> 75</span>    <span class="nf">push</span>    <span class="nb">edx</span>
<span class="ln"> 76</span>    <span class="nf">push</span>    <span class="nb">ecx</span>
<span class="ln"> 77</span>    <span class="nf">push</span>    <span class="nb">ebx</span>
<span class="ln"> 78</span>    <span class="nf">push</span>    <span class="nb">eax</span>
<span class="ln"> 79</span>    <span class="nf">call</span>    <span class="nv">slen</span>
<span class="ln"> 80</span> 
<span class="ln"> 81</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="nb">eax</span>
<span class="ln"> 82</span>    <span class="nf">pop</span>     <span class="nb">eax</span>
<span class="ln"> 83</span> 
<span class="ln"> 84</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">eax</span>
<span class="ln"> 85</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln"> 86</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>
<span class="ln"> 87</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln"> 88</span> 
<span class="ln"> 89</span>    <span class="nf">pop</span>     <span class="nb">ebx</span>
<span class="ln"> 90</span>    <span class="nf">pop</span>     <span class="nb">ecx</span>
<span class="ln"> 91</span>    <span class="nf">pop</span>     <span class="nb">edx</span>
<span class="ln"> 92</span>    <span class="nf">ret</span>
<span class="ln"> 93</span> 
<span class="ln"> 94</span> 
<span class="ln"> 95</span><span class="c1">;------------------------------------------</span>
<span class="ln"> 96</span><span class="c1">; void sprintLF(String message)</span>
<span class="ln"> 97</span><span class="c1">; String printing with line feed function</span>
<span class="ln"> 98</span><span class="nl">sprintLF:</span>
<span class="ln"> 99</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>
<span class="ln">100</span> 
<span class="ln">101</span>    <span class="nf">push</span>    <span class="nb">eax</span>
<span class="ln">102</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mh">0AH</span>
<span class="ln">103</span>    <span class="nf">push</span>    <span class="nb">eax</span>
<span class="ln">104</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln">105</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>
<span class="ln">106</span>    <span class="nf">pop</span>     <span class="nb">eax</span>
<span class="ln">107</span>    <span class="nf">pop</span>     <span class="nb">eax</span>
<span class="ln">108</span>    <span class="nf">ret</span>
<span class="ln">109</span> 
<span class="ln">110</span> 
<span class="ln">111</span><span class="c1">;------------------------------------------</span>
<span class="ln">112</span><span class="c1">; void exit()</span>
<span class="ln">113</span><span class="c1">; Exit program and restore resources</span>
<span class="ln">114</span><span class="nl">quit:</span>
<span class="ln">115</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">0</span>
<span class="ln">116</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln">117</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">118</span>    <span class="nf">ret</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Hello World Program (Count to 10 itoa)</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf helloworld-itoa.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 helloworld-itoa.o -o helloworld-itoa</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./helloworld-itoa</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln"> 9</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="nl">_start:</span>
<span class="ln">12</span> 
<span class="ln">13</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0</span>
<span class="ln">14</span> 
<span class="ln">15</span><span class="nl">nextNumber:</span>
<span class="ln">16</span>    <span class="nf">inc</span>     <span class="nb">ecx</span>
<span class="ln">17</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">ecx</span>
<span class="ln">18</span>    <span class="nf">call</span>    <span class="nv">iprintLF</span>        <span class="c1">; NOTE call our new integer printing function (itoa)</span>
<span class="ln">19</span>    <span class="nf">cmp</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">10</span>
<span class="ln">20</span>    <span class="nf">jne</span>     <span class="nv">nextNumber</span>
<span class="ln">21</span> 
<span class="ln">22</span>    <span class="nf">call</span>    <span class="nv">quit</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln"> 1</span>$ nasm -f elf helloworld-itoa.asm
<span class="ln"> 2</span>$ ld -m elf_i386 helloworld-itoa.o -o helloworld-itoa
<span class="ln"> 3</span>$ ./helloworld-itoa
<span class="ln"> 4</span><span class="m">1</span>
<span class="ln"> 5</span><span class="m">2</span>
<span class="ln"> 6</span><span class="m">3</span>
<span class="ln"> 7</span><span class="m">4</span>
<span class="ln"> 8</span><span class="m">5</span>
<span class="ln"> 9</span><span class="m">6</span>
<span class="ln">10</span><span class="m">7</span>
<span class="ln">11</span><span class="m">8</span>
<span class="ln">12</span><span class="m">9</span>
<span class="ln">13</span><span class="m">10</span>
</code></pre></div><hr>
<h2 id="lesson-12-è®¡ç®—åŠ æ³•">Lesson 12 è®¡ç®—â€”â€”åŠ æ³•</h2>
<p>è¿™æ¬¡çš„ç¨‹åºï¼Œå°†å¯„å­˜å™¨<code>EAX</code>å’Œ<code>EBX</code>ä¸­çš„å€¼ç›¸åŠ ï¼Œå’Œä¿å­˜åœ¨<code>EAX</code>ä¸­ã€‚é¦–å…ˆ<code>MOV</code>å…¶ä¸­ä¸€ä¸ªåŠ æ•°åˆ°<code>EAX</code>(æœ¬ä¾‹ä¸­ä¸º 90)ï¼Œç„¶å<code>MOV</code>å¦ä¸€ä¸ªåŠ æ•°åˆ°<code>EBX</code>(æœ¬ä¾‹ä¸­ä¸º9)ã€‚æˆ‘ä»¬éœ€è¦è°ƒç”¨<code>ADD</code>æŒ‡ä»¤æ¥å®ç°åŠ æ³•è¿ç®—ã€‚<code>EBX</code>å’Œ<code>EAX</code>ä¸­çš„å€¼å°†è¢«åŠ åˆ°ä¸€èµ·ï¼Œè€Œç»“æœå’Œå°†è¢«å­˜å›æŒ‡ä»¤æœ€å·¦è¾¹çš„å¯„å­˜å™¨ä¸­(ä¹Ÿå°±æ˜¯æœ¬ä¾‹çš„<code>EAX</code>)ã€‚æœ€åè°ƒç”¨æˆ‘ä»¬å¼•ä»¥ä¸ºå‚²çš„<code>æ•°å€¼-&gt;å­—ç¬¦ä¸²</code>æ‰“å°å‡½æ•°æ¥å®Œæˆç¨‹åºã€‚</p>
<h3 id="æˆ‘ä»¬çš„ç¬¬æ‹¾è´°ä¸ªæ±‡ç¼–ç¨‹åºèšæ²™æˆå¡”">æˆ‘ä»¬çš„ç¬¬æ‹¾è´°ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”èšæ²™æˆå¡”</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Calculator (Addition)</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf calculator-addition.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 calculator-addition.o -o calculator-addition</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./calculator-addition</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln"> 9</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="nl">_start:</span>
<span class="ln">12</span> 
<span class="ln">13</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">90</span>     <span class="c1">; move our first number into eax</span>
<span class="ln">14</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">9</span>      <span class="c1">; move our second number into ebx</span>
<span class="ln">15</span>    <span class="nf">add</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">ebx</span>    <span class="c1">; add ebx to eax</span>
<span class="ln">16</span>    <span class="nf">call</span>    <span class="nv">iprintLF</span>    <span class="c1">; call our integer print with linefeed function</span>
<span class="ln">17</span> 
<span class="ln">18</span>    <span class="nf">call</span>    <span class="nv">quit</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf calculator-addition.asm
<span class="ln">2</span>$ ld -m elf_i386 calculator-addition.o -o calculator-addition
<span class="ln">3</span>$ ./calculator-addition
<span class="ln">4</span><span class="m">99</span>
</code></pre></div><hr>
<h2 id="lesson-13-è®¡ç®—å‡æ³•">Lesson 13 è®¡ç®—â€”â€”å‡æ³•</h2>
<p>è¿™ä¸ªç¨‹åºä¸ Lesson 12 çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯åŠ æ³•æŒ‡ä»¤<code>ADD</code>ï¼Œæ¢æˆäº†å‡æ³•æŒ‡ä»¤<code>SUB</code></p>
<h3 id="æˆ‘ä»¬çš„ç¬¬æ‹¾åä¸ªæ±‡ç¼–ç¨‹åºçº¢è¡°ç¿ å‡">æˆ‘ä»¬çš„ç¬¬æ‹¾åä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”çº¢è¡°ç¿ å‡</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Calculator (Subtraction)</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf calculator-subtraction.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 calculator-subtraction.o -o calculator-subtraction</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./calculator-subtraction</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln"> 9</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="nl">_start:</span>
<span class="ln">12</span> 
<span class="ln">13</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">90</span>     <span class="c1">; move our first number into eax</span>
<span class="ln">14</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">9</span>      <span class="c1">; move our second number into ebx</span>
<span class="ln">15</span>    <span class="nf">sub</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">ebx</span>    <span class="c1">; subtract ebx from eax</span>
<span class="ln">16</span>    <span class="nf">call</span>    <span class="nv">iprintLF</span>    <span class="c1">; call our integer print with linefeed function</span>
<span class="ln">17</span> 
<span class="ln">18</span>    <span class="nf">call</span>    <span class="nv">quit</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf calculator-subtraction.asm
<span class="ln">2</span>$ ld -m elf_i386 calculator-subtraction.o -o calculator-subtraction
<span class="ln">3</span>$ ./calculator-subtraction
<span class="ln">4</span><span class="m">81</span>
</code></pre></div><hr>
<h2 id="lesson-14-è®¡ç®—ä¹˜æ³•">Lesson 14 è®¡ç®—â€”â€”ä¹˜æ³•</h2>
<p>åœ¨æœ¬ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å°†ç”¨<code>EBX</code>ä¸­çš„å€¼ä¸<code>EAX</code>ä¸­çš„å€¼ç›¸ä¹˜ã€‚ä¸¤ä¸ªæ•´æ•°æŒ‰ç…§å’Œ Lesson 12 ä¸€æ ·çš„æ–¹å¼åˆ†åˆ«å­˜å…¥ä¸¤ä¸ªå¯„å­˜å™¨ã€‚è¿™æ¬¡çš„æŒ‡ä»¤ä¸»è§’æ˜¯<code>MUL</code>ï¼Œä»–æ˜¯ NASM ä¸­ä¸ºæ•°ä¸å¤šçš„å‡ ä¸ªå•æ“ä½œæ•°æŒ‡ä»¤ä¹‹ä¸€ã€‚<code>MUL</code>æŒ‡ä»¤æ€»æ˜¯å°†å…¶æ“ä½œæ•°ä¸EAXä¸­çš„å€¼ç›¸ä¹˜ï¼Œå¹¶å°†ç§¯å­˜å›<code>EAX</code></p>
<h3 id="æˆ‘ä»¬çš„ç¬¬æ‹¾è‚†ä¸ªæ±‡ç¼–ç¨‹åºä¸€ç™»é¾™é—¨">æˆ‘ä»¬çš„ç¬¬æ‹¾è‚†ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”ä¸€ç™»é¾™é—¨</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Calculator (Multiplication)</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf calculator-multiplication.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 calculator-multiplication.o -o calculator-multiplication</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./calculator-multiplication</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln"> 9</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="nl">_start:</span>
<span class="ln">12</span> 
<span class="ln">13</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">90</span>     <span class="c1">; move our first number into eax</span>
<span class="ln">14</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">9</span>      <span class="c1">; move our second number into ebx</span>
<span class="ln">15</span>    <span class="nf">mul</span>     <span class="nb">ebx</span>         <span class="c1">; multiply eax by ebx</span>
<span class="ln">16</span>    <span class="nf">call</span>    <span class="nv">iprintLF</span>    <span class="c1">; call our integer print with linefeed function</span>
<span class="ln">17</span> 
<span class="ln">18</span>    <span class="nf">call</span>    <span class="nv">quit</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf calculator-multiplication.asm
<span class="ln">2</span>$ ld -m elf_i386 calculator-multiplication.o -o calculator-multiplication
<span class="ln">3</span>$ ./calculator-multiplication
<span class="ln">4</span><span class="m">810</span>
</code></pre></div><hr>
<h2 id="lesson-15-è®¡ç®—é™¤æ³•">Lesson 15 è®¡ç®—â€”â€”é™¤æ³•</h2>
<p>é™¤æ³•æŒ‡ä»¤æˆ‘ä»¬å·²ç»è§è¯†è¿‡äº†ï¼Œæˆ‘ä»¬æ›¾ç”¨ä»–æ¥å®ç°æ•°å­—å€¼åˆ° ASCII ç çš„è½¬æ¢ã€‚æœ¬ä¾‹ä¸­ï¼Œä¾ç„¶ä½¿ç”¨<code>EAX</code>å’Œ<code>EBX</code>ã€‚ä»–ä»¬åˆ†åˆ«ä¿å­˜è¢«é™¤æ•°å’Œé™¤æ•°ã€‚å¦‚å‰æ‰€è¿°ï¼Œ<code>DIV</code>æŒ‡ä»¤çš„è¡Œä¸ºå¦‚ä¸‹ï¼šç”¨å…¶æ“ä½œæ•°å»é™¤<code>EAX</code>ä¸­çš„å€¼ï¼Œå•†ä¿å­˜åˆ°<code>EAX</code>ï¼Œè€Œä½™æ•°ä¿å­˜åˆ°<code>EDX</code>ã€‚æœ€åå°†å•†å’Œä½™æ•°éƒ½æ‰“å°å‡ºæ¥</p>
<h3 id="åˆè§é™¤æ³•çš„ç¬¬æ‹¾ä¼ä¸ªæ±‡ç¼–ç¨‹åºç»åˆ†ä¹‹æœ¯">åˆè§é™¤æ³•çš„ç¬¬æ‹¾ä¼ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”ç»åˆ†ä¹‹æœ¯</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Calculator (Division)</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf calculator-division.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 calculator-division.o -o calculator-division</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./calculator-division</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">msg1</span>        <span class="nv">db</span>      <span class="s">&#39; remainder &#39;</span>      <span class="c1">; a message string to correctly output result</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">12</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">13</span> 
<span class="ln">14</span><span class="nl">_start:</span>
<span class="ln">15</span> 
<span class="ln">16</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">90</span>     <span class="c1">; move our first number into eax</span>
<span class="ln">17</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">9</span>      <span class="c1">; move our second number into ebx</span>
<span class="ln">18</span>    <span class="nf">div</span>     <span class="nb">ebx</span>         <span class="c1">; divide eax by ebx</span>
<span class="ln">19</span>    <span class="nf">call</span>    <span class="nv">iprint</span>      <span class="c1">; call our integer print function on the quotient</span>
<span class="ln">20</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg1</span>   <span class="c1">; move our message string into eax</span>
<span class="ln">21</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>      <span class="c1">; call our string print function</span>
<span class="ln">22</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">edx</span>    <span class="c1">; move our remainder into eax</span>
<span class="ln">23</span>    <span class="nf">call</span>    <span class="nv">iprintLF</span>    <span class="c1">; call our integer printing with linefeed function</span>
<span class="ln">24</span> 
<span class="ln">25</span>    <span class="nf">call</span>    <span class="nv">quit</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf calculator-division.asm
<span class="ln">2</span>$ ld -m elf_i386 calculator-division.o -o calculator-division
<span class="ln">3</span>$ ./calculator-division
<span class="ln">4</span><span class="m">10</span> remainder <span class="m">0</span>
</code></pre></div><hr>
<h2 id="lesson-16-è®¡ç®—atoi">Lesson 16 è®¡ç®—â€”â€”atoi</h2>
<p>å°†ç®—æ•°è¿ç®—ä¸­çš„æ•°å€¼å†™æ­»åœ¨ä»£ç é‡Œå¹¶ä¸æ¿€åŠ¨äººå¿ƒï¼Œè¿™æ¬¡æˆ‘ä»¬è¦ä»å‘½ä»¤è¡Œå‚æ•°ä¸­åŠ¨æ€è·å–å˜åŒ–çš„æ•°å€¼ï¼</p>
<p><strong>ç¨‹åºæ­¥éª¤</strong></p>
<ul>
<li>æˆ‘ä»¬å…ˆç”¨<code>POP</code>ä»æ ˆä¸Šè·å¾—å‘½ä»¤è¡Œå‚æ•°çš„ä¸ªæ•°ï¼Œå¹¶ä¿å­˜åœ¨<code>ECX</code>å¯„å­˜å™¨ï¼›ç„¶åç»§ç»­<code>POP</code>å‡ºå‘½ä»¤çš„åç§°ï¼Œä»<code>ECX</code>ä¸­å»æ‰ä»–çš„è®¡æ•°ï¼›éšåå¾ªç¯çš„å¼¹å‡ºæ¯ä¸ªå‚æ•°å¹¶æ‰§è¡ŒåŠ æ³•é€»è¾‘ã€‚</li>
<li>å’Œè¾“å‡ºä¸€æ ·ï¼Œè¾“å…¥ç»™æˆ‘ä»¬çš„ä¹Ÿéƒ½æ˜¯å­—ç¬¦ä¸²ã€‚åœ¨è¿›è¡ŒåŠ æ³•è¿ç®—å‰ï¼Œéœ€è¦ä¸€ä¸ªå’Œè¾“å‡ºæ—¶ç›¸åçš„è½¬æ¢æ“ä½œï¼šASCII ç -&gt;æ•°å­—å€¼ï¼Œæ²¡æœ‰è¿™ä¸ªæ­¥éª¤åŠ æ³•çš„ç»“æœå°†ä¸æ­£ç¡®ã€‚</li>
<li>è¿™ä¸ªè½¬æ¢æ“ä½œç”±å¼•å…¥çš„å­ä¾‹ç¨‹ Ascii to Integer(atoi) æ¥å®Œæˆã€‚è¿™ä¸ªå‡½æ•°å°† ASCII ç å€¼å¯¹åº”çš„æ•°å­—ä¿å­˜åœ¨<code>EAX</code>å¯„å­˜å™¨ã€‚æ¯æ¬¡æˆ‘ä»¬éƒ½æŠŠ<code>EAX</code>çš„å€¼åŠ åˆ°<code>EDX</code>é‡Œå»ã€‚å¦‚æœä¼ é€’ç»™æˆ‘ä»¬çš„ ASCII ç ä¸æ˜¯è¡¨ç¤º 0-9 é‚£æ˜¯ä¸ªæ•°å­—çš„ï¼Œå°±ç”¨ 0 æ›¿ä»£ä»–ã€‚</li>
<li>æ‰€æœ‰å‚æ•°éƒ½ç»è¿‡è½¬æ¢å¹¶åŠ åˆ°ä¸€èµ·åï¼Œæ‰“å°å’Œå¹¶é€€å‡º</li>
</ul>
<p><strong>atoi åŸç†</strong></p>
<p>å°† ASCII ç è½¬ä¸ºæ•´æ•°å¹¶éæ˜“äº‹ã€‚è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰æ˜¯æ€ä¹ˆæŠŠæ•´æ•°è½¬æˆ ASCII ç çš„ï¼Ÿç°åœ¨ç„¶è¦è¿›è¡Œå…¶é€†è¿ç®—ã€‚</p>
<p>é¦–å…ˆï¼Œå°†å­—ç¬¦ä¸²çš„åœ°å€ç§»å…¥<code>ESI</code>(è‘—åçš„æºå€å¯„å­˜å™¨)ï¼›ç„¶åï¼Œé€å­—èŠ‚çš„éå†å­—ç¬¦ä¸²(è¯•ç€å°†æ¯ä¸ªå­—èŠ‚çœ‹åšæ˜¯ä¸€ä¸ªæ•°å­—æˆ–åè¿›åˆ¶ä½)ã€‚å¯¹äºæ¯ä¸ªæ•°å­—ï¼Œæ£€æµ‹å…¶å€¼æ˜¯å¦ä»‹äº 48 åˆ° 57 ä¹‹é—´( 0-9 çš„ ASCII ç )ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œå°±æ‰§è¡Œä»¥ä¸‹é€»è¾‘ï¼š</p>
<p>ç å€¼å‡å» 48â€”â€”å¾—åˆ°è¯¥ç å€¼æ‰€è¡¨ç¤ºçš„æ•°å­—çš„åè¿›åˆ¶æ•´æ•°å€¼ï¼Œè¿™ä¸ªå€¼å­˜å…¥<code>EAX</code>ï¼Œç„¶å<code>EAX</code>ä¹˜ä»¥ 10ï¼Œéšç€å¾ªç¯çš„è¿›è¡Œï¼Œæ¯ä¸€ä½çš„ä½æƒéƒ½åœ¨éšç€ä¹˜ä»¥ 10 è€Œæå‡ï¼Œä»è€Œå½’åˆ°å…¶æ‰€å çš„ä½ä¸Šã€‚</p>
<p>å½“æ‰€æœ‰çš„å­—èŠ‚éƒ½æŒ‰ç…§ä¸Šé¢çš„é€»è¾‘å¤„ç†å®Œæˆï¼Œè¿”å›ç»“æœå€¼ä¹‹å‰ï¼Œè¿˜è¦è¿›å…¥æœ€åçš„ä¸€æ­¥ï¼šç”±äºæœ€åä¸€ä½æ•°å­—æ˜¯ä¸ªä½æ•°ï¼Œä»–ä¸åº”è¯¥ä¹˜ä»¥ 10ï¼Œä½†é¢çš„é€»è¾‘å´è¿™æ ·åšäº†ã€‚æˆ‘ä»¬éœ€è¦ç®€å•çš„é™¤ä»¥ä¸€æ¬¡ 10 æ¥çº æ­£è¿™ä¸ªé”™è¯¯ã€‚å½“ç„¶ï¼Œå¦‚æœä¼ é€’ç»™ç¨‹åºçš„å‚æ•°ä¸æ˜¯æ•´æ•°ï¼Œè¿™ä¸ªé™¤æ³•æ“ä½œå°±çœç•¥æ‰ã€‚</p>
<p><strong>æ¥ä¸‹æ¥çš„ç¨‹åºä¸­ä½¿ç”¨äº† BL å¯„å­˜å™¨ï¼Œè¿™é‡Œç®€å•è¯´ä¸‹</strong></p>
<p>é€šç”¨å¯„å­˜å™¨çš„ä¸ªæ•°å°±æ²¡æ€ä¹ˆå˜è¿‡ï¼Œä½†æ˜¯å…¶ä½æ•°å´ä¸€æ‰©å†æ‰©ä»¥æé«˜CPUçš„è®¡ç®—èƒ½åŠ›ã€‚æ±‡ç¼–æŒ‡ä»¤ä¸­å†™<code>BL</code>çš„æ„æ€æ˜¯ï¼Œä½¿ç”¨32ä½<code>EBX</code>å¯„å­˜å™¨çš„<code>ä½8ä½</code>ï¼Œå› ä¸ºå•ä¸ª ASCII ç å€¼åªéœ€è¦ä¸€ä¸ªå­—èŠ‚å°±å¯ä»¥æ”¾ä¸‹ã€‚å¦‚æœä½¿ç”¨æ•´ä¸ª32ä½å¯„å­˜å™¨æ¥å­˜å‚¨è¿™ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œé‚£ä¹ˆå…¶ä¸­çš„24ä½éƒ½å¯¹æˆ‘ä»¬æ¯«æ— æ„ä¹‰ã€‚</p>
<p>å¯¹äº<code>EBX</code>ï¼Œå…¶<code>0-16bits</code>æ®µç§°ä¸º<code>BX</code>ï¼Œè€Œ<code>BX</code>åˆ™åŒ…å«<code>BL</code>å’Œ<code>BH</code>(ä½8ä½ï¼Œé«˜8ä½)ï¼Œæ˜¾ç„¶æˆ‘ä»¬åªéœ€è¦<code>BL</code>ã€‚</p>
<p>æ­£å‘çš„å­¦ä¹ æ±‡ç¼–ï¼Œå¾€å¾€ä»å¤´å¼€å§‹æ£å¯„å­˜å™¨çš„å†å²ï¼Œåç§°çš„å«ä¹‰å’Œä½çš„å¤§å°ç­‰ç­‰ã€‚æœ¬æ•™ç¨‹æ˜¯åå‘çš„ï¼Œé€šè¿‡ç¨‹åºä¸­ç”¨åˆ°çš„å¿…è¦å…ƒç´ æ¥è¿½æº¯å…³é”®çš„æ¦‚å¿µå’ŒåŸç†ã€‚å®Œæ•´çš„å¯„å­˜å™¨çŸ¥è¯†è¶…å‡ºäº†æœ¬æ•™ç¨‹çš„èŒƒå›´ï¼Œä½†ä¹‹åçš„ç¯‡ç« å°†ç»§ç»­è®¨è®ºï¼Œæ¯•ç«Ÿå†™æ±‡ç¼–å˜›ï¼Œæˆ‘ä»¬ç»•ä¸è¿‡å¯„å­˜å™¨å» :-)</p>
<h3 id="æ¬¢è¿æˆ‘ä»¬çš„ç¬¬æ‹¾é™†ä¸ªæ±‡ç¼–ç¨‹åºåæœ´å½’çœŸ">æ¬¢è¿æˆ‘ä»¬çš„ç¬¬æ‹¾é™†ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”åæœ´å½’çœŸ</h3>

<div class="notices note">
    <div class="label">æ³¨æ„</div>
    <p>funcitons.asm åªåˆ—å‡ºäº†æ–°å¼•å…¥çš„ atoi å­ä¾‹ç¨‹çš„ä»£ç </p>

  </div>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">;------------------------------------------</span>
<span class="ln"> 2</span><span class="c1">; int atoi(Integer number)</span>
<span class="ln"> 3</span><span class="c1">; Ascii to integer function (atoi)</span>
<span class="ln"> 4</span><span class="nl">atoi:</span>
<span class="ln"> 5</span>    <span class="nf">push</span>    <span class="nb">ebx</span>             <span class="c1">; preserve ebx on the stack to be restored after function runs</span>
<span class="ln"> 6</span>    <span class="nf">push</span>    <span class="nb">ecx</span>             <span class="c1">; preserve ecx on the stack to be restored after function runs</span>
<span class="ln"> 7</span>    <span class="nf">push</span>    <span class="nb">edx</span>             <span class="c1">; preserve edx on the stack to be restored after function runs</span>
<span class="ln"> 8</span>    <span class="nf">push</span>    <span class="nb">esi</span>             <span class="c1">; preserve esi on the stack to be restored after function runs</span>
<span class="ln"> 9</span>    <span class="nf">mov</span>     <span class="nb">esi</span><span class="p">,</span> <span class="nb">eax</span>        <span class="c1">; move pointer in eax into esi (our number to convert)</span>
<span class="ln">10</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; initialise eax with decimal value 0</span>
<span class="ln">11</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; initialise ecx with decimal value 0</span>
<span class="ln">12</span> 
<span class="ln">13</span><span class="nl">.multiplyLoop:</span>
<span class="ln">14</span>    <span class="nf">xor</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">ebx</span>        <span class="c1">; resets both lower and uppper bytes of ebx to be 0</span>
<span class="ln">15</span>    <span class="nf">mov</span>     <span class="nb">bl</span><span class="p">,</span> <span class="p">[</span><span class="nb">esi</span><span class="o">+</span><span class="nb">ecx</span><span class="p">]</span>   <span class="c1">; move a single byte into ebx register&#39;s lower half</span>
<span class="ln">16</span>    <span class="nf">cmp</span>     <span class="nb">bl</span><span class="p">,</span> <span class="mi">48</span>          <span class="c1">; compare ebx register&#39;s lower half value against ascii value 48 (char value 0)</span>
<span class="ln">17</span>    <span class="nf">jl</span>      <span class="nv">.finished</span>       <span class="c1">; jump if less than to label finished</span>
<span class="ln">18</span>    <span class="nf">cmp</span>     <span class="nb">bl</span><span class="p">,</span> <span class="mi">57</span>          <span class="c1">; compare ebx register&#39;s lower half value against ascii value 57 (char value 9)</span>
<span class="ln">19</span>    <span class="nf">jg</span>      <span class="nv">.finished</span>       <span class="c1">; jump if greater than to label finished</span>
<span class="ln">20</span> 
<span class="ln">21</span>    <span class="nf">sub</span>     <span class="nb">bl</span><span class="p">,</span> <span class="mi">48</span>          <span class="c1">; convert ebx register&#39;s lower half to decimal representation of ascii value</span>
<span class="ln">22</span>    <span class="nf">add</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">ebx</span>        <span class="c1">; add ebx to our interger value in eax</span>
<span class="ln">23</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">10</span>         <span class="c1">; move decimal value 10 into ebx</span>
<span class="ln">24</span>    <span class="nf">mul</span>     <span class="nb">ebx</span>             <span class="c1">; multiply eax by ebx to get place value</span>
<span class="ln">25</span>    <span class="nf">inc</span>     <span class="nb">ecx</span>             <span class="c1">; increment ecx (our counter register)</span>
<span class="ln">26</span>    <span class="nf">jmp</span>     <span class="nv">.multiplyLoop</span>   <span class="c1">; continue multiply loop</span>
<span class="ln">27</span> 
<span class="ln">28</span><span class="nl">.finished:</span>
<span class="ln">29</span>    <span class="nf">cmp</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; compare ecx register&#39;s value against decimal 0 (our counter register)</span>
<span class="ln">30</span>    <span class="nf">je</span>      <span class="nv">.restore</span>        <span class="c1">; jump if equal to 0 (no integer arguments were passed to atoi)</span>
<span class="ln">31</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">10</span>         <span class="c1">; move decimal value 10 into ebx</span>
<span class="ln">32</span>    <span class="nf">div</span>     <span class="nb">ebx</span>             <span class="c1">; divide eax by value in ebx (in this case 10)</span>
<span class="ln">33</span> 
<span class="ln">34</span><span class="nl">.restore:</span>
<span class="ln">35</span>    <span class="nf">pop</span>     <span class="nb">esi</span>             <span class="c1">; restore esi from the value we pushed onto the stack at the start</span>
<span class="ln">36</span>    <span class="nf">pop</span>     <span class="nb">edx</span>             <span class="c1">; restore edx from the value we pushed onto the stack at the start</span>
<span class="ln">37</span>    <span class="nf">pop</span>     <span class="nb">ecx</span>             <span class="c1">; restore ecx from the value we pushed onto the stack at the start</span>
<span class="ln">38</span>    <span class="nf">pop</span>     <span class="nb">ebx</span>             <span class="c1">; restore ebx from the value we pushed onto the stack at the start</span>
<span class="ln">39</span>    <span class="nf">ret</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Calculator (ATOI)</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf calculator-atoi.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 calculator-atoi.o -o calculator-atoi</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./calculator-atoi 20 1000 317</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln"> 9</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="nl">_start:</span>
<span class="ln">12</span> 
<span class="ln">13</span>    <span class="nf">pop</span>     <span class="nb">ecx</span>             <span class="c1">; first value on the stack is the number of arguments</span>
<span class="ln">14</span>    <span class="nf">pop</span>     <span class="nb">edx</span>             <span class="c1">; second value on the stack is the program name (discarded when we initialise edx)</span>
<span class="ln">15</span>    <span class="nf">sub</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">1</span>          <span class="c1">; decrease ecx by 1 (number of arguments without program name)</span>
<span class="ln">16</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; initialise our data register to store additions</span>
<span class="ln">17</span> 
<span class="ln">18</span><span class="nl">nextArg:</span>
<span class="ln">19</span>    <span class="nf">cmp</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mh">0h</span>         <span class="c1">; check to see if we have any arguments left</span>
<span class="ln">20</span>    <span class="nf">jz</span>      <span class="nv">noMoreArgs</span>      <span class="c1">; if zero flag is set jump to noMoreArgs label (jumping over the end of the loop)</span>
<span class="ln">21</span>    <span class="nf">pop</span>     <span class="nb">eax</span>             <span class="c1">; pop the next argument off the stack</span>
<span class="ln">22</span>    <span class="nf">call</span>    <span class="nv">atoi</span>            <span class="c1">; convert our ascii string to decimal integer</span>
<span class="ln">23</span>    <span class="nf">add</span>     <span class="nb">edx</span><span class="p">,</span> <span class="nb">eax</span>        <span class="c1">; perform our addition logic</span>
<span class="ln">24</span>    <span class="nf">dec</span>     <span class="nb">ecx</span>             <span class="c1">; decrease ecx (number of arguments left) by 1</span>
<span class="ln">25</span>    <span class="nf">jmp</span>     <span class="nv">nextArg</span>         <span class="c1">; jump to nextArg label</span>
<span class="ln">26</span> 
<span class="ln">27</span><span class="nl">noMoreArgs:</span>
<span class="ln">28</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">edx</span>        <span class="c1">; move our data result into eax for printing</span>
<span class="ln">29</span>    <span class="nf">call</span>    <span class="nv">iprintLF</span>        <span class="c1">; call our integer printing with linefeed function</span>
<span class="ln">30</span>    <span class="nf">call</span>    <span class="nv">quit</span>            <span class="c1">; call our q</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf calculator-atoi.asm
<span class="ln">2</span>$ ld -m elf_i386 calculator-atoi.o -o calculator-atoi
<span class="ln">3</span>$ ./calculator-atoi <span class="m">20</span> <span class="m">1000</span> <span class="m">317</span>
<span class="ln">4</span><span class="m">1337</span>
</code></pre></div><hr>
<h2 id="lesson-17-å‘½åç©ºé—´">Lesson 17 å‘½åç©ºé—´</h2>
<p>å¯¹äºä»»ä½•åŒ…å«å¤§é‡ä»£ç åº“çš„è½¯ä»¶é¡¹ç›®ï¼Œå‘½åç©ºé—´éƒ½æ˜¯ä¸å¯æˆ–ç¼ºçš„æ„é€ ã€‚å‘½åç©ºé—´ä¸ºæ ‡è¯†ç¬¦å¼•å…¥ä½œç”¨åŸŸçš„æ¦‚å¿µï¼Œä½¿å¾—é‡ç”¨å‘½åçº¦å®šæˆä¸ºå¯èƒ½ï¼ŒåŒæ—¶å¢å¼ºäº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚åœ¨æ±‡ç¼–è¯­è¨€ä¸­ï¼Œå…¨å±€æ ‡ç­¾æ ‡è¯†å­ä¾‹ç¨‹ï¼Œè€Œå±€éƒ¨æ ‡ç­¾ç”¨æ¥å®ç°å‘½åç©ºé—´ã€‚</p>
<p>ä¹‹å‰çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬éƒ½åªä½¿ç”¨äº†å…¨å±€æ ‡ç­¾ã€‚è¿™æ„å‘³ç€å³ä¾¿æ˜¯å®ç°ç›¸åŒé€»è¾‘çš„ä»£ç å—ï¼Œä¹Ÿå¿…é¡»æœ‰å…¨å±€å”¯ä¸€çš„æ ‡ç­¾åï¼Œå‰é¢çš„<code>finished</code>æ ‡ç­¾å°±æ˜¯ä¸€ä¾‹ã€‚åŒå±ä¸€ä¸ªå…¨å±€ä½œç”¨åŸŸï¼Œæ„å‘³ç€å½“åœ¨ä¸€ä¸ªå‡½æ•°ä¸­éœ€è¦è·³å‡ºå¾ªç¯æ—¶ï¼Œç›´æ¥<code>JMP</code>åˆ°è¯¥å‡½æ•°ä¸­çš„<code>finished</code>æ ‡ç­¾å°±è¡Œã€‚ç„¶è€Œï¼Œå¦‚æœéœ€è¦ä»å¦ä¸€ä¸ªå‡½æ•°ä¸­è·³å‡ºå¾ªç¯ï¼Œå’Œ<code>finished</code>ä»£ç å—åŠŸèƒ½ç›¸åŒçš„ä»£ç å°±å¾—æ”¹åã€‚æˆ‘ä»¬å¸Œæœ›èƒ½é‡ç”¨<code>finished</code>è¿™ä¸ªåå­—ï¼Œå› ä¸ºä»–èƒ½å‘ä»£ç çš„é˜…è¯»è€…æš—ç¤ºå‡ºæŸç§å·²çŸ¥çš„é€»è¾‘ã€‚</p>
<p>å±€éƒ¨æ ‡ç­¾ä»¥<code>.</code>å¼€å¤´ï¼Œæ¯”å¦‚ï¼š<code>.finished</code>ã€‚éšç€ functions.asm çš„ä¸æ–­æ‰©å±•ï¼Œä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ä»–çš„å‡ºç°äº†ã€‚ä¸€ä¸ªå±€éƒ¨æ ‡ç­¾çš„å‘½åç©ºé—´ï¼Œç”±ç¦»ä»–æœ€è¿‘çš„å‰é¢çš„ä¸€ä¸ªå…¨å±€æ ‡ç­¾é™å®šã€‚ä½ å¯ä»¥ä½¿ç”¨<code>JMP</code>è·³è½¬åˆ°å±€éƒ¨æ ‡ç­¾ï¼Œç¼–è¯‘å™¨å°†é€šè¿‡å½“å‰è°ƒç”¨çš„ä½œç”¨åŸŸ(åŸºäºå…¶ä¹‹ä¸Šçš„å…¨å±€æ ‡ç­¾)è®¡ç®—å‡ºåº”è¯¥å¼•ç”¨å“ªä¸€ä¸ªå±€éƒ¨æ ‡ç­¾ã€‚</p>
<h3 id="ç¬¬æ‹¾æŸ’ä¸ªæ±‡ç¼–ç¨‹åºå„å®‰ç”Ÿä¸š">ç¬¬æ‹¾æŸ’ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”å„å®‰ç”Ÿä¸š</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Namespace</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf namespace.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 namespace.o -o namespace</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./namespace</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">msg1</span>        <span class="nv">db</span>      <span class="s">&#39;Jumping to finished label.&#39;</span><span class="p">,</span> <span class="mh">0h</span>        <span class="c1">; a message string</span>
<span class="ln">10</span><span class="nf">msg2</span>        <span class="nv">db</span>      <span class="s">&#39;Inside subroutine number: &#39;</span><span class="p">,</span> <span class="mh">0h</span>        <span class="c1">; a message string</span>
<span class="ln">11</span><span class="nf">msg3</span>        <span class="nv">db</span>      <span class="s">&#39;Inside subroutine &#34;finished&#34;.&#39;</span><span class="p">,</span> <span class="mh">0h</span>     <span class="c1">; a message string</span>
<span class="ln">12</span> 
<span class="ln">13</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">14</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">15</span> 
<span class="ln">16</span><span class="nl">_start:</span>
<span class="ln">17</span> 
<span class="ln">18</span><span class="nl">subrountineOne:</span>
<span class="ln">19</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg1</span>       <span class="c1">; move the address of msg1 into eax</span>
<span class="ln">20</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rintLF</span>        <span class="c1">; call our string printing with linefeed function</span>
<span class="ln">21</span>    <span class="nf">jmp</span>     <span class="nv">.finished</span>       <span class="c1">; jump to the local label under the subrountineOne scope</span>
<span class="ln">22</span> 
<span class="ln">23</span><span class="nl">.finished:</span>
<span class="ln">24</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg2</span>       <span class="c1">; move the address of msg2 into eax</span>
<span class="ln">25</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>          <span class="c1">; call our string printing function</span>
<span class="ln">26</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">1</span>          <span class="c1">; move the value one into eax (for subroutine number one)</span>
<span class="ln">27</span>    <span class="nf">call</span>    <span class="nv">iprintLF</span>        <span class="c1">; call our integer printing function with linefeed function</span>
<span class="ln">28</span> 
<span class="ln">29</span><span class="nl">subrountineTwo:</span>
<span class="ln">30</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg1</span>       <span class="c1">; move the address of msg1 into eax</span>
<span class="ln">31</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rintLF</span>        <span class="c1">; call our string print with linefeed function</span>
<span class="ln">32</span>    <span class="nf">jmp</span>     <span class="nv">.finished</span>       <span class="c1">; jump to the local label under the subrountineTwo scope</span>
<span class="ln">33</span> 
<span class="ln">34</span><span class="nl">.finished:</span>
<span class="ln">35</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg2</span>       <span class="c1">; move the address of msg2 into eax</span>
<span class="ln">36</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>          <span class="c1">; call our string printing function</span>
<span class="ln">37</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">2</span>          <span class="c1">; move the value two into eax (for subroutine number two)</span>
<span class="ln">38</span>    <span class="nf">call</span>    <span class="nv">iprintLF</span>        <span class="c1">; call our integer printing function with linefeed function</span>
<span class="ln">39</span> 
<span class="ln">40</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg1</span>       <span class="c1">; move the address of msg1 into eax</span>
<span class="ln">41</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rintLF</span>        <span class="c1">; call our string printing with linefeed function</span>
<span class="ln">42</span>    <span class="nf">jmp</span>     <span class="nv">finished</span>        <span class="c1">; jump to the global label finished</span>
<span class="ln">43</span> 
<span class="ln">44</span><span class="nl">finished:</span>
<span class="ln">45</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg3</span>       <span class="c1">; move the address of msg3 into eax</span>
<span class="ln">46</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rintLF</span>        <span class="c1">; call our string printing with linefeed function</span>
<span class="ln">47</span>    <span class="nf">call</span>    <span class="nv">quit</span>            <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf namespace.asm
<span class="ln">2</span>$ ld -m elf_i386 namespace.o -o namespace
<span class="ln">3</span>$ ./namespace
<span class="ln">4</span>Jumping to finished label.
<span class="ln">5</span>Inside subroutine number: <span class="m">1</span>
<span class="ln">6</span>Jumping to finished label.
<span class="ln">7</span>Inside subroutine number: <span class="m">2</span>
<span class="ln">8</span>Jumping to finished label.
<span class="ln">9</span>Inside subroutine <span class="s2">&#34;finished&#34;</span>.
</code></pre></div><hr>
<h2 id="lesson-18-fizzbuzz-æ¸¸æˆ">Lesson 18 FizzBuzz æ¸¸æˆ</h2>
<p>FizzBuzzâ€”â€”è€å¤–åœ¨å­¦æ ¡é‡Œæ•™å­©å­é™¤æ³•çš„ä¸€ç»„æ¸¸æˆã€‚ç©æ³•ï¼š</p>
<ul>
<li>ç©å®¶è½®æµè®¡ç®—ä»<code>1</code>åˆ°<code>100</code>çš„æ•´æ•°ï¼Œ</li>
<li>é‡åˆ°<code>3çš„å€æ•°</code>å°±æ¢æˆ Fizzï¼Œ</li>
<li>é‡åˆ°<code>5çš„å€æ•°</code>å°±æ¢æˆ Buzzï¼Œ</li>
<li>é‡åˆ°<code>3å’Œ5çš„å…¬å€æ•°</code>å°±æ¢æˆ FizzBuzzã€‚</li>
</ul>
<p>ç¥å¥‡çš„æ˜¯è¿™ä¸ªå„¿ç«¥æ¸¸æˆå·²ç»æˆä¸ºè®¡ç®—æœºç¼–ç¨‹å·¥ä½œäº‹å®ä¸Šçš„æ ‡å‡†é¢è¯•é¢˜ä¹‹ä¸€ï¼ŒåŸå› åœ¨äºè¯¥é¢˜å¯ä»¥è½»æ¾çš„è¿‡æ»¤æ‰è¿ç®€å•çš„é€»è¾‘é—¨éƒ½æ„é€ ä¸å¥½çš„å€™é€‰äººã€‚ã€‚ã€‚</p>
<p>è§£é¢˜åŠæ³•ä¸æ­¢ä¸€ç§ï¼Œæœ‰äº›è¯­è¨€æä¾›äº†éå¸¸ç®€å•è€Œä¼˜é›…çš„æ–¹æ¡ˆã€‚ç„¶è€Œå¤§éƒ½æ˜¯èº²ä¸è¿‡ if è¯­å¥çš„ï¼›å¯èƒ½è¿˜ä¼šå«æœ‰ elseï¼Œè¿™å–å†³äºæ˜¯å¦åˆ©ç”¨äº†æŸäº›æ•°å­¦æ€§è´¨ï¼Œå¦‚ï¼šæ—¢èƒ½è¢« 3 æ•´é™¤ä¹Ÿèƒ½è¢« 5 æ•´é™¤çš„æ•°å¿…ç„¶å¯ä»¥è¢« 3 * 5 = 15 æ•´é™¤ã€‚</p>
<p>æœ¬ç¯‡çš„æ±‡ç¼–å®ç°ï¼Œæˆ‘ä»¬æä¾›å¦‚ä¸‹çš„æ–¹æ¡ˆï¼šä¸¤ä¸ªçº§è”çš„ if è¯­å¥åˆ¤æ–­æ˜¯å¦æ‰“å° Fizz å’Œ/æˆ– Buzzï¼Œä»¥åŠä¸€ä¸ª else è¯­å¥æ‰“å°å…¶ä»–æ•°å­—ã€‚æ¯ä¸ªè¾“å‡ºéƒ½å ä¸€è¡Œï¼Œ100ä¸ªæ•°å­—éƒ½å¤„ç†å®Œï¼Œç¨‹åºé€€å‡ºã€‚</p>
<h3 id="è®©æˆ‘ä»¬çš„ç¬¬æ‹¾æŒä¸ªæ±‡ç¼–ç¨‹åºæ¥æŒ‘æˆ˜ä¸€ä¸‹å¤§é“è‡³ç®€">è®©æˆ‘ä»¬çš„ç¬¬æ‹¾æŒä¸ªæ±‡ç¼–ç¨‹åºæ¥æŒ‘æˆ˜ä¸€ä¸‹â€”â€”å¤§é“è‡³ç®€</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Fizzbuzz</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf fizzbuzz.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 fizzbuzz.o -o fizzbuzz</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./fizzbuzz</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">fizz</span>        <span class="nv">db</span>      <span class="s">&#39;Fizz&#39;</span><span class="p">,</span> <span class="mh">0h</span>     <span class="c1">; a message string</span>
<span class="ln">10</span><span class="nf">buzz</span>        <span class="nv">db</span>      <span class="s">&#39;Buzz&#39;</span><span class="p">,</span> <span class="mh">0h</span>     <span class="c1">; a message string</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">13</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">14</span> 
<span class="ln">15</span><span class="nl">_start:</span>
<span class="ln">16</span> 
<span class="ln">17</span>    <span class="nf">mov</span>     <span class="nb">esi</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; initialise our checkFizz boolean variable</span>
<span class="ln">18</span>    <span class="nf">mov</span>     <span class="nb">edi</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; initialise our checkBuzz boolean variable</span>
<span class="ln">19</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; initialise our counter variable</span>
<span class="ln">20</span> 
<span class="ln">21</span><span class="nl">nextNumber:</span>
<span class="ln">22</span>    <span class="nf">inc</span>     <span class="nb">ecx</span>             <span class="c1">; increment our counter variable</span>
<span class="ln">23</span> 
<span class="ln">24</span><span class="nf">.checkFizz</span>
<span class="ln">25</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; clear the edx register - this will hold our remainder after division</span>
<span class="ln">26</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">ecx</span>        <span class="c1">; move the value of our counter into eax for division</span>
<span class="ln">27</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">3</span>          <span class="c1">; move our number to divide by into ebx (in this case the value is 3)</span>
<span class="ln">28</span>    <span class="nf">div</span>     <span class="nb">ebx</span>             <span class="c1">; divide eax by ebx</span>
<span class="ln">29</span>    <span class="nf">mov</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">edx</span>        <span class="c1">; move our remainder into edi (our checkFizz boolean variable)</span>
<span class="ln">30</span>    <span class="nf">cmp</span>     <span class="nb">edi</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; compare if the remainder is zero (meaning the counter divides by 3)</span>
<span class="ln">31</span>    <span class="nf">jne</span>     <span class="nv">.checkBuzz</span>      <span class="c1">; if the remainder is not equal to zero jump to local label checkBuzz</span>
<span class="ln">32</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">fizz</span>       <span class="c1">; else move the address of our fizz string into eax for printing</span>
<span class="ln">33</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>          <span class="c1">; call our string printing function</span>
<span class="ln">34</span> 
<span class="ln">35</span><span class="nl">.checkBuzz:</span>
<span class="ln">36</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; clear the edx register - this will hold our remainder after division</span>
<span class="ln">37</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">ecx</span>        <span class="c1">; move the value of our counter into eax for division</span>
<span class="ln">38</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">5</span>          <span class="c1">; move our number to divide by into ebx (in this case the value is 5)</span>
<span class="ln">39</span>    <span class="nf">div</span>     <span class="nb">ebx</span>             <span class="c1">; divide eax by ebx</span>
<span class="ln">40</span>    <span class="nf">mov</span>     <span class="nb">esi</span><span class="p">,</span> <span class="nb">edx</span>        <span class="c1">; move our remainder into edi (our checkBuzz boolean variable)</span>
<span class="ln">41</span>    <span class="nf">cmp</span>     <span class="nb">esi</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; compare if the remainder is zero (meaning the counter divides by 5)</span>
<span class="ln">42</span>    <span class="nf">jne</span>     <span class="nv">.checkInt</span>       <span class="c1">; if the remainder is not equal to zero jump to local label checkInt</span>
<span class="ln">43</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">buzz</span>       <span class="c1">; else move the address of our buzz string into eax for printing</span>
<span class="ln">44</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>          <span class="c1">; call our string printing function</span>
<span class="ln">45</span> 
<span class="ln">46</span><span class="nl">.checkInt:</span>
<span class="ln">47</span>    <span class="nf">cmp</span>     <span class="nb">edi</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; edi contains the remainder after the division in checkFizz</span>
<span class="ln">48</span>    <span class="nf">je</span>     <span class="nv">.continue</span>        <span class="c1">; if equal (counter divides by 3) skip printing the integer</span>
<span class="ln">49</span>    <span class="nf">cmp</span>     <span class="nb">esi</span><span class="p">,</span> <span class="mi">0</span>          <span class="c1">; esi contains the remainder after the division in checkBuzz</span>
<span class="ln">50</span>    <span class="nf">je</span>     <span class="nv">.continue</span>        <span class="c1">; if equal (counter divides by 5) skip printing the integer</span>
<span class="ln">51</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">ecx</span>        <span class="c1">; else move the value in ecx (our counter) into eax for printing</span>
<span class="ln">52</span>    <span class="nf">call</span>    <span class="nv">iprint</span>          <span class="c1">; call our integer printing function</span>
<span class="ln">53</span> 
<span class="ln">54</span><span class="nl">.continue:</span>
<span class="ln">55</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mh">0Ah</span>        <span class="c1">; move an ascii linefeed character into eax</span>
<span class="ln">56</span>    <span class="nf">push</span>    <span class="nb">eax</span>             <span class="c1">; push the address of eax onto the stack for printing</span>
<span class="ln">57</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">esp</span>        <span class="c1">; get the stack pointer (address on the stack of our linefeed char)</span>
<span class="ln">58</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>          <span class="c1">; call our string printing function to print a line feed</span>
<span class="ln">59</span>    <span class="nf">pop</span>     <span class="nb">eax</span>             <span class="c1">; pop the stack so we don&#39;t waste resources</span>
<span class="ln">60</span>    <span class="nf">cmp</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">100</span>        <span class="c1">; compare if our counter is equal to 100</span>
<span class="ln">61</span>    <span class="nf">jne</span>     <span class="nv">nextNumber</span>      <span class="c1">; if not equal jump to the start of the loop</span>
<span class="ln">62</span> 
<span class="ln">63</span>    <span class="nf">call</span>    <span class="nv">quit</span>            <span class="c1">; else call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln"> 1</span>$ nasm -f elf fizzbuzz.asm
<span class="ln"> 2</span>$ ld -m elf_i386 fizzbuzz.o -o fizzbuzz
<span class="ln"> 3</span>$ ./fizzbuzz
<span class="ln"> 4</span><span class="m">1</span>
<span class="ln"> 5</span><span class="m">2</span>
<span class="ln"> 6</span>Fizz
<span class="ln"> 7</span><span class="m">4</span>
<span class="ln"> 8</span>Buzz
<span class="ln"> 9</span>Fizz
<span class="ln">10</span><span class="m">7</span>
<span class="ln">11</span><span class="m">8</span>
<span class="ln">12</span>Fizz
<span class="ln">13</span>Buzz
<span class="ln">14</span><span class="m">11</span>
<span class="ln">15</span>Fizz
<span class="ln">16</span><span class="m">13</span>
<span class="ln">17</span><span class="m">14</span>
<span class="ln">18</span>FizzBuzz
<span class="ln">19</span><span class="m">16</span>
<span class="ln">20</span>.
<span class="ln">21</span>.
<span class="ln">22</span>.
</code></pre></div><hr>
<h2 id="lesson-19-æ‰§è¡Œå‘½ä»¤">Lesson 19 æ‰§è¡Œå‘½ä»¤</h2>
<h3 id="å†ä¸€æ¬¡èƒŒæ™¯çŸ¥è¯†">å†ä¸€æ¬¡ï¼ŒèƒŒæ™¯çŸ¥è¯†</h3>
<p>é€šè¿‡æŒ‡å®šçš„è¦è¿è¡Œçš„å‘½ä»¤ï¼Œè°ƒç”¨<code>EXEC</code>ä¸€æ—çš„å‡½æ•°å°†å¯åŠ¨ä¸€ä¸ªæ–°è¿›ç¨‹æ¥æ›¿æ¢å½“å‰çš„ã€‚æœ¬èŠ‚ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>sys_execve</code>ç³»ç»Ÿè°ƒç”¨ï¼Œå¯åŠ¨ Linux ä¸‹çš„ç¨‹åº<code>/bin/echo</code>ï¼Œæ¥æ›¿æ¢ç¨‹åºè¿è¡Œä¸­çš„è¿›ç¨‹ï¼Œæˆ‘ä»¬è®©<code>/bin/echo</code>æ¥è¾“å‡º&quot;Hello,World!&quot;</p>
<h3 id="å‘½åçº¦å®š">å‘½åçº¦å®š</h3>
<p>è¿™ä¸€æ—çš„å‡½æ•°éƒ½ä»¥<code>exec</code>å¼€å¤´ï¼Œåé¢è·Ÿç€çš„å­—æ¯å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>Eï¼ŒæŒ‡å‘ç¯å¢ƒå˜é‡æŒ‡é’ˆçš„æ•°ç»„ï¼Œä¼ ç»™è¿›ç¨‹é•œåƒ</li>
<li>Lï¼Œå‘½ä»¤è¡Œå‚æ•°åˆ†åˆ«ä¼ ç»™å‡½æ•°</li>
<li>Pï¼Œä½¿ç”¨<code>PATH</code>ç¯å¢ƒå˜é‡æŸ¥æ‰¾è·¯å¾„å‚æ•°ä¸­çš„å‘½ä»¤åå¹¶æ‰§è¡Œ</li>
<li>Vï¼Œå‘½ä»¤è¡Œå‚æ•°ä½œä¸ºæŒ‡é’ˆæ•°ç»„ä¼ é€’ç»™å‡½æ•°</li>
</ul>
<p>V å’Œ E åç¼€çš„å‡½æ•°ï¼Œæ„å‘³ç€éœ€è¦æŒ‰å¦‚ä¸‹æ ¼å¼ä¼ é€’å‚æ•°ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è¢«æ‰§è¡Œçš„å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œ</li>
<li>åé¢è·Ÿç€è¯¥å‘½ä»¤çš„å‚æ•°æ•°ç»„ï¼Œ</li>
<li>æœ€åæ˜¯æ–°è¿›ç¨‹å°†ç”¨åˆ°çš„ç¯å¢ƒå˜é‡çš„æ•°ç»„ã€‚</li>
</ul>
<p>å½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªç®€å•çš„å‘½ä»¤æ—¶ï¼Œä¸å°†ä»»ä½•ç‰¹æ®Šçš„ç¯å¢ƒå˜é‡ä¼ é€’ç»™æ–°è¿›ç¨‹ï¼Œè€Œæ˜¯ä¼ é€’ 0h (NULL)ã€‚</p>
<p>å‘½ä»¤çš„å‚æ•°å’Œç¯å¢ƒå˜é‡éƒ½å¿…é¡»ç”¨æŒ‡é’ˆçš„æ•°ç»„æ¥ä¼ é€’ã€‚å› æ­¤ï¼Œåœ¨å®šä¹‰å®Œå­—ç¬¦ä¸²åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåŒ…å«å˜é‡åçš„nullç»ˆç»“(0hç»“å°¾)çš„ç»“æ„ä½“(æ•°ç»„)ã€‚è¿™æ ·ï¼Œå°±å‡†å¤‡å¥½äº†åº”ä¼ ç»™<code>sys_execve</code>çš„æ‰€æœ‰ä¸œè¥¿ã€‚ä¸€æ—¦è°ƒç”¨æˆåŠŸï¼Œæ–°è¿›ç¨‹å°†æ›¿æ¢æˆ‘ä»¬çš„è¿›ç¨‹ï¼Œè¾“å‡ºè¿”å›ç»™äº†ç»ˆç«¯ã€‚</p>
<h3 id="ç¬¬æ‹¾ç–ä¸ªæ±‡ç¼–ç¨‹åºå§”é‡æŠ•è‰°">ç¬¬æ‹¾ç–ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”å§”é‡æŠ•è‰°</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Execute</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf execute.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 execute.o -o execute</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./execute</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">command</span>         <span class="nv">db</span>      <span class="s">&#39;/bin/echo&#39;</span><span class="p">,</span> <span class="mh">0h</span>     <span class="c1">; command to execute</span>
<span class="ln">10</span><span class="nf">arg1</span>            <span class="nv">db</span>      <span class="s">&#39;Hello World!&#39;</span><span class="p">,</span> <span class="mh">0h</span>
<span class="ln">11</span><span class="nf">arguments</span>       <span class="nv">dd</span>      <span class="nv">command</span>
<span class="ln">12</span>                <span class="kd">dd</span>      <span class="nv">arg1</span>                <span class="c1">; arguments to pass to commandline (in this case just one)</span>
<span class="ln">13</span>                <span class="kd">dd</span>      <span class="mh">0h</span>                  <span class="c1">; end the struct</span>
<span class="ln">14</span><span class="nf">environment</span>     <span class="nv">dd</span>      <span class="mh">0h</span>                  <span class="c1">; arguments to pass as environment variables (inthis case none) end the struct</span>
<span class="ln">15</span> 
<span class="ln">16</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">17</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">18</span> 
<span class="ln">19</span><span class="nl">_start:</span>
<span class="ln">20</span> 
<span class="ln">21</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="nv">environment</span>    <span class="c1">; address of environment variables</span>
<span class="ln">22</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">arguments</span>      <span class="c1">; address of the arguments to pass to the commandline</span>
<span class="ln">23</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nv">command</span>        <span class="c1">; address of the file to execute</span>
<span class="ln">24</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">11</span>             <span class="c1">; invoke SYS_EXECVE (kernel opcode 11)</span>
<span class="ln">25</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">26</span> 
<span class="ln">27</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf execute.asm
<span class="ln">2</span>$ ld -m elf_i386 execute.o -o execute
<span class="ln">3</span>$ ./execute
<span class="ln">4</span>Hello World!
</code></pre></div>
<div class="notices tip">
    <div class="label">æç¤º</div>
    <p>ä¸å¦¨è¯•è¯•å…¶ä»–å‘½ä»¤</p>

  </div>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln">1</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln">2</span><span class="nf">command</span>         <span class="nv">db</span>      <span class="s">&#39;/bin/ls&#39;</span><span class="p">,</span> <span class="mh">0h</span>       <span class="c1">; command to execute</span>
<span class="ln">3</span><span class="nf">arg1</span>            <span class="nv">db</span>      <span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="mh">0h</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln">1</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln">2</span><span class="nf">command</span>         <span class="nv">db</span>      <span class="s">&#39;/bin/sleep&#39;</span><span class="p">,</span> <span class="mh">0h</span>    <span class="c1">; command to execute</span>
<span class="ln">3</span><span class="nf">arg1</span>            <span class="nv">db</span>      <span class="s">&#39;5&#39;</span><span class="p">,</span> <span class="mh">0h</span>
</code></pre></div><hr>
<h2 id="lesson-20-process-forking">Lesson 20 Process Forking</h2>
<h3 id="é‡å…¥èƒŒæ™¯çŸ¥è¯†">é‡å…¥ï¼ŒèƒŒæ™¯çŸ¥è¯†</h3>
<p>æœ¬èŠ‚å¼•å…¥è‘—åçš„<code>sys_fork</code>ã€‚è¿™ä¸ªè°ƒç”¨ä¸æ˜¯æ›¿æ¢ï¼Œè€Œæ˜¯å¤åˆ¶æˆ‘ä»¬çš„è¿›ç¨‹ã€‚è¯¥è°ƒç”¨ä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œåªè¦åœ¨å½“å‰è¿›ç¨‹ä¸­è°ƒç”¨ï¼Œé‚£ä¹ˆæ–°è¿›ç¨‹å°±ä¼šè¢«åˆ›å»ºã€‚æ–°è¿›ç¨‹ä¸åŸè¿›ç¨‹å¹¶å‘æ‰§è¡Œã€‚</p>
<p>é€šè¿‡æ£€æµ‹<code>EAX</code>ä¸­çš„å€¼ï¼Œæ¥åˆ¤æ–­å½“å‰æ˜¯å¤„äºçˆ¶è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹ä¸­ã€‚çˆ¶è¿›ç¨‹è¿”å›ä¸€ä¸ªæ­£æ•´æ•°ï¼›å­è¿›ç¨‹ä¸­<code>EAX</code>ä¸º 0ã€‚ä»¥æ­¤å¯ä»¥å¯¹äºçˆ¶å­è¿›ç¨‹è¿›è¡Œåˆ†æ”¯é€»è¾‘ã€‚</p>
<p>åŸºäºä»¥ä¸Šäº‹å®ï¼Œæˆ‘ä»¬åœ¨çˆ¶å­è¿›ç¨‹ä¸­æ‰“å°ä¸åŒçš„æ¶ˆæ¯ã€‚</p>

<div class="notices note">
    <div class="label">æ³¨æ„</div>
    <p>æ¯ä¸ªè¿›ç¨‹éœ€è¦å„è‡ªå®‰å…¨é€€å‡º</p>

  </div>

<h3 id="ç¬¬è´°æ‹¾ä¸ªæ±‡ç¼–ç¨‹åºå¦‚å‡ºä¸€è¾™">ç¬¬è´°æ‹¾ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”å¦‚å‡ºä¸€è¾™</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Fork</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf fork.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 fork.o -o fork</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./fork</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">childMsg</span>        <span class="nv">db</span>      <span class="s">&#39;This is the child process&#39;</span><span class="p">,</span> <span class="mh">0h</span>     <span class="c1">; a message string</span>
<span class="ln">10</span><span class="nf">parentMsg</span>       <span class="nv">db</span>      <span class="s">&#39;This is the parent process&#39;</span><span class="p">,</span> <span class="mh">0h</span>    <span class="c1">; a message string</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">13</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">14</span> 
<span class="ln">15</span><span class="nl">_start:</span>
<span class="ln">16</span> 
<span class="ln">17</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">2</span>              <span class="c1">; invoke SYS_FORK (kernel opcode 2)</span>
<span class="ln">18</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">19</span> 
<span class="ln">20</span>    <span class="nf">cmp</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">0</span>              <span class="c1">; if eax is zero we are in the child process</span>
<span class="ln">21</span>    <span class="nf">jz</span>      <span class="nb">ch</span><span class="nv">ild</span>               <span class="c1">; jump if eax is zero to child label</span>
<span class="ln">22</span> 
<span class="ln">23</span><span class="nl">parent:</span>
<span class="ln">24</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">parentMsg</span>      <span class="c1">; inside our parent process move parentMsg into eax</span>
<span class="ln">25</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rintLF</span>            <span class="c1">; call our string printing with linefeed function</span>
<span class="ln">26</span> 
<span class="ln">27</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; quit the parent process</span>
<span class="ln">28</span> 
<span class="ln">29</span><span class="nl">child:</span>
<span class="ln">30</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">ch</span><span class="nv">ildMsg</span>       <span class="c1">; inside our child process move childMsg into eax</span>
<span class="ln">31</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rintLF</span>            <span class="c1">; call our string printing with linefeed function</span>
<span class="ln">32</span> 
<span class="ln">33</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; quit the child process</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf fork.asm
<span class="ln">2</span>$ ld -m elf_i386 fork.o -o fork
<span class="ln">3</span>$ ./fork
<span class="ln">4</span>This is the parent process
<span class="ln">5</span>This is the child process
</code></pre></div><hr>
<h2 id="lesson-21-è¾“å‡ºæ—¶é—´">Lesson 21 è¾“å‡ºæ—¶é—´</h2>
<p>åœ¨ NASM ä¸­ï¼Œç”Ÿæˆä¸€ä¸ª unix æ—¶é—´æˆ³åªéœ€ç®€å•çš„å‘å†…æ ¸è°ƒç”¨<code>sys_time</code>ï¼Œä¹Ÿå³ï¼šè°ƒç”¨è¡¨ä¸­çš„ OPCODE 13ã€‚ä¸éœ€è¦å‚æ•°ï¼Œè¿”å›çš„<a href="https://en.wikipedia.org/wiki/Unix_time">UNIX çºªå…ƒæ—¶é—´</a>ä¿å­˜åœ¨<code>EAX</code>å¯„å­˜å™¨ä¸­</p>
<h3 id="ç¬¬è´°æ‹¾å£¹ä¸ªæ±‡ç¼–ç¨‹åºåªäº‰æœå¤•">ç¬¬è´°æ‹¾å£¹ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”åªäº‰æœå¤•</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Time</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf time.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 time.o -o time</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./time</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include        &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">msg</span>        <span class="nv">db</span>      <span class="s">&#39;Seconds since Jan 01 1970: &#39;</span><span class="p">,</span> <span class="mh">0h</span>     <span class="c1">; a message string</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">12</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">13</span> 
<span class="ln">14</span><span class="nl">_start:</span>
<span class="ln">15</span> 
<span class="ln">16</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">msg</span>        <span class="c1">; move our message string into eax for printing</span>
<span class="ln">17</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>          <span class="c1">; call our string printing function</span>
<span class="ln">18</span> 
<span class="ln">19</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">13</span>         <span class="c1">; invoke SYS_TIME (kernel opcode 13)</span>
<span class="ln">20</span>    <span class="nf">int</span>     <span class="mh">80h</span>             <span class="c1">; call the kernel</span>
<span class="ln">21</span> 
<span class="ln">22</span>    <span class="nf">call</span>    <span class="nv">iprintLF</span>        <span class="c1">; call our integer printing function with linefeed</span>
<span class="ln">23</span>    <span class="nf">call</span>    <span class="nv">quit</span>            <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf time.asm
<span class="ln">2</span>$ ld -m elf_i386 time.o -o <span class="nb">time</span>
<span class="ln">3</span>$ ./time
<span class="ln">4</span>Seconds since Jan <span class="m">01</span> 1970: <span class="m">1374995660</span>
</code></pre></div><hr>
<h2 id="lesson-22-æ–‡ä»¶æ“ä½œcreate">Lesson 22 æ–‡ä»¶æ“ä½œâ€”â€”Create</h2>
<h3 id="ç›¸å…³èƒŒæ™¯">ç›¸å…³èƒŒæ™¯</h3>
<p>æ–‡ä»¶æ“ä½œåœ¨ Linux ç³»ç»Ÿä¸­æ¶‰åŠåˆ°ä¸€å°è‚¡ç³»ç»Ÿè°ƒç”¨ï¼ŒåŒ…æ‹¬ï¼šåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ã€‚è¿™äº›å‡½æ•°éƒ½å¿…é¡»ä½œç”¨äº<a href="https://en.wikipedia.org/wiki/File_descriptor">æ–‡ä»¶æè¿°ç¬¦</a>â€”â€”ç³»ç»Ÿä¸­ç”¨äºæ ‡è¯†æ–‡ä»¶çš„ä¸€ä¸ªå”¯ä¸€çš„ã€éè´Ÿæ•´æ•°ã€‚</p>
<p>é¦–å…ˆç™»åœºçš„æ˜¯ç”¨äºåˆ›å»ºæ–‡ä»¶çš„<code>sys_creat</code>ã€‚åœ¨åé¢çš„è¯¾ç¨‹ä¸­ï¼Œå°†åœ¨åŒä¸€ç¨‹åºä¸Šä¸æ–­æ‰©å±•ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬å°†æœ‰ä¸€ä¸ªåŒ…å«æ–‡ä»¶çš„åˆ›å»ºã€æ›´æ–°ã€æ‰“å¼€ã€å…³é—­å’Œåˆ é™¤çš„å®Œæ•´åŠŸèƒ½çš„ç¨‹åºã€‚</p>
<h3 id="æˆ‘ä»¬çš„ç¬¬è´°æ‹¾è´°ä¸ªæ±‡ç¼–ç¨‹åºæœ¬ç«‹é“ç”Ÿ">æˆ‘ä»¬çš„ç¬¬è´°æ‹¾è´°ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”æœ¬ç«‹é“ç”Ÿ</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Create</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf create.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 create.o -o create</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./create</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include    &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">filename</span> <span class="nv">db</span> <span class="s">&#39;readme.txt&#39;</span><span class="p">,</span>       <span class="c1">; the filename to create</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">12</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">13</span> 
<span class="ln">14</span><span class="nl">_start:</span>
<span class="ln">15</span> 
<span class="ln">16</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0777</span>           <span class="c1">; set all permissions to read, write, execute</span>
<span class="ln">17</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nv">filename</span>       <span class="c1">; filename we will create</span>
<span class="ln">18</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">8</span>              <span class="c1">; invoke SYS_CREAT (kernel opcode 8)</span>
<span class="ln">19</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">20</span> 
<span class="ln">21</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf create.asm
<span class="ln">2</span>$ ld -m elf_i386 create.o -o create
<span class="ln">3</span>$ ./create
</code></pre></div>
<div class="notices tip">
    <div class="label">æç¤º</div>
    <p>â€œæ²¡æœ‰æ¶ˆæ¯å°±æ˜¯å¥½æ¶ˆæ¯â€ï¼Œæ–‡ä»¶ readme.txt å°†å‡ºç°åœ¨ä¸ç¨‹åºç›¸åŒçš„ç›®å½•ä¸­</p>

  </div>

<hr>
<h2 id="lesson-23-æ–‡ä»¶æ“ä½œwrite">Lesson 23 æ–‡ä»¶æ“ä½œâ€”â€”Write</h2>
<p>åŸºäºä¸Šä¸€èŠ‚çš„ç¨‹åºï¼Œæˆ‘ä»¬è°ƒç”¨<code>sys_write</code>å°†å†…å®¹å†™åˆ°æ–°åˆ›å»ºçš„æ–‡ä»¶ã€‚</p>
<p><code>sys_write</code>éœ€è¦çš„ 3 ä¸ªå‚æ•°ç”±ä»¥ä¸‹å¯„å­˜å™¨æä¾›</p>
<ul>
<li>è¦å†™å…¥çš„å­—èŠ‚æ•°è½½å…¥<code>EDX</code></li>
<li>è¦å†™å…¥å†…å®¹çš„æŒ‡é’ˆè½½å…¥<code>ECX</code></li>
<li>æ–‡ä»¶æè¿°ç¬¦è½½å…¥<code>EBX</code></li>
</ul>
<p>OPCODE 12 è½½å…¥<code>EAX</code>ï¼Œç†Ÿæ‚‰çš„å¥—è·¯ï¼Œ<code>INT 80h</code> å¼€è°ƒã€‚ç•™æ„ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡å°†æ–‡ä»¶åä¼ ç»™<code>sys_creat</code>ï¼Œè¿›è€Œä»<code>EAX</code>ä¸­å¾—åˆ°æ–‡ä»¶æè¿°ç¬¦ã€‚</p>
<h3 id="æˆ‘ä»¬çš„ç¬¬è´°æ‹¾åä¸ªæ±‡ç¼–ç¨‹åºæ¡ç´ æ€€é“…">æˆ‘ä»¬çš„ç¬¬è´°æ‹¾åä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”æ¡ç´ æ€€é“…</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Write</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf write.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 write.o -o write</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./write</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include    &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">filename</span> <span class="nv">db</span> <span class="s">&#39;readme.txt&#39;</span><span class="p">,</span> <span class="mh">0h</span>    <span class="c1">; the filename to create</span>
<span class="ln">10</span><span class="nf">contents</span> <span class="nv">db</span> <span class="s">&#39;Hello world!&#39;</span><span class="p">,</span> <span class="mh">0h</span>  <span class="c1">; the contents to write</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">13</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">14</span> 
<span class="ln">15</span><span class="nl">_start:</span>
<span class="ln">16</span> 
<span class="ln">17</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0777</span>           <span class="c1">; code continues from lesson 22</span>
<span class="ln">18</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nv">filename</span>
<span class="ln">19</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">8</span>
<span class="ln">20</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">21</span> 
<span class="ln">22</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">12</span>             <span class="c1">; number of bytes to write - one for each letter of our contents string</span>
<span class="ln">23</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">contents</span>       <span class="c1">; move the memory address of our contents string into ecx</span>
<span class="ln">24</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; move the file descriptor of the file we created into ebx</span>
<span class="ln">25</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>              <span class="c1">; invoke SYS_WRITE (kernel opcode 4)</span>
<span class="ln">26</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">27</span> 
<span class="ln">28</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf write.asm
<span class="ln">2</span>$ ld -m elf_i386 write.o -o write
<span class="ln">3</span>$ ./write
</code></pre></div>
<div class="notices tip">
    <div class="label">æç¤º</div>
    <p>æ‰§è¡Œå®Œæ‰“å¼€ readme.txt çœ‹çœ‹å§ï¼Œè¯¥æœ‰ Hello, World! æ‰å¯¹</p>

  </div>

<hr>
<h2 id="lesson-24-æ–‡ä»¶æ“ä½œopen">Lesson 24 æ–‡ä»¶æ“ä½œâ€”â€”Open</h2>
<p>ç»§ç»­æ‰©å±•å‰é¢çš„ç¨‹åºï¼Œè¿™æ¬¡è½®åˆ°<code>sys_open</code>ç™»åœºã€‚è¿™ä¸ªè°ƒç”¨ç”¨æ¥è·å–æ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œæ–‡ä»¶æè¿°ç¬¦åˆ™ä½œä¸ºåé¢å…¶ä»–æ–‡ä»¶ç›¸å…³å‡½æ•°çš„å‚æ•°ã€‚</p>
<p><code>sys_open</code>éœ€è¦çš„ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>è®¿é—®æ¨¡å¼(è§ä¸‹è¡¨)è½½å…¥<code>ECX</code></li>
<li><code>EBX</code>åˆ™å­˜ç€æ–‡ä»¶å</li>
</ul>
<p>ç³»ç»Ÿè°ƒç”¨çš„æ–¹æ³•æˆ‘ä»¬å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼šOPCODE 5 è½½å…¥<code>EAX</code>ï¼Œ<code>INT 80h</code> å¼€è°ƒã€‚</p>
<p><code>sys_open</code>ä¹Ÿå¯ä»¥é¢å¤–æ¥å— 0 ä¸ªæˆ–å¤šä¸ªè¡¨ç¤ºæ–‡ä»¶åˆ›å»ºå’Œæ–‡ä»¶çŠ¶æ€çš„æ ‡å¿—ï¼Œé€šè¿‡<code>EDX</code>è¯»å–ã€‚è¯¦æƒ…å‚è§ï¼š<a href="https://man7.org/linux/man-pages/man2/open.2.html">open(2) â€”â€” Linux manual page</a></p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
<th>å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>O_RDONLY</td>
<td>åªè¯»æ‰“å¼€</td>
<td>0</td>
</tr>
<tr>
<td>O_WRONLY</td>
<td>åªå†™æ‰“å¼€</td>
<td>1</td>
</tr>
<tr>
<td>O_RDWR</td>
<td>è¯»å†™æ‰“å¼€</td>
<td>2</td>
</tr>
</tbody>
</table>

<div class="notices note">
    <div class="label">æ³¨æ„</div>
    <p>è°ƒç”¨<code>sys_open</code>åï¼Œæˆ‘ä»¬ä»<code>EAX</code>ä¸­è·å¾—æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åä½¿ç”¨æ•´æ•°æ‰“å°å‡½æ•°å°†è¿™ä¸ªåœ¨ Linux ä¸­å”¯ä¸€çš„ï¼Œéè´Ÿæ•´æ•°çš„å€¼æ‰“å°å‡ºæ¥</p>

  </div>

<h3 id="å†™ä¸‹æˆ‘ä»¬çš„ç¬¬è´°æ‹¾è‚†ä¸ªæ±‡ç¼–ç¨‹åºæ‹›ä¹‹å³æ¥">å†™ä¸‹æˆ‘ä»¬çš„ç¬¬è´°æ‹¾è‚†ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”æ‹›ä¹‹å³æ¥</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Open</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf open.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 open.o -o open</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./open</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include    &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">filename</span> <span class="nv">db</span> <span class="s">&#39;readme.txt&#39;</span><span class="p">,</span> <span class="mh">0h</span>    <span class="c1">; the filename to create</span>
<span class="ln">10</span><span class="nf">contents</span> <span class="nv">db</span> <span class="s">&#39;Hello world!&#39;</span><span class="p">,</span> <span class="mh">0h</span>  <span class="c1">; the contents to write</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">13</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">14</span> 
<span class="ln">15</span><span class="nl">_start:</span>
<span class="ln">16</span> 
<span class="ln">17</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0777</span>           <span class="c1">; Create file from lesson 22</span>
<span class="ln">18</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nv">filename</span>
<span class="ln">19</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">8</span>
<span class="ln">20</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">21</span> 
<span class="ln">22</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">12</span>             <span class="c1">; Write contents to file from lesson 23</span>
<span class="ln">23</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">contents</span>
<span class="ln">24</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">eax</span>
<span class="ln">25</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>
<span class="ln">26</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">27</span> 
<span class="ln">28</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0</span>              <span class="c1">; flag for readonly access mode (O_RDONLY)</span>
<span class="ln">29</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nv">filename</span>       <span class="c1">; filename we created above</span>
<span class="ln">30</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">5</span>              <span class="c1">; invoke SYS_OPEN (kernel opcode 5)</span>
<span class="ln">31</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">32</span> 
<span class="ln">33</span>    <span class="nf">call</span>    <span class="nv">iprintLF</span>            <span class="c1">; call our integer printing function</span>
<span class="ln">34</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf open.asm
<span class="ln">2</span>$ ld -m elf_i386 open.o -o open
<span class="ln">3</span>$ ./open
<span class="ln">4</span><span class="m">4</span>
</code></pre></div><hr>
<h2 id="lesson-25-æ–‡ä»¶æ“ä½œread">Lesson 25 æ–‡ä»¶æ“ä½œâ€”â€”Read</h2>
<p>ä»‹ç»äº†åˆ›å»ºã€å†™å…¥ã€æ‰“å¼€ï¼Œä¹Ÿè¯¥è¯»å–äº†ã€‚æœ¬èŠ‚æˆ‘ä»¬ä½¿ç”¨<code>sys_read</code>è¯»å–æ–°å»ºä¸”æ‰“å¼€çš„æ–‡ä»¶ï¼Œå†…å®¹å­˜åˆ°ä¸€ä¸ªå˜é‡ä¸­ã€‚</p>
<p><code>sys_read</code>çš„ 3 ä¸ªå‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li>è¦è¯»å–çš„å­—èŠ‚æ•°è½½å…¥<code>EDX</code></li>
<li>ä¿å­˜å†…å®¹çš„å˜é‡åœ°å€è½½å…¥<code>ECX</code></li>
<li><code>EBX</code>ä¸­æ”¾æ–‡ä»¶æè¿°ç¬¦(é€šè¿‡ä¸Šä¸€èŠ‚çš„<code>sys_open</code>è·å–)</li>
</ul>
<p>OPCODE 3 è½½å…¥<code>EAX</code>ï¼Œ<code>INT 80h</code> å¼€è°ƒã€‚</p>
<h3 id="ç¬¬è´°æ‹¾ä¼ä¸ªæ±‡ç¼–ç¨‹åºä¸€è§ˆæ— é—">ç¬¬è´°æ‹¾ä¼ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”ä¸€è§ˆæ— é—</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Read</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf read.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 read.o -o read</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./read</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include    &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">filename</span> <span class="nv">db</span> <span class="s">&#39;readme.txt&#39;</span><span class="p">,</span> <span class="mh">0h</span>    <span class="c1">; the filename to create</span>
<span class="ln">10</span><span class="nf">contents</span> <span class="nv">db</span> <span class="s">&#39;Hello world!&#39;</span><span class="p">,</span> <span class="mh">0h</span>  <span class="c1">; the contents to write</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="k">SECTION</span> <span class="nv">.bss</span>
<span class="ln">13</span><span class="nf">fileContents</span> <span class="nv">resb</span> <span class="mi">255</span><span class="p">,</span>          <span class="c1">; variable to store file contents</span>
<span class="ln">14</span> 
<span class="ln">15</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">16</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">17</span> 
<span class="ln">18</span><span class="nl">_start:</span>
<span class="ln">19</span> 
<span class="ln">20</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0777</span>           <span class="c1">; Create file from lesson 22</span>
<span class="ln">21</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nv">filename</span>
<span class="ln">22</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">8</span>
<span class="ln">23</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">24</span> 
<span class="ln">25</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">12</span>             <span class="c1">; Write contents to file from lesson 23</span>
<span class="ln">26</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">contents</span>
<span class="ln">27</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">eax</span>
<span class="ln">28</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>
<span class="ln">29</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">30</span> 
<span class="ln">31</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0</span>              <span class="c1">; Open file from lesson 24</span>
<span class="ln">32</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nv">filename</span>
<span class="ln">33</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">5</span>
<span class="ln">34</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">35</span> 
<span class="ln">36</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">12</span>             <span class="c1">; number of bytes to read - one for each letter of the file contents</span>
<span class="ln">37</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">fileContents</span>   <span class="c1">; move the memory address of our file contents variable into ecx</span>
<span class="ln">38</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; move the opened file descriptor into EBX</span>
<span class="ln">39</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">3</span>              <span class="c1">; invoke SYS_READ (kernel opcode 3)</span>
<span class="ln">40</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">41</span> 
<span class="ln">42</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">fileContents</span>   <span class="c1">; move the memory address of our file contents variable into eax for printing</span>
<span class="ln">43</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rintLF</span>            <span class="c1">; call our string printing function</span>
<span class="ln">44</span> 
<span class="ln">45</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf read.asm
<span class="ln">2</span>$ ld -m elf_i386 read.o -o <span class="nb">read</span>
<span class="ln">3</span>$ ./read
<span class="ln">4</span>Hello world!
</code></pre></div><hr>
<h2 id="lesson-26-æ–‡ä»¶æ“ä½œclose">Lesson 26 æ–‡ä»¶æ“ä½œâ€”â€”Close</h2>
<p>æŠ±æ­‰è¿™ä¹ˆé‡è¦çš„æ“ä½œç°åœ¨æ‰å¼•å…¥ï¼Œæ­£ç¡®çš„å…³é—­æ–‡ä»¶ç­‰èµ„æºæ— è®ºåœ¨é‚£ç§è¯­è¨€ç¼–å†™çš„ç¨‹åºä¸­éƒ½æ˜¯ä¸å¯æˆ–ç¼ºçš„æ­¥éª¤ï¼Œæœ¬èŠ‚å¼•å…¥<code>sys_close</code>ã€‚</p>
<p><code>sys_close</code>åªéœ€è¦ä¸€ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>è—‰ç”±<code>EBX</code>å°†æ–‡ä»¶æè¿°ç¬¦ä¼ ç»™å†…æ ¸</li>
</ul>
<p>æ‰©å±•ä¸Šä¸€èŠ‚çš„ç¨‹åºâ€”â€”åœ¨è·å–åˆ°æ–‡ä»¶æè¿°ç¬¦åï¼Œæˆ‘ä»¬å°†å…¶æ”¾å…¥EBXã€‚</p>
<p>OPCODE 6 è½½å…¥<code>EAX</code>ï¼Œ<code>INT 80h</code> å¼€è°ƒã€‚</p>
<h3 id="æˆ‘ä»¬çš„è´Ÿè´£ä»»çš„ç¬¬è´°æ‹¾é™†ä¸ªæ±‡ç¼–ç¨‹åºæ­¢æˆˆæ•£é©¬">æˆ‘ä»¬çš„è´Ÿè´£ä»»çš„ç¬¬è´°æ‹¾é™†ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”æ­¢æˆˆæ•£é©¬</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Close</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf close.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 close.o -o close</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./close</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include    &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">filename</span> <span class="nv">db</span> <span class="s">&#39;readme.txt&#39;</span><span class="p">,</span> <span class="mh">0h</span>    <span class="c1">; the filename to create</span>
<span class="ln">10</span><span class="nf">contents</span> <span class="nv">db</span> <span class="s">&#39;Hello world!&#39;</span><span class="p">,</span> <span class="mh">0h</span>  <span class="c1">; the contents to write</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="k">SECTION</span> <span class="nv">.bss</span>
<span class="ln">13</span><span class="nf">fileContents</span> <span class="nv">resb</span> <span class="mi">255</span><span class="p">,</span>          <span class="c1">; variable to store file contents</span>
<span class="ln">14</span> 
<span class="ln">15</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">16</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">17</span> 
<span class="ln">18</span><span class="nl">_start:</span>
<span class="ln">19</span> 
<span class="ln">20</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0777</span>           <span class="c1">; Create file from lesson 22</span>
<span class="ln">21</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nv">filename</span>
<span class="ln">22</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">8</span>
<span class="ln">23</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">24</span> 
<span class="ln">25</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">12</span>             <span class="c1">; Write contents to file from lesson 23</span>
<span class="ln">26</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">contents</span>
<span class="ln">27</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">eax</span>
<span class="ln">28</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>
<span class="ln">29</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">30</span> 
<span class="ln">31</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0</span>              <span class="c1">; Open file from lesson 24</span>
<span class="ln">32</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nv">filename</span>
<span class="ln">33</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">5</span>
<span class="ln">34</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">35</span> 
<span class="ln">36</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">12</span>             <span class="c1">; Read file from lesson 25</span>
<span class="ln">37</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">fileContents</span>
<span class="ln">38</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">eax</span>
<span class="ln">39</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">3</span>
<span class="ln">40</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">41</span> 
<span class="ln">42</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">fileContents</span>
<span class="ln">43</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rintLF</span>
<span class="ln">44</span> 
<span class="ln">45</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">ebx</span>            <span class="c1">; not needed but used to demonstrate that SYS_CLOSE takes a file descriptor from EBX</span>
<span class="ln">46</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">6</span>              <span class="c1">; invoke SYS_CLOSE (kernel opcode 6)</span>
<span class="ln">47</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">48</span> 
<span class="ln">49</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf close.asm
<span class="ln">2</span>$ ld -m elf_i386 close.o -o close
<span class="ln">3</span>$ ./close
<span class="ln">4</span>Hello world!
</code></pre></div>
<div class="notices tip">
    <div class="label">æç¤º</div>
    <p>æˆ‘ä»¬æ­£ç¡®çš„å…³é—­äº†æ–‡ä»¶ï¼Œå°†æ–‡ä»¶æè¿°ç¬¦ç­‰ä¸€å¹²èµ„æºè¿˜å›äº†æ“ä½œç³»ç»Ÿ</p>

  </div>

<hr>
<h2 id="lesson-27-æ–‡ä»¶æ“ä½œseek">Lesson 27 æ–‡ä»¶æ“ä½œâ€”â€”Seek</h2>
<p>ä¹‹å‰çš„è¯¾ç¨‹éƒ½æ˜¯å¯¹æ–‡ä»¶æ•´å­˜æ•´å–æ“ä½œï¼Œä½†å®é™…åº”ç”¨ä¸­çš„æ›´å¤šæ˜¯å¯¹æ–‡ä»¶çš„å±€éƒ¨ä¿®æ”¹ã€‚æœ¬èŠ‚å¼•å…¥<code>sys_lseek</code>ï¼Œæ¼”ç¤ºåœ¨æ–‡ä»¶çš„ç»“å°¾è¿½åŠ å†…å®¹ã€‚</p>
<p>é€šè¿‡<code>sys_lseek</code>ä½ å¯ä»¥åœ¨æ–‡ä»¶ä¸­ç§»åŠ¨ä¸€ä¸ªå«æ¸¸æ ‡çš„ç©æ„å„¿ï¼ŒåŒæ—¶ç”¨å­—èŠ‚ä¸ºå•ä½çš„åç§»é‡æ¥ç²¾ç¡®å®šä½ã€‚ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†ç§»åŠ¨åˆ°æ–‡ä»¶ç»“å°¾ï¼Œå¹¶ç”¨ 0 å­—èŠ‚åç§»é‡(è¿™æ ·ä¿è¯æˆ‘ä»¬åœ¨æœ«å°¾å†™å…¥è€Œä¸æ˜¯è¶…å‡º)æ¥å®šä½å†™å…¥çš„ä½ç½®ã€‚åœ¨<code>ECX</code>å’Œ<code>EDX</code>ä¸­å°è¯•ä¸åŒçš„å€¼åœ¨æ–‡ä»¶çš„ä¸åŒä½ç½®å†™å…¥ã€‚</p>
<p><code>sys_lseek</code>çš„3ä¸ªå‚æ•°è¿™æ ·ä¼ é€’ï¼š</p>
<ul>
<li><code>EDX</code>ä¿å­˜ä»å“ªå¼€å§‹ï¼Œå¯é€‰çš„å€¼å¦‚ä¸‹è¡¨</li>
</ul>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
<th>å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>SEEK_SET</td>
<td>æ–‡ä»¶çš„å¼€å¤´</td>
<td>0</td>
</tr>
<tr>
<td>SEEK_CUR</td>
<td>å½“å‰ä½ç½®åç§»é‡</td>
<td>1</td>
</tr>
<tr>
<td>SEEK_END</td>
<td>æ–‡ä»¶çš„ç»“å°¾</td>
<td>2</td>
</tr>
</tbody>
</table>
<ul>
<li>åç§»é‡å­˜è¿›<code>ECX</code></li>
<li>æœ€åè‡ªç„¶å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦äº†ï¼Œç”±<code>EBX</code>å­˜å‚¨</li>
</ul>
<p>OPCODE 19 è½½å…¥<code>EAX</code>ï¼Œ<code>INT 80h</code> å¼€è°ƒã€‚å®šä½åˆ°æœŸæœ›çš„ä½ç½®åï¼Œæˆ‘ä»¬è°ƒç”¨äº†<code>sys_write</code>æ›´æ–°æ–‡ä»¶çš„å†…å®¹ã€‚</p>

<div class="notices note">
    <div class="label">æ³¨æ„</div>
    <p>æœ¬ç¨‹åºæ²¡æœ‰åˆ›å»ºæ–‡ä»¶çš„è¿‡ç¨‹ï¼Œæ˜¯åœ¨å·²ç»å­˜åœ¨çš„ readme.txt æ–‡ä»¶ä¸Šæ“ä½œçš„ã€‚ç¨‹åºè¿è¡Œåè¯¥æ–‡ä»¶çš„å†…å®¹å°†è¢«æ›´æ–°</p>

  </div>

<h3 id="æœ‰è¯·æˆ‘ä»¬çš„ç¬¬è´°æ‹¾æŸ’ä¸ªæ±‡ç¼–ç¨‹åºä¸Šä¸‹æ±‚ç´¢">æœ‰è¯·æˆ‘ä»¬çš„ç¬¬è´°æ‹¾æŸ’ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”ä¸Šä¸‹æ±‚ç´¢</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Seek</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf seek.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 seek.o -o seek</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./seek</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include    &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">filename</span> <span class="nv">db</span> <span class="s">&#39;readme.txt&#39;</span><span class="p">,</span> <span class="mh">0h</span>    <span class="c1">; the filename to create</span>
<span class="ln">10</span><span class="nf">contents</span>  <span class="nv">db</span> <span class="s">&#39;-updated-&#39;</span><span class="p">,</span> <span class="mh">0h</span>     <span class="c1">; the contents to write at the start of the file</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">13</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">14</span> 
<span class="ln">15</span><span class="nl">_start:</span>
<span class="ln">16</span> 
<span class="ln">17</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">1</span>              <span class="c1">; flag for writeonly access mode (O_WRONLY)</span>
<span class="ln">18</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nv">filename</span>       <span class="c1">; filename of the file to open</span>
<span class="ln">19</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">5</span>              <span class="c1">; invoke SYS_OPEN (kernel opcode 5)</span>
<span class="ln">20</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">21</span> 
<span class="ln">22</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">2</span>              <span class="c1">; whence argument (SEEK_END)</span>
<span class="ln">23</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="mi">0</span>              <span class="c1">; move the cursor 0 bytes</span>
<span class="ln">24</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; move the opened file descriptor into EBX</span>
<span class="ln">25</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">19</span>             <span class="c1">; invoke SYS_LSEEK (kernel opcode 19)</span>
<span class="ln">26</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">27</span> 
<span class="ln">28</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">9</span>              <span class="c1">; number of bytes to write - one for each letter of our contents string</span>
<span class="ln">29</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">contents</span>       <span class="c1">; move the memory address of our contents string into ecx</span>
<span class="ln">30</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">ebx</span>            <span class="c1">; move the opened file descriptor into EBX (not required as EBX already has the FD)</span>
<span class="ln">31</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>              <span class="c1">; invoke SYS_WRITE (kernel opcode 4)</span>
<span class="ln">32</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">33</span> 
<span class="ln">34</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf seek.asm
<span class="ln">2</span>$ ld -m elf_i386 seek.o -o seek
<span class="ln">3</span>$ ./seek
</code></pre></div><hr>
<h2 id="lesson-28-æ–‡ä»¶æ“ä½œdelete">Lesson 28 æ–‡ä»¶æ“ä½œâ€”â€”Delete</h2>
<p>æ–‡ä»¶åˆ é™¤åœ¨ Linux ä¸­ç”±ç³»ç»Ÿè°ƒç”¨<code>sys_unlink</code>(å·®ç‚¹å†™æˆ unlike)æä¾›ã€‚</p>
<p><code>sys_unlink</code>åªéœ€è¦ä¸€ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>æŠŠæ–‡ä»¶åæ”¾å…¥<code>EBX</code></li>
</ul>
<p>OPCODE 10 è½½å…¥<code>EAX</code>ï¼Œ<code>INT 80h</code> å¼€è°ƒã€‚</p>

<div class="notices note">
    <div class="label">æ³¨æ„</div>
    <p>readme.txt æ˜¯å·²ç»å­˜åœ¨çš„æ–‡ä»¶ã€‚ç¨‹åºè¿è¡Œå®Œæˆï¼Œè¯¥æ–‡ä»¶å°†è¢«åˆ é™¤</p>

  </div>

<h3 id="æˆ‘ä»¬çš„ç¬¬è´°æ‹¾æŒä¸ªæ±‡ç¼–ç¨‹åºä¸€æ‰«è€Œå°½">æˆ‘ä»¬çš„ç¬¬è´°æ‹¾æŒä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”ä¸€æ‰«è€Œå°½</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Unlink</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf unlink.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 unlink.o -o unlink</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./unlink</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include    &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="nf">filename</span> <span class="nv">db</span> <span class="s">&#39;readme.txt&#39;</span><span class="p">,</span> <span class="mh">0h</span>    <span class="c1">; the filename to delete</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">12</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">13</span> 
<span class="ln">14</span><span class="nl">_start:</span>
<span class="ln">15</span> 
<span class="ln">16</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nv">filename</span>       <span class="c1">; filename we will delete</span>
<span class="ln">17</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">10</span>             <span class="c1">; invoke SYS_UNLINK (kernel opcode 10)</span>
<span class="ln">18</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">19</span> 
<span class="ln">20</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf unlink.asm
<span class="ln">2</span>$ ld -m elf_i386 unlink.o -o unlink
<span class="ln">3</span>$ ./unlink
</code></pre></div><hr>
<h2 id="lesson-29-å¥—æ¥å­—create">Lesson 29 å¥—æ¥å­—â€”â€”Create</h2>
<h3 id="èƒŒæ™¯çŸ¥è¯†èµ°èµ·">èƒŒæ™¯çŸ¥è¯†ï¼Œèµ°èµ·</h3>
<p>Linux ä¸­çš„å¥—æ¥å­—ç¼–ç¨‹ï¼Œè—‰ç”±<code>sys_socketcall</code>å†…æ ¸å‡½æ•°æä¾›ã€‚ä¸æ–‡ä»¶æ“ä½œçš„ä¸€æ—å‡½æ•°ä¸åŒï¼Œä»–ä¸€äººå°±å°è£…äº†å¥—æ¥å­—ç›¸å…³çš„å…¨éƒ¨æ“ä½œï¼Œå…¨éƒ½ä»¥å­ä¾‹ç¨‹çš„å½¢å¼å­˜åœ¨å…¶ä¸­ã€‚æˆ‘ä»¬é€šè¿‡åœ¨<code>EBX</code>ä¸­ä¼ é€’ç»™ä»–ä¸åŒçš„å€¼ï¼Œæ¥åŒºåˆ†è¯¸å¦‚ï¼šåˆ›å»ºã€ç›‘å¬ã€å‘é€ã€æ¥å—ã€å…³é—­ç­‰æ“ä½œã€‚è¿™é‡Œæœ‰<a href="https://gist.github.com/DGivney/7196bd7a9f21a12c9397bdcf9ae040d2">è¯¦ç»†æ³¨é‡Šçš„å®Œæ•´ç¨‹åº</a>ä»¥ä¾›å‚è€ƒã€‚</p>
<p>å‘èµ·ç³»ç»Ÿè°ƒç”¨å‰ï¼Œéœ€è¦åˆå§‹åŒ–ä¸€äº›å¯„å­˜å™¨ï¼Œç”¨ä»¥å­˜å‚¨åé¢çš„é‡è¦æ•°æ®ã€‚æ¥ç€è°ƒç”¨<code>sys_socketcall</code>çš„ç¬¬ä¸€ä¸ªå­ä¾‹ç¨‹<code>socket</code>æ¥åˆ›å»ºå¥—æ¥å­—ã€‚ä¹‹åçš„è¯¾ç¨‹ä¸­ï¼Œå°†åœ¨æ­¤ç¨‹åºåŸºç¡€ä¸ŠæŒ‰éœ€æ‰©å……ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬å°†æ‹¥æœ‰ä¸€ä¸ªåŒ…å«ï¼šåˆ›å»ºã€ç»‘å®šã€ç›‘å¬ã€æ¥å—ã€è¯»å–ã€å†™å…¥å’Œå…³é—­çš„å®Œæ•´å¥—æ¥å­—ç¨‹åºã€‚</p>
<p><code>sys_socketcall</code>çš„å­ä¾‹ç¨‹<code>socket</code>æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>å‚æ•°æ•°ç»„çš„æŒ‡é’ˆç”±<code>ECX</code>ä¿å­˜</li>
<li>æ•´æ•° 1 ç”±<code>EBX</code>ä¿å­˜</li>
</ul>
<p>OPCODE 102 è½½å…¥<code>EAX</code>ï¼Œ<code>INT 80h</code> å¼€è°ƒã€‚</p>
<p>åœ¨ Linux ä¸­<strong>ä¸€åˆ‡çš†æ–‡ä»¶</strong>ï¼ŒæˆåŠŸåˆ›å»ºåçš„å¥—æ¥å­—å°†ä½œä¸ºæ–‡ä»¶æè¿°ç¬¦(FD)ç”±<code>EAX</code>è¿”å›ç»™ç”¨æˆ·ç¨‹åºã€‚è¿™ä¸ª FD å°†ç”¨æ¥å®æ–½å…¶ä»–çš„å¥—æ¥å­—å‡½æ•°ã€‚</p>

<div class="notices tip">
    <div class="label">æç¤º</div>
    <p>ä¸€ä¸ªå¯„å­˜å™¨å¯¹è‡ªèº«è¿›è¡Œ XOR å¼‚æˆ–æ˜¯åˆå§‹åŒ–(æ¸…é›¶)çš„å¥½åŠæ³•ï¼Œè¿™å¯ä»¥ç¡®ä¿å…¶ä¸­ä¸åŒ…å«æ„å¤–çš„å€¼ï¼Œä»è€Œé¿å…ç¨‹åºå´©æºƒã€‚</p>

  </div>

<h3 id="å¥—æ¥å­—æˆ‘ä»¬çš„ç¬¬è´°æ‹¾ç–ä¸ªæ±‡ç¼–ç¨‹åºæ¥äº†åªå¦‚åˆè§">å¥—æ¥å­—ï¼Œæˆ‘ä»¬çš„ç¬¬è´°æ‹¾ç–ä¸ªæ±‡ç¼–ç¨‹åºæ¥äº†â€”â€”åªå¦‚åˆè§</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Socket</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf socket.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 socket.o -o socket</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./socket</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include    &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln"> 9</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="nl">_start:</span>
<span class="ln">12</span> 
<span class="ln">13</span>    <span class="nf">xor</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; init eax 0</span>
<span class="ln">14</span>    <span class="nf">xor</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">ebx</span>            <span class="c1">; init ebx 0</span>
<span class="ln">15</span>    <span class="nf">xor</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">edi</span>            <span class="c1">; init edi 0</span>
<span class="ln">16</span>    <span class="nf">xor</span>     <span class="nb">esi</span><span class="p">,</span> <span class="nb">esi</span>            <span class="c1">; init esi 0</span>
<span class="ln">17</span> 
<span class="ln">18</span><span class="nl">_socket:</span>
<span class="ln">19</span> 
<span class="ln">20</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">6</span>              <span class="c1">; push 6 onto the stack (IPPROTO_TCP)</span>
<span class="ln">21</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">1</span>              <span class="c1">; push 1 onto the stack (SOCK_STREAM)</span>
<span class="ln">22</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">2</span>              <span class="c1">; push 2 onto the stack (PF_INET)</span>
<span class="ln">23</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>            <span class="c1">; move address of arguments into ecx</span>
<span class="ln">24</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>              <span class="c1">; invoke subroutine SOCKET (1)</span>
<span class="ln">25</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>            <span class="c1">; invoke SYS_SOCKETCALL (kernel opcode 102)</span>
<span class="ln">26</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">27</span> 
<span class="ln">28</span>    <span class="nf">call</span>    <span class="nv">iprintLF</span>            <span class="c1">; call our integer printing function (print the file descriptor in EAX or -1 on error)</span>
<span class="ln">29</span> 
<span class="ln">30</span><span class="nl">_exit:</span>
<span class="ln">31</span> 
<span class="ln">32</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf socket.asm
<span class="ln">2</span>$ ld -m elf_i386 socket.o -o socket
<span class="ln">3</span>$ ./socket
<span class="ln">4</span><span class="m">3</span>
</code></pre></div><hr>
<h2 id="lesson-30-å¥—æ¥å­—bind">Lesson 30 å¥—æ¥å­—â€”â€”Bind</h2>
<p>ä¸Šä¸€èŠ‚å®Œæˆäº†å¥—æ¥å­—çš„åˆ›å»ºï¼Œç°åœ¨æˆ‘ä»¬ä¸ºè¿™ä¸ªå¥—æ¥å­—å…³è”ä¸€ä¸ªæœ¬åœ° IP å’Œç«¯å£ä»¥ä¾¿å…¶ä»–ç¨‹åºä¸å…¶å»ºç«‹è¿æ¥ã€‚è¿™ä¸ªä»»åŠ¡ç”±<code>sys_cocketcall</code>çš„ç¬¬äºŒä¸ªå­ä¾‹ç¨‹<code>bind</code>å®Œæˆã€‚</p>
<p>è¿™é‡Œå¼•å…¥æ–°çš„å¯„å­˜å™¨<code>EDI</code>æ¥å­˜å‚¨å¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦(FD)ã€‚<code>EDI</code>â€”â€”ç›®æ ‡ç´¢å¼•å¯„å­˜å™¨ï¼ŒåŸåšæ‹·è´è¿‡ç¨‹ä¸­å­˜å‚¨ç›®æ ‡æ–‡ä»¶çš„ä½ç½®ä¹‹ç”¨ã€‚</p>
<p><code>sys_socketcall</code>çš„å­ä¾‹ç¨‹<code>bind</code>ä¹Ÿæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>å‚æ•°æ•°ç»„çš„æŒ‡é’ˆç”±<code>ECX</code>ä¿å­˜</li>
<li>æ•´æ•° 2 ç”±<code>EBX</code>ä¿å­˜</li>
</ul>
<p>OPCODE 102 è½½å…¥<code>EAX</code>ï¼Œ<code>INT 80h</code> å¼€è°ƒã€‚</p>
<h3 id="ç¬¬åæ‹¾ä¸ªæ±‡ç¼–ç¨‹åºä¸€æœæ¯”ç¿¼">ç¬¬åæ‹¾ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”ä¸€æœæ¯”ç¿¼</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Socket</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf socket.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 socket.o -o socket</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./socket</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include    &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln"> 9</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="nl">_start:</span>
<span class="ln">12</span> 
<span class="ln">13</span>    <span class="nf">xor</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; initialize some registers</span>
<span class="ln">14</span>    <span class="nf">xor</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">ebx</span>
<span class="ln">15</span>    <span class="nf">xor</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">edi</span>
<span class="ln">16</span>    <span class="nf">xor</span>     <span class="nb">esi</span><span class="p">,</span> <span class="nb">esi</span>
<span class="ln">17</span> 
<span class="ln">18</span><span class="nl">_socket:</span>
<span class="ln">19</span> 
<span class="ln">20</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">6</span>              <span class="c1">; create socket from lesson 29</span>
<span class="ln">21</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">1</span>
<span class="ln">22</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">2</span>
<span class="ln">23</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln">24</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln">25</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln">26</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">27</span> 
<span class="ln">28</span><span class="nl">_bind:</span>
<span class="ln">29</span> 
<span class="ln">30</span>    <span class="nf">mov</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; move return value of SYS_SOCKETCALL into edi (file descriptor for new socket, or -1 on error)</span>
<span class="ln">31</span>    <span class="nf">push</span>    <span class="kt">dword</span> <span class="mh">0x00000000</span>    <span class="c1">; push 0 dec onto the stack IP ADDRESS (0.0.0.0)</span>
<span class="ln">32</span>    <span class="nf">push</span>    <span class="kt">word</span> <span class="mh">0x2923</span>         <span class="c1">; push 9001 dec onto stack PORT (reverse byte order)</span>
<span class="ln">33</span>    <span class="nf">push</span>    <span class="kt">word</span> <span class="mi">2</span>              <span class="c1">; push 2 dec onto stack AF_INET</span>
<span class="ln">34</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>            <span class="c1">; move address of stack pointer into ecx</span>
<span class="ln">35</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">16</span>             <span class="c1">; push 16 dec onto stack (arguments length)</span>
<span class="ln">36</span>    <span class="nf">push</span>    <span class="nb">ecx</span>                 <span class="c1">; push the address of arguments onto stack</span>
<span class="ln">37</span>    <span class="nf">push</span>    <span class="nb">edi</span>                 <span class="c1">; push the file descriptor onto stack</span>
<span class="ln">38</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>            <span class="c1">; move address of arguments into ecx</span>
<span class="ln">39</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">2</span>              <span class="c1">; invoke subroutine BIND (2)</span>
<span class="ln">40</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>            <span class="c1">; invoke SYS_SOCKETCALL (kernel opcode 102)</span>
<span class="ln">41</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">42</span> 
<span class="ln">43</span><span class="nl">_exit:</span>
<span class="ln">44</span> 
<span class="ln">45</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf socket.asm
<span class="ln">2</span>$ ld -m elf_i386 socket.o -o socket
<span class="ln">3</span>$ ./socket
</code></pre></div><hr>
<h2 id="lesson-31-å¥—æ¥å­—listen">Lesson 31 å¥—æ¥å­—â€”â€”Listen</h2>
<p>ä¸Šä¸€èŠ‚å®Œæˆäº†å¥—æ¥å­—çš„ç»‘å®šã€‚ä¸‹é¢ç”±<code>sys_socketcall</code>çš„<code>listen</code>å­ä¾‹ç¨‹å‘Šè¯‰æˆ‘ä»¬çš„å¥—æ¥å­—ç›‘å¬<code>TCP</code>çš„å…¥ç«™è¯·æ±‚ã€‚è¿™æ˜¯åœ¨å¥—æ¥å­—ä¸Šå¯¹ä¸æˆ‘ä»¬ç›¸äº’è¿æ¥çš„ç¨‹åºè¿›è¡Œè¯»å†™çš„å‰æã€‚</p>
<p><code>sys_socketcall</code>çš„å­ä¾‹ç¨‹<code>listen</code>ä¹Ÿæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>å‚æ•°æ•°ç»„çš„æŒ‡é’ˆç”±<code>ECX</code>ä¿å­˜</li>
<li>æ•´æ•° 4 ç”±<code>EBX</code>ä¿å­˜</li>
</ul>
<p>OPCODE 102 è½½å…¥<code>EAX</code>ï¼Œ<code>INT 80h</code> å¼€è°ƒã€‚è°ƒç”¨æˆåŠŸåï¼Œå¥—æ¥å­—å³å¼€å§‹ç›‘å¬å…¥ç«™è¯·æ±‚ã€‚</p>
<h3 id="æˆ‘ä»¬çš„ç¬¬åæ‹¾å£¹ä¸ªæ±‡ç¼–ç¨‹åºä¼«å€™ä½³éŸ³">æˆ‘ä»¬çš„ç¬¬åæ‹¾å£¹ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”ä¼«å€™ä½³éŸ³</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Socket</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf socket.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 socket.o -o socket</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./socket</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include    &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln"> 9</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="nl">_start:</span>
<span class="ln">12</span> 
<span class="ln">13</span>    <span class="nf">xor</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; initialize some registers</span>
<span class="ln">14</span>    <span class="nf">xor</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">ebx</span>
<span class="ln">15</span>    <span class="nf">xor</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">edi</span>
<span class="ln">16</span>    <span class="nf">xor</span>     <span class="nb">esi</span><span class="p">,</span> <span class="nb">esi</span>
<span class="ln">17</span> 
<span class="ln">18</span><span class="nl">_socket:</span>
<span class="ln">19</span> 
<span class="ln">20</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">6</span>              <span class="c1">; create socket from lesson 29</span>
<span class="ln">21</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">1</span>
<span class="ln">22</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">2</span>
<span class="ln">23</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln">24</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln">25</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln">26</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">27</span> 
<span class="ln">28</span><span class="nl">_bind:</span>
<span class="ln">29</span> 
<span class="ln">30</span>    <span class="nf">mov</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; bind socket from lesson 30</span>
<span class="ln">31</span>    <span class="nf">push</span>    <span class="kt">dword</span> <span class="mh">0x00000000</span>
<span class="ln">32</span>    <span class="nf">push</span>    <span class="kt">word</span> <span class="mh">0x2923</span>
<span class="ln">33</span>    <span class="nf">push</span>    <span class="kt">word</span> <span class="mi">2</span>
<span class="ln">34</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln">35</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">16</span>
<span class="ln">36</span>    <span class="nf">push</span>    <span class="nb">ecx</span>
<span class="ln">37</span>    <span class="nf">push</span>    <span class="nb">edi</span>
<span class="ln">38</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln">39</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">2</span>
<span class="ln">40</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln">41</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">42</span> 
<span class="ln">43</span><span class="nl">_listen:</span>
<span class="ln">44</span> 
<span class="ln">45</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">1</span>              <span class="c1">; move 1 onto stack (max queue length argument)</span>
<span class="ln">46</span>    <span class="nf">push</span>    <span class="nb">edi</span>                 <span class="c1">; push the file descriptor onto stack</span>
<span class="ln">47</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>            <span class="c1">; move address of arguments into ecx</span>
<span class="ln">48</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">4</span>              <span class="c1">; invoke subroutine LISTEN (4)</span>
<span class="ln">49</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>            <span class="c1">; invoke SYS_SOCKETCALL (kernel opcode 102)</span>
<span class="ln">50</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">51</span> 
<span class="ln">52</span><span class="nl">_exit:</span>
<span class="ln">53</span> 
<span class="ln">54</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf socket.asm
<span class="ln">2</span>$ ld -m elf_i386 socket.o -o socket
<span class="ln">3</span>$ ./socket
</code></pre></div><hr>
<h2 id="lesson-32-å¥—æ¥å­—accept">Lesson 32 å¥—æ¥å­—â€”â€”Accept</h2>
<p>å‰é¢çš„è¯¾ç¨‹éƒ½æ˜¯å¥—æ¥å­—çš„å‡†å¤‡å·¥ä½œã€‚å…¥ç«™è¯·æ±‚åˆ°è¾¾åï¼Œè¿˜å¿…é¡»æœ‰æ¥å—é€»è¾‘ï¼Œè¿™ç”±<code>sys_socketcall</code>çš„<code>accept</code>å­ä¾‹ç¨‹å®ç°ã€‚è¿›å…¥ ACCEPT çŠ¶æ€çš„å¥—æ¥å­—å¯ä»¥åœ¨è¿œç¨‹è¿æ¥ä¸Šè¿›è¡Œè¯»å†™ã€‚</p>
<p><code>sys_socketcall</code>çš„å­ä¾‹ç¨‹<code>accept</code>ä¹Ÿæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>å‚æ•°æ•°ç»„çš„æŒ‡é’ˆç”±<code>ECX</code>ä¿å­˜</li>
<li>æ•´æ•° 5 ç”±<code>EBX</code>ä¿å­˜</li>
</ul>
<p>OPCODE 102 è½½å…¥<code>EAX</code>ï¼Œ<code>INT 80h</code> å¼€è°ƒã€‚<code>accept</code>å­ä¾‹ç¨‹å°†åˆ›å»ºå¦ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦(FD)ï¼Œç”¨ä»¥æ ‡è¯†å…¥ç«™è¿æ¥ã€‚æˆ‘ä»¬åé¢çš„è¯¾ç¨‹å°†ä½¿ç”¨è¿™ä¸ª FD æ¥è¿›è¡Œå®é™…çš„è¯»å†™æ“ä½œã€‚</p>

<div class="notices tip">
    <div class="label">æç¤º</div>
    <p>è¿è¡Œæœ¬ç¨‹åºåï¼Œå¼€å¯å¦ä¸€ä¸ªç»ˆç«¯çª—å£ï¼Œé”®å…¥<code>sudo netstat -plnt</code>æŸ¥çœ‹ 9001 ç«¯å£æ˜¯å¦åœ¨ç›‘å¬ä¹‹ä¸­</p>

  </div>

<h3 id="ç¬¬åæ‹¾è´°ä¸ªæ±‡ç¼–ç¨‹åºå®¾è‡³å¦‚å½’">ç¬¬åæ‹¾è´°ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”å®¾è‡³å¦‚å½’</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Socket</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf socket.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 socket.o -o socket</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./socket</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include    &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln"> 9</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="nl">_start:</span>
<span class="ln">12</span> 
<span class="ln">13</span>    <span class="nf">xor</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; initialize some registers</span>
<span class="ln">14</span>    <span class="nf">xor</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">ebx</span>
<span class="ln">15</span>    <span class="nf">xor</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">edi</span>
<span class="ln">16</span>    <span class="nf">xor</span>     <span class="nb">esi</span><span class="p">,</span> <span class="nb">esi</span>
<span class="ln">17</span> 
<span class="ln">18</span><span class="nl">_socket:</span>
<span class="ln">19</span> 
<span class="ln">20</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">6</span>              <span class="c1">; create socket from lesson 29</span>
<span class="ln">21</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">1</span>
<span class="ln">22</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">2</span>
<span class="ln">23</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln">24</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln">25</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln">26</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">27</span> 
<span class="ln">28</span><span class="nl">_bind:</span>
<span class="ln">29</span> 
<span class="ln">30</span>    <span class="nf">mov</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; bind socket from lesson 30</span>
<span class="ln">31</span>    <span class="nf">push</span>    <span class="kt">dword</span> <span class="mh">0x00000000</span>
<span class="ln">32</span>    <span class="nf">push</span>    <span class="kt">word</span> <span class="mh">0x2923</span>
<span class="ln">33</span>    <span class="nf">push</span>    <span class="kt">word</span> <span class="mi">2</span>
<span class="ln">34</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln">35</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">16</span>
<span class="ln">36</span>    <span class="nf">push</span>    <span class="nb">ecx</span>
<span class="ln">37</span>    <span class="nf">push</span>    <span class="nb">edi</span>
<span class="ln">38</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln">39</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">2</span>
<span class="ln">40</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln">41</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">42</span> 
<span class="ln">43</span><span class="nl">_listen:</span>
<span class="ln">44</span> 
<span class="ln">45</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">1</span>              <span class="c1">; listen socket from lesson 31</span>
<span class="ln">46</span>    <span class="nf">push</span>    <span class="nb">edi</span>
<span class="ln">47</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln">48</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">4</span>
<span class="ln">49</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln">50</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">51</span> 
<span class="ln">52</span><span class="nl">_accept:</span>
<span class="ln">53</span> 
<span class="ln">54</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">0</span>              <span class="c1">; push 0 dec onto stack (address length argument)</span>
<span class="ln">55</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">0</span>              <span class="c1">; push 0 dec onto stack (address argument)</span>
<span class="ln">56</span>    <span class="nf">push</span>    <span class="nb">edi</span>                 <span class="c1">; push the file descriptor onto stack</span>
<span class="ln">57</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>            <span class="c1">; move address of arguments into ecx</span>
<span class="ln">58</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">5</span>              <span class="c1">; invoke subroutine ACCEPT (5)</span>
<span class="ln">59</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>            <span class="c1">; invoke SYS_SOCKETCALL (kernel opcode 102)</span>
<span class="ln">60</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">61</span> 
<span class="ln">62</span><span class="nl">_exit:</span>
<span class="ln">63</span> 
<span class="ln">64</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf socket.asm
<span class="ln">2</span>$ ld -m elf_i386 socket.o -o socket
<span class="ln">3</span>$ ./socket
</code></pre></div><hr>
<h2 id="lesson-33-å¥—æ¥å­—read">Lesson 33 å¥—æ¥å­—â€”â€”Read</h2>
<p>å¥—æ¥å­—ä¹Ÿå»ºç«‹äº†ï¼Œåœ°å€å’Œç«¯å£ä¹Ÿç»‘å®šäº†ï¼Œç›‘å¬ä¸­çš„å¥—æ¥å­—æ¥å—äº†å…¥ç«™è¿æ¥ï¼Œç°åœ¨è¯¥è®©æˆ‘ä»¬çœ‹çœ‹è¿œç«¯å‘æ¥çš„è¯·æ±‚é‡Œæœ‰ä»€ä¹ˆäº†å§â€¦â€¦</p>
<p>å½“å…¥ç«™è¿æ¥è¢«å¥—æ¥å­—æ¥å—åï¼Œä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦(FD)é€šè¿‡<code>EAX</code>è¿”å›ç»™ç”¨æˆ·ç¨‹åºã€‚æœ¬èŠ‚å°†ä½¿ç”¨è¿™ä¸ª FD ä»è¿æ¥ä¸­è¯»å–è¯·æ±‚å¤´ã€‚</p>
<p>å…ˆå°†è·å–åˆ°çš„ FD å­˜å…¥<code>ESI</code>å¯„å­˜å™¨â€”â€”åŸå€ç´¢å¼•å¯„å­˜å™¨ï¼ŒåŸåšæ‹·è´è¿‡ç¨‹ä¸­å­˜å‚¨æ¥æºæ–‡ä»¶çš„ä½ç½®ä¹‹ç”¨ã€‚</p>
<p><code>sys_read</code>æ˜¯æˆ‘ä»¬çš„è€æœ‹å‹äº†ï¼Œå°±é å®ƒä»å¥—æ¥å­—è¿æ¥ä¸­è¯»å–æ•°æ®ã€‚æ­£å¦‚å‰é¢çš„è¯¾ç¨‹ä¸­æ‰€åšçš„ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªå˜é‡æ¥ä¿å­˜ä» FD ä¸­è¯»å–çš„å†…å®¹ã€‚æœ¬ä¾‹çš„å¥—æ¥å­—ä½¿ç”¨ä¼ è¯´ä¸­çš„<code>HTTP</code>åè®®è¿›è¡Œé€šè®¯ã€‚åˆ†æ<code>HTTP</code>è¯·æ±‚å¤´éƒ¨ï¼Œè¿›è€Œç¡®è®¤å…¥ç«™æ¶ˆæ¯çš„é•¿åº¦ã€å®¢æˆ·ç«¯æ¥æ”¶çš„å“åº”æ ¼å¼ç­‰å†…å®¹è¶…å‡ºäº†æœ¬æ•™ç¨‹çš„èŒƒç•´ã€‚ä¸ºäº†ç®€åŒ–ï¼Œåªè¯»å–å‰ 255 ä¸ªå­—èŠ‚å¹¶æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚</p>
<p>ä¸€æ—¦å…¥ç«™è¿æ¥è¢«æ¥å—ï¼ŒWeb æœåŠ¡å™¨é€šå¸¸ä¼šç”Ÿæˆä¸€ä¸ªå­è¿›ç¨‹æ¥æ¥ç®¡è¯»/å†™é€šä¿¡ã€‚çˆ¶è¿›ç¨‹å¾—ä»¥æŠ½èº«ç»§ç»­ç›‘å¬å’Œæ¥æ”¶æ–°çš„è¯·æ±‚ã€‚æˆ‘ä»¬å°±ç”¨å‰ä¸ä¹…å­¦è¿‡çš„<code>sys_fock</code>ç³»ç»Ÿè°ƒç”¨å’Œ<code>JMP</code>æ±‡ç¼–æŒ‡ä»¤æ¥å®ç°è¿™ä¸€æ¨¡å¼ã€‚</p>
<p>ä½¿ç”¨ curl å·¥å…·ä½œä¸ºå®¢æˆ·ç«¯æ¥å¸®æˆ‘ä»¬ç”Ÿæˆæœ‰æ•ˆçš„è¯·æ±‚å¤´ï¼Œå¹¶è¿æ¥åˆ°å¥—æ¥å­—ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æµè§ˆå™¨ã€‚</p>

<div class="notices note">
    <div class="label">æ³¨æ„</div>
    <p>æˆ‘ä»¬åœ¨ .bss æ®µé¢„ç•™ 255 å­—èŠ‚ç©ºé—´ç”¨ä»¥å­˜å‚¨ä» FD ä¸­è¯»å–åˆ°çš„å†…å®¹ã€‚.bss æ®µçš„ä¿¡æ¯å¯ä»¥å›é¡¾ <a href="#lesson-9-%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%87%BA">Lesson 9</a></p>

  </div>


<div class="notices tip">
    <div class="label">æç¤º</div>
    <p>ç¨‹åºè¿è¡Œèµ·æ¥åï¼Œåœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£çš„å‘½ä»¤è¡Œè¾“å…¥<code>curl http://localhost:9001</code>æ¥æŸ¥çœ‹ç¨‹åºè¯»å–åˆ°çš„è¯·æ±‚å¤´</p>

  </div>

<h3 id="æˆ‘ä»¬çš„ç¬¬åæ‹¾åä¸ªæ±‡ç¼–ç¨‹åºç›®è¥å¿ƒåŒ ">æˆ‘ä»¬çš„ç¬¬åæ‹¾åä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”ç›®è¥å¿ƒåŒ </h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Socket</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf socket.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 socket.o -o socket</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./socket</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include    &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.bss</span>
<span class="ln"> 9</span><span class="nf">buffer</span> <span class="nv">resb</span> <span class="mi">255</span><span class="p">,</span>                <span class="c1">; variable to store request headers</span>
<span class="ln">10</span> 
<span class="ln">11</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">12</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">13</span> 
<span class="ln">14</span><span class="nl">_start:</span>
<span class="ln">15</span> 
<span class="ln">16</span>    <span class="nf">xor</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; initialize some registers</span>
<span class="ln">17</span>    <span class="nf">xor</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">ebx</span>
<span class="ln">18</span>    <span class="nf">xor</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">edi</span>
<span class="ln">19</span>    <span class="nf">xor</span>     <span class="nb">esi</span><span class="p">,</span> <span class="nb">esi</span>
<span class="ln">20</span> 
<span class="ln">21</span><span class="nl">_socket:</span>
<span class="ln">22</span> 
<span class="ln">23</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">6</span>              <span class="c1">; create socket from lesson 29</span>
<span class="ln">24</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">1</span>
<span class="ln">25</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">2</span>
<span class="ln">26</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln">27</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln">28</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln">29</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">30</span> 
<span class="ln">31</span><span class="nl">_bind:</span>
<span class="ln">32</span> 
<span class="ln">33</span>    <span class="nf">mov</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; bind socket from lesson 30</span>
<span class="ln">34</span>    <span class="nf">push</span>    <span class="kt">dword</span> <span class="mh">0x00000000</span>
<span class="ln">35</span>    <span class="nf">push</span>    <span class="kt">word</span> <span class="mh">0x2923</span>
<span class="ln">36</span>    <span class="nf">push</span>    <span class="kt">word</span> <span class="mi">2</span>
<span class="ln">37</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln">38</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">16</span>
<span class="ln">39</span>    <span class="nf">push</span>    <span class="nb">ecx</span>
<span class="ln">40</span>    <span class="nf">push</span>    <span class="nb">edi</span>
<span class="ln">41</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln">42</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">2</span>
<span class="ln">43</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln">44</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">45</span> 
<span class="ln">46</span><span class="nl">_listen:</span>
<span class="ln">47</span> 
<span class="ln">48</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">1</span>              <span class="c1">; listen socket from lesson 31</span>
<span class="ln">49</span>    <span class="nf">push</span>    <span class="nb">edi</span>
<span class="ln">50</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln">51</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">4</span>
<span class="ln">52</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln">53</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">54</span> 
<span class="ln">55</span><span class="nl">_accept:</span>
<span class="ln">56</span> 
<span class="ln">57</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">0</span>              <span class="c1">; accept socket from lesson 32</span>
<span class="ln">58</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">0</span>
<span class="ln">59</span>    <span class="nf">push</span>    <span class="nb">edi</span>
<span class="ln">60</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln">61</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">5</span>
<span class="ln">62</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln">63</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln">64</span> 
<span class="ln">65</span><span class="nl">_fork:</span>
<span class="ln">66</span> 
<span class="ln">67</span>    <span class="nf">mov</span>     <span class="nb">esi</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; move return value of SYS_SOCKETCALL into esi (file descriptor for accepted socket, or -1 on error)</span>
<span class="ln">68</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">2</span>              <span class="c1">; invoke SYS_FORK (kernel opcode 2)</span>
<span class="ln">69</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">70</span> 
<span class="ln">71</span>    <span class="nf">cmp</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">0</span>              <span class="c1">; if return value of SYS_FORK in eax is zero we are in the child process</span>
<span class="ln">72</span>    <span class="nf">jz</span>      <span class="nv">_read</span>               <span class="c1">; jmp in child process to _read</span>
<span class="ln">73</span> 
<span class="ln">74</span>    <span class="nf">jmp</span>     <span class="nv">_accept</span>             <span class="c1">; jmp in parent process to _accept</span>
<span class="ln">75</span> 
<span class="ln">76</span><span class="nl">_read:</span>
<span class="ln">77</span> 
<span class="ln">78</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">255</span>            <span class="c1">; number of bytes to read (we will only read the first 255 bytes for simplicity)</span>
<span class="ln">79</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">buffer</span>         <span class="c1">; move the memory address of our buffer variable into ecx</span>
<span class="ln">80</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">esi</span>            <span class="c1">; move esi into ebx (accepted socket file descriptor)</span>
<span class="ln">81</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">3</span>              <span class="c1">; invoke SYS_READ (kernel opcode 3)</span>
<span class="ln">82</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">83</span> 
<span class="ln">84</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">buffer</span>         <span class="c1">; move the memory address of our buffer variable into eax for printing</span>
<span class="ln">85</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rintLF</span>            <span class="c1">; call our string printing function</span>
<span class="ln">86</span> 
<span class="ln">87</span><span class="nl">_exit:</span>
<span class="ln">88</span> 
<span class="ln">89</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf socket.asm
<span class="ln">2</span>$ ld -m elf_i386 socket.o -o socket
<span class="ln">3</span>$ ./socket
<span class="ln">4</span>GET / HTTP/1.1
<span class="ln">5</span>Host: localhost:9001
<span class="ln">6</span>User-Agent: curl/x.xx.x
<span class="ln">7</span>Accept: */*
</code></pre></div><hr>
<h2 id="lesson-34-å¥—æ¥å­—write">Lesson 34 å¥—æ¥å­—â€”â€”Write</h2>
<p>ä¸Šä¸€èŠ‚ä»‹ç»å®Œåœ¨å¥—æ¥å­—ä¸Šè¯»å–ï¼Œæœ¬èŠ‚è¯´è¯´å‘å¥—æ¥å­—å†™å…¥ã€‚</p>
<p>å¾—ç›Šäº Linux ä¸­çš„<strong>ä¸€åˆ‡çš†æ–‡ä»¶</strong>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å·²ç»æŒæ¡çš„<code>sys_write</code>å‘å¥—æ¥å­—è¿æ¥å†™å…¥æ•°æ®ã€‚ç¨‹åºä¾ç„¶ä½¿ç”¨<code>HTTP</code>åè®®ã€‚è¿™æ¬¡ä½œä¸ºæœåŠ¡ç«¯çš„æˆ‘ä»¬çš„ç¨‹åºæ²¡äººå¸®å¿™äº†ï¼Œå¿…é¡»è¦è‡ªå·±æ„é€ è§„å®šçš„å“åº”å¤´ç»™å®¢æˆ·ç«¯ç¨‹åºã€‚æ ¼å¼éµå¾ª <a href="https://tools.ietf.org/html/rfc2616?spm=5176.doc32013.2.3.Aimyd7#section-4.2">RFC æ ‡å‡†</a>ã€‚</p>

<div class="notices note">
    <div class="label">æ³¨æ„</div>
    <p>å¯¹äºå·²çŸ¥çš„å€¼ï¼Œä½¿ç”¨ .data æ®µæ¥å­˜å‚¨ã€‚å›é¡¾ <a href="#lesson-1-hello-world">Lesson 1</a> å…³äº .data æ®µçš„ä¿¡æ¯</p>

  </div>


<div class="notices tip">
    <div class="label">æç¤º</div>
    <p>è¿è¡Œç¨‹åºï¼Œåœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£ä¸­è¾“å…¥å‘½ä»¤<code>curl http://localhost:9001</code>æŸ¥çœ‹å“åº”ï¼›æˆ–è€…ä½¿ç”¨æµè§ˆå™¨è®¿é—®ä¸Šè¿°åœ°å€</p>

  </div>

<h3 id="ç¥åŠŸå°†æˆçš„ç¬¬åæ‹¾è‚†ä¸ªæ±‡ç¼–ç¨‹åºå…¶åº”è‹¥å“">ç¥åŠŸå°†æˆçš„ç¬¬åæ‹¾è‚†ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”å…¶åº”è‹¥å“</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln">  1</span><span class="c1">; Socket</span>
<span class="ln">  2</span><span class="c1">; Compile with: nasm -f elf socket.asm</span>
<span class="ln">  3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 socket.o -o socket</span>
<span class="ln">  4</span><span class="c1">; Run with: ./socket</span>
<span class="ln">  5</span><span class="cp"> 
</span><span class="ln">  6</span><span class="cp">%include    &#39;functions.asm&#39;
</span><span class="ln">  7</span><span class="cp"></span> 
<span class="ln">  8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln">  9</span><span class="c1">; our response string</span>
<span class="ln"> 10</span><span class="nf">response</span> <span class="nv">db</span> <span class="s">&#39;HTTP/1.1 200 OK&#39;</span><span class="p">,</span> <span class="mh">0Dh</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="s">&#39;Content-Type: text/html&#39;</span><span class="p">,</span> <span class="mh">0Dh</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="s">&#39;Content-Length: 14&#39;</span><span class="p">,</span> <span class="mh">0Dh</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="mh">0Dh</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="s">&#39;Hello World!&#39;</span><span class="p">,</span> <span class="mh">0Dh</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="mh">0h</span>
<span class="ln"> 11</span> 
<span class="ln"> 12</span><span class="k">SECTION</span> <span class="nv">.bss</span>
<span class="ln"> 13</span><span class="nf">buffer</span> <span class="nv">resb</span> <span class="mi">255</span><span class="p">,</span>                <span class="c1">; variable to store request headers</span>
<span class="ln"> 14</span> 
<span class="ln"> 15</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln"> 16</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln"> 17</span> 
<span class="ln"> 18</span><span class="nl">_start:</span>
<span class="ln"> 19</span> 
<span class="ln"> 20</span>    <span class="nf">xor</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; initialize some registers</span>
<span class="ln"> 21</span>    <span class="nf">xor</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">ebx</span>
<span class="ln"> 22</span>    <span class="nf">xor</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">edi</span>
<span class="ln"> 23</span>    <span class="nf">xor</span>     <span class="nb">esi</span><span class="p">,</span> <span class="nb">esi</span>
<span class="ln"> 24</span> 
<span class="ln"> 25</span><span class="nl">_socket:</span>
<span class="ln"> 26</span> 
<span class="ln"> 27</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">6</span>              <span class="c1">; create socket from lesson 29</span>
<span class="ln"> 28</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">1</span>
<span class="ln"> 29</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">2</span>
<span class="ln"> 30</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln"> 31</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln"> 32</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln"> 33</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln"> 34</span> 
<span class="ln"> 35</span><span class="nl">_bind:</span>
<span class="ln"> 36</span> 
<span class="ln"> 37</span>    <span class="nf">mov</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; bind socket from lesson 30</span>
<span class="ln"> 38</span>    <span class="nf">push</span>    <span class="kt">dword</span> <span class="mh">0x00000000</span>
<span class="ln"> 39</span>    <span class="nf">push</span>    <span class="kt">word</span> <span class="mh">0x2923</span>
<span class="ln"> 40</span>    <span class="nf">push</span>    <span class="kt">word</span> <span class="mi">2</span>
<span class="ln"> 41</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln"> 42</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">16</span>
<span class="ln"> 43</span>    <span class="nf">push</span>    <span class="nb">ecx</span>
<span class="ln"> 44</span>    <span class="nf">push</span>    <span class="nb">edi</span>
<span class="ln"> 45</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln"> 46</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">2</span>
<span class="ln"> 47</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln"> 48</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln"> 49</span> 
<span class="ln"> 50</span><span class="nl">_listen:</span>
<span class="ln"> 51</span> 
<span class="ln"> 52</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">1</span>              <span class="c1">; listen socket from lesson 31</span>
<span class="ln"> 53</span>    <span class="nf">push</span>    <span class="nb">edi</span>
<span class="ln"> 54</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln"> 55</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">4</span>
<span class="ln"> 56</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln"> 57</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln"> 58</span> 
<span class="ln"> 59</span><span class="nl">_accept:</span>
<span class="ln"> 60</span> 
<span class="ln"> 61</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">0</span>              <span class="c1">; accept socket from lesson 32</span>
<span class="ln"> 62</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">0</span>
<span class="ln"> 63</span>    <span class="nf">push</span>    <span class="nb">edi</span>
<span class="ln"> 64</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln"> 65</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">5</span>
<span class="ln"> 66</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln"> 67</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln"> 68</span> 
<span class="ln"> 69</span><span class="nl">_fork:</span>
<span class="ln"> 70</span> 
<span class="ln"> 71</span>    <span class="nf">mov</span>     <span class="nb">esi</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; fork socket from lesson 33</span>
<span class="ln"> 72</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">2</span>
<span class="ln"> 73</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln"> 74</span> 
<span class="ln"> 75</span>    <span class="nf">cmp</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="ln"> 76</span>    <span class="nf">jz</span>      <span class="nv">_read</span>
<span class="ln"> 77</span> 
<span class="ln"> 78</span>    <span class="nf">jmp</span>     <span class="nv">_accept</span>
<span class="ln"> 79</span> 
<span class="ln"> 80</span><span class="nl">_read:</span>
<span class="ln"> 81</span> 
<span class="ln"> 82</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">255</span>            <span class="c1">; read socket from lesson 33</span>
<span class="ln"> 83</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">buffer</span>
<span class="ln"> 84</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">esi</span>
<span class="ln"> 85</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">3</span>
<span class="ln"> 86</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln"> 87</span> 
<span class="ln"> 88</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">buffer</span>
<span class="ln"> 89</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rintLF</span>
<span class="ln"> 90</span> 
<span class="ln"> 91</span><span class="nl">_write:</span>
<span class="ln"> 92</span> 
<span class="ln"> 93</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">78</span>             <span class="c1">; move 78 dec into edx (length in bytes to write)</span>
<span class="ln"> 94</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">response</span>       <span class="c1">; move address of our response variable into ecx</span>
<span class="ln"> 95</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">esi</span>            <span class="c1">; move file descriptor into ebx (accepted socket id)</span>
<span class="ln"> 96</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>              <span class="c1">; invoke SYS_WRITE (kernel opcode 4)</span>
<span class="ln"> 97</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln"> 98</span> 
<span class="ln"> 99</span><span class="nl">_exit:</span>
<span class="ln">100</span> 
<span class="ln">101</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf socket.asm
<span class="ln">2</span>$ ld -m elf_i386 socket.o -o socket
<span class="ln">3</span>$ ./socket
</code></pre></div><p>å†å¼€ä¸€ä¸ªç»ˆç«¯çª—å£</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ curl http://localhost:9001
<span class="ln">2</span>Hello World!
</code></pre></div><hr>
<h2 id="lesson-35-å¥—æ¥å­—close">Lesson 35 å¥—æ¥å­—â€”â€”Close</h2>
<p>åˆä¸€æ¬¡ï¼Œæ¥åˆ°é‡Šæ”¾èµ„æºçš„å…³é”®æ­¥éª¤ï¼æ­£ç¡®çš„å…³é—­é“¾æ¥å’Œå…³é—­æ–‡ä»¶ä¸€æ ·é‡è¦ã€‚åœ¨ç¨‹åºå°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯åï¼Œæˆ‘ä»¬è¦å…³é—­å­è¿›ç¨‹ä¸­çš„æ´»åŠ¨å¥—æ¥å­—ã€‚å½’è¿˜çš„èµ„æºç”¨æ¥æ¥æ”¶æ–°åˆ°æ¥çš„é“¾æ¥ã€‚</p>
<p><code>sys_close</code>ä¸å¤šè¯´ï¼Œç›´æ¥ç§€ç â€”â€”</p>

<div class="notices tip">
    <div class="label">æç¤º</div>
    <p>ç¨‹åºå¯åŠ¨åï¼ŒåŒæ ·æ–°å¼€ä¸€ä¸ªç»ˆç«¯çª—å£æŸ¥çœ‹å“åº”</p>

  </div>

<h3 id="æˆ‘ä»¬çš„ç¬¬åæ‹¾ä¼ä¸ªæ±‡ç¼–ç¨‹åºåŠŸæˆèº«é€€">æˆ‘ä»¬çš„ç¬¬åæ‹¾ä¼ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”åŠŸæˆèº«é€€</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln">  1</span><span class="c1">; Socket</span>
<span class="ln">  2</span><span class="c1">; Compile with: nasm -f elf socket.asm</span>
<span class="ln">  3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 socket.o -o socket</span>
<span class="ln">  4</span><span class="c1">; Run with: ./socket</span>
<span class="ln">  5</span><span class="cp"> 
</span><span class="ln">  6</span><span class="cp">%include    &#39;functions.asm&#39;
</span><span class="ln">  7</span><span class="cp"></span> 
<span class="ln">  8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln">  9</span><span class="c1">; our response string</span>
<span class="ln"> 10</span><span class="nf">response</span> <span class="nv">db</span> <span class="s">&#39;HTTP/1.1 200 OK&#39;</span><span class="p">,</span> <span class="mh">0Dh</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="s">&#39;Content-Type: text/html&#39;</span><span class="p">,</span> <span class="mh">0Dh</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="s">&#39;Content-Length: 14&#39;</span><span class="p">,</span> <span class="mh">0Dh</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="mh">0Dh</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="s">&#39;Hello World!&#39;</span><span class="p">,</span> <span class="mh">0Dh</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="mh">0h</span>
<span class="ln"> 11</span> 
<span class="ln"> 12</span><span class="k">SECTION</span> <span class="nv">.bss</span>
<span class="ln"> 13</span><span class="nf">buffer</span> <span class="nv">resb</span> <span class="mi">255</span><span class="p">,</span>                <span class="c1">; variable to store request headers</span>
<span class="ln"> 14</span> 
<span class="ln"> 15</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln"> 16</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln"> 17</span> 
<span class="ln"> 18</span><span class="nl">_start:</span>
<span class="ln"> 19</span> 
<span class="ln"> 20</span>    <span class="nf">xor</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; initialize some registers</span>
<span class="ln"> 21</span>    <span class="nf">xor</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">ebx</span>
<span class="ln"> 22</span>    <span class="nf">xor</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">edi</span>
<span class="ln"> 23</span>    <span class="nf">xor</span>     <span class="nb">esi</span><span class="p">,</span> <span class="nb">esi</span>
<span class="ln"> 24</span> 
<span class="ln"> 25</span><span class="nl">_socket:</span>
<span class="ln"> 26</span> 
<span class="ln"> 27</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">6</span>              <span class="c1">; create socket from lesson 29</span>
<span class="ln"> 28</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">1</span>
<span class="ln"> 29</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">2</span>
<span class="ln"> 30</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln"> 31</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>
<span class="ln"> 32</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln"> 33</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln"> 34</span> 
<span class="ln"> 35</span><span class="nl">_bind:</span>
<span class="ln"> 36</span> 
<span class="ln"> 37</span>    <span class="nf">mov</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; bind socket from lesson 30</span>
<span class="ln"> 38</span>    <span class="nf">push</span>    <span class="kt">dword</span> <span class="mh">0x00000000</span>
<span class="ln"> 39</span>    <span class="nf">push</span>    <span class="kt">word</span> <span class="mh">0x2923</span>
<span class="ln"> 40</span>    <span class="nf">push</span>    <span class="kt">word</span> <span class="mi">2</span>
<span class="ln"> 41</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln"> 42</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">16</span>
<span class="ln"> 43</span>    <span class="nf">push</span>    <span class="nb">ecx</span>
<span class="ln"> 44</span>    <span class="nf">push</span>    <span class="nb">edi</span>
<span class="ln"> 45</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln"> 46</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">2</span>
<span class="ln"> 47</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln"> 48</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln"> 49</span> 
<span class="ln"> 50</span><span class="nl">_listen:</span>
<span class="ln"> 51</span> 
<span class="ln"> 52</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">1</span>              <span class="c1">; listen socket from lesson 31</span>
<span class="ln"> 53</span>    <span class="nf">push</span>    <span class="nb">edi</span>
<span class="ln"> 54</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln"> 55</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">4</span>
<span class="ln"> 56</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln"> 57</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln"> 58</span> 
<span class="ln"> 59</span><span class="nl">_accept:</span>
<span class="ln"> 60</span> 
<span class="ln"> 61</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">0</span>              <span class="c1">; accept socket from lesson 32</span>
<span class="ln"> 62</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">0</span>
<span class="ln"> 63</span>    <span class="nf">push</span>    <span class="nb">edi</span>
<span class="ln"> 64</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
<span class="ln"> 65</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">5</span>
<span class="ln"> 66</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>
<span class="ln"> 67</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln"> 68</span> 
<span class="ln"> 69</span><span class="nl">_fork:</span>
<span class="ln"> 70</span> 
<span class="ln"> 71</span>    <span class="nf">mov</span>     <span class="nb">esi</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; fork socket from lesson 33</span>
<span class="ln"> 72</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">2</span>
<span class="ln"> 73</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln"> 74</span> 
<span class="ln"> 75</span>    <span class="nf">cmp</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="ln"> 76</span>    <span class="nf">jz</span>      <span class="nv">_read</span>
<span class="ln"> 77</span> 
<span class="ln"> 78</span>    <span class="nf">jmp</span>     <span class="nv">_accept</span>
<span class="ln"> 79</span> 
<span class="ln"> 80</span><span class="nl">_read:</span>
<span class="ln"> 81</span> 
<span class="ln"> 82</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">255</span>            <span class="c1">; read socket from lesson 33</span>
<span class="ln"> 83</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">buffer</span>
<span class="ln"> 84</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">esi</span>
<span class="ln"> 85</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">3</span>
<span class="ln"> 86</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln"> 87</span> 
<span class="ln"> 88</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">buffer</span>
<span class="ln"> 89</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rintLF</span>
<span class="ln"> 90</span> 
<span class="ln"> 91</span><span class="nl">_write:</span>
<span class="ln"> 92</span> 
<span class="ln"> 93</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">78</span>             <span class="c1">; write socket from lesson 34</span>
<span class="ln"> 94</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">response</span>
<span class="ln"> 95</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">esi</span>
<span class="ln"> 96</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>
<span class="ln"> 97</span>    <span class="nf">int</span>     <span class="mh">80h</span>
<span class="ln"> 98</span> 
<span class="ln"> 99</span><span class="nl">_close:</span>
<span class="ln">100</span> 
<span class="ln">101</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">esi</span>            <span class="c1">; move esi into ebx (accepted socket file descriptor)</span>
<span class="ln">102</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">6</span>              <span class="c1">; invoke SYS_CLOSE (kernel opcode 6)</span>
<span class="ln">103</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">104</span> 
<span class="ln">105</span><span class="nl">_exit:</span>
<span class="ln">106</span> 
<span class="ln">107</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ nasm -f elf socket.asm
<span class="ln">2</span>$ ld -m elf_i386 socket.o -o socket
<span class="ln">3</span>$ ./socket
</code></pre></div><p>åŒæ ·ï¼Œå†å¦ä¸€ä¸ªç»ˆç«¯çª—å£ä¸­</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ curl http://localhost:9001
<span class="ln">2</span>Hello World!
</code></pre></div><hr>
<h2 id="lesson-36-å¥—æ¥å­—ä¸‹è½½ç½‘é¡µ">Lesson 36 å¥—æ¥å­—â€”â€”ä¸‹è½½ç½‘é¡µ</h2>
<p>å‰é¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬è§è¯†äº†<code>sys_socketcall</code>çš„ä¼—å¤šå­ä¾‹ç¨‹æ˜¯å¦‚ä½•åˆ›å»ºã€ç®¡ç† Linux å¥—æ¥å­—å¹¶åœ¨å…¶ä¸­ä¼ è¾“æ•°æ®çš„ï¼Œä¸»è¦é›†ä¸­åœ¨æœåŠ¡ç«¯ç¨‹åºã€‚æ¥ä¸‹æ¥ï¼Œä»å®¢æˆ·ç«¯çš„è§’åº¦ï¼Œä½¿ç”¨<code>connect</code>å­ä¾‹ç¨‹æ¥æ¼”ç¤ºâ€”â€”ä»è¿œç«¯ä¸‹è½½ç½‘é¡µã€‚</p>
<p>æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>é¦–å…ˆè°ƒç”¨<code>sys_socketcall</code>çš„<code>socket</code>å­ä¾‹ç¨‹åˆ›å»ºå¥—æ¥å­—ï¼Œç”¨æ¥å°†è¯·æ±‚å‘é€åˆ°è¿œç«¯</li>
<li>ç„¶åè°ƒç”¨<code>sys_socketcall</code>çš„<code>connect</code>å­ä¾‹ç¨‹å°†åˆšåˆ›å»ºçš„å¥—æ¥å­—è¿åˆ°è¿œç¨‹ Web æœåŠ¡å™¨</li>
<li>ä¹‹åè°ƒç”¨<code>sys_write</code>å‘é€<code>HTTP</code>æ ¼å¼çš„è¯·æ±‚</li>
<li>æ¥ç€è°ƒç”¨<code>sys_read</code>æ¥æ”¶æ¥è‡ª Web æœåŠ¡å™¨çš„<code>HTTP</code>æ ¼å¼å“åº”</li>
</ul>
<p>æœåŠ¡å™¨è¿”å›çš„å“åº”å†…å®¹ï¼Œè‡ªç„¶ç”±æˆ‘ä»¬çš„å­—ç¬¦ä¸²æ‰“å°å‡½æ•°ä»£åŠ³è¾“å‡ºåˆ°ç»ˆç«¯ä¸Šã€‚</p>
<p><strong>ç®€å•ä»‹ç»ä¸‹ HTTP è¯·æ±‚</strong></p>
<p>HTTP è§„èŒƒæ¶‰åŠå¤šä¸ªç‰ˆæœ¬çš„æ ‡å‡†ï¼š<a href="https://tools.ietf.org/html/rfc1945">1.0 in RFC1945</a>ï¼Œ<a href="https://tools.ietf.org/html/rfc2068">1.1 in RFC2068</a> ä»¥åŠ <a href="https://tools.ietf.org/html/rfc7540">2.0 in RFC7540</a>ã€‚1.1 ç‰ˆæœ¬æ—¶è‡³ä»Šæ—¥ä¾ç„¶æ˜¯ä¸»æµã€‚</p>
<p>ä¸€ä¸ª HTTP è¯·æ±‚åŒ…å« 3 ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>ä¸€ä¸ªåŒ…å«<code>è¯·æ±‚æ–¹æ³•</code>ã€<code>è¯·æ±‚ URL</code>å’Œ<code>åè®®ç‰ˆæœ¬</code>çš„è¡Œ</li>
<li>å¯é€‰çš„<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers">è¯·æ±‚å¤´</a>éƒ¨åˆ†</li>
<li>ä¸€ä¸ªç©ºè¡Œï¼Œç”¨ä»¥å‘ŠçŸ¥æœåŠ¡å™¨è¯·æ±‚æ–¹ä»¥å®Œæˆè¯·æ±‚å¹¶ç­‰å¾…æœåŠ¡å™¨å“åº”</li>
</ol>
<p>ä¸€ä¸ªå…¸å‹çš„åˆ°æ ¹æ–‡æ¡£çš„ HTTP è¯·æ±‚ä¸€èˆ¬é•¿è¿™æ ·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>GET / HTTP/1.1                  <span class="p">;</span> A line containing the request method, url and version
<span class="ln">2</span>Host: asmtutor.com              <span class="p">;</span> A section of request headers
<span class="ln">3</span>                                <span class="p">;</span> A required empty line
</code></pre></div><p>æœ¬èŠ‚çš„ç¨‹åºä¸ä¸Šä¸€èŠ‚çš„ç¨‹åºæ‹¥æœ‰ç›¸ä¼¼çš„å¼€å¤´éƒ¨åˆ†ï¼Œä½†ä½œä¸ºå®¢æˆ·ç«¯çš„æˆ‘ä»¬ï¼Œä¸éœ€è¦è°ƒç”¨<code>bind</code>ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯è°ƒç”¨<code>connect</code>ï¼Œè¿æ¥åˆ°æŒ‡å®š IP åœ°å€å’Œç«¯å£çš„è¿œç¨‹ Web æœåŠ¡å™¨ã€‚ç„¶åä½¿ç”¨<code>sys_write</code>å’Œ<code>sys_read</code>åœ¨ä¸¤ä¸ªå¥—æ¥å­—ä¹‹é—´é€šè¿‡<code>HTTPè¯·æ±‚</code>å’Œ<code>HTTPå“åº”</code>æ¥ä¼ è¾“æ•°æ®ã€‚</p>
<p><code>sys_socketcall</code>çš„å­ä¾‹ç¨‹<code>connect</code>æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>å‚æ•°æ•°ç»„çš„æŒ‡é’ˆç”±<code>ECX</code>ä¿å­˜</li>
<li>æ•´æ•° 3 ç”±<code>EBX</code>ä¿å­˜</li>
</ul>
<p>OPCODE 102 è½½å…¥<code>EAX</code>ï¼Œ<code>INT 80h</code> å¼€è°ƒã€‚</p>

<div class="notices tip">
    <div class="label">æç¤º</div>
    <p>æç¤ºï¼šä¸ºé¿å…è¿”å›çš„å†…å®¹è¿‡å¤šè€Œå……æ–¥å±å¹•ï¼Œå¯åœ¨è¿è¡Œç¨‹åºæ—¶ä½¿ç”¨è¾“å‡ºé‡å®šå‘<code>./crawler &gt; index.html</code>æ¥ä¿å­˜æœåŠ¡å™¨å“åº”åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç›´æ¥è¾“å‡ºåˆ°ç»ˆç«¯ä¸Šã€‚</p>

  </div>

<h3 id="æˆ‘ä»¬çš„é›†å¤§æˆçš„ç¬¬åæ‹¾é™†ä¸ªæ±‡ç¼–ç¨‹åºç™¾å·æœæµ·">æˆ‘ä»¬çš„é›†å¤§æˆçš„ç¬¬åæ‹¾é™†ä¸ªæ±‡ç¼–ç¨‹åºâ€”â€”ç™¾å·æœæµ·</h3>
<p>functions.asm ç•¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nasm" data-lang="nasm"><span class="ln"> 1</span><span class="c1">; Crawler</span>
<span class="ln"> 2</span><span class="c1">; Compile with: nasm -f elf crawler.asm</span>
<span class="ln"> 3</span><span class="c1">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 crawler.o -o crawler</span>
<span class="ln"> 4</span><span class="c1">; Run with: ./crawler</span>
<span class="ln"> 5</span><span class="cp"> 
</span><span class="ln"> 6</span><span class="cp">%include    &#39;functions.asm&#39;
</span><span class="ln"> 7</span><span class="cp"></span> 
<span class="ln"> 8</span><span class="k">SECTION</span> <span class="nv">.data</span>
<span class="ln"> 9</span><span class="c1">; our request string</span>
<span class="ln">10</span><span class="nf">request</span> <span class="nv">db</span> <span class="s">&#39;GET / HTTP/1.1&#39;</span><span class="p">,</span> <span class="mh">0Dh</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="s">&#39;Host: 139.162.39.66:80&#39;</span><span class="p">,</span> <span class="mh">0Dh</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="mh">0Dh</span><span class="p">,</span> <span class="mh">0Ah</span><span class="p">,</span> <span class="mh">0h</span>
<span class="ln">11</span> 
<span class="ln">12</span><span class="k">SECTION</span> <span class="nv">.bss</span>
<span class="ln">13</span><span class="nf">buffer</span> <span class="nv">resb</span> <span class="mi">1</span><span class="p">,</span>                  <span class="c1">; variable to store response</span>
<span class="ln">14</span> 
<span class="ln">15</span><span class="k">SECTION</span> <span class="nv">.text</span>
<span class="ln">16</span><span class="k">global</span>  <span class="nv">_start</span>
<span class="ln">17</span> 
<span class="ln">18</span><span class="nl">_start:</span>
<span class="ln">19</span> 
<span class="ln">20</span>    <span class="nf">xor</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; init eax 0</span>
<span class="ln">21</span>    <span class="nf">xor</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">ebx</span>            <span class="c1">; init ebx 0</span>
<span class="ln">22</span>    <span class="nf">xor</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">edi</span>            <span class="c1">; init edi 0</span>
<span class="ln">23</span> 
<span class="ln">24</span><span class="nl">_socket:</span>
<span class="ln">25</span> 
<span class="ln">26</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">6</span>              <span class="c1">; push 6 onto the stack (IPPROTO_TCP)</span>
<span class="ln">27</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">1</span>              <span class="c1">; push 1 onto the stack (SOCK_STREAM)</span>
<span class="ln">28</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">2</span>              <span class="c1">; push 2 onto the stack (PF_INET)</span>
<span class="ln">29</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>            <span class="c1">; move address of arguments into ecx</span>
<span class="ln">30</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">1</span>              <span class="c1">; invoke subroutine SOCKET (1)</span>
<span class="ln">31</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>            <span class="c1">; invoke SYS_SOCKETCALL (kernel opcode 102)</span>
<span class="ln">32</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">33</span> 
<span class="ln">34</span><span class="nl">_connect:</span>
<span class="ln">35</span> 
<span class="ln">36</span>    <span class="nf">mov</span>     <span class="nb">edi</span><span class="p">,</span> <span class="nb">eax</span>            <span class="c1">; move return value of SYS_SOCKETCALL into edi (file descriptor for new socket, or -1 on error)</span>
<span class="ln">37</span>    <span class="nf">push</span>    <span class="kt">dword</span> <span class="mh">0x4227a28b</span>    <span class="c1">; push 139.162.39.66 onto the stack IP ADDRESS (reverse byte order)</span>
<span class="ln">38</span>    <span class="nf">push</span>    <span class="kt">word</span> <span class="mh">0x5000</span>         <span class="c1">; push 80 onto stack PORT (reverse byte order)</span>
<span class="ln">39</span>    <span class="nf">push</span>    <span class="kt">word</span> <span class="mi">2</span>              <span class="c1">; push 2 dec onto stack AF_INET</span>
<span class="ln">40</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>            <span class="c1">; move address of stack pointer into ecx</span>
<span class="ln">41</span>    <span class="nf">push</span>    <span class="kt">byte</span> <span class="mi">16</span>             <span class="c1">; push 16 dec onto stack (arguments length)</span>
<span class="ln">42</span>    <span class="nf">push</span>    <span class="nb">ecx</span>                 <span class="c1">; push the address of arguments onto stack</span>
<span class="ln">43</span>    <span class="nf">push</span>    <span class="nb">edi</span>                 <span class="c1">; push the file descriptor onto stack</span>
<span class="ln">44</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>            <span class="c1">; move address of arguments into ecx</span>
<span class="ln">45</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="mi">3</span>              <span class="c1">; invoke subroutine CONNECT (3)</span>
<span class="ln">46</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">102</span>            <span class="c1">; invoke SYS_SOCKETCALL (kernel opcode 102)</span>
<span class="ln">47</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">48</span> 
<span class="ln">49</span><span class="nl">_write:</span>
<span class="ln">50</span> 
<span class="ln">51</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">43</span>             <span class="c1">; move 43 dec into edx (length in bytes to write)</span>
<span class="ln">52</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">request</span>        <span class="c1">; move address of our request variable into ecx</span>
<span class="ln">53</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">edi</span>            <span class="c1">; move file descriptor into ebx (created socket file descriptor)</span>
<span class="ln">54</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">4</span>              <span class="c1">; invoke SYS_WRITE (kernel opcode 4)</span>
<span class="ln">55</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">56</span> 
<span class="ln">57</span><span class="nl">_read:</span>
<span class="ln">58</span> 
<span class="ln">59</span>    <span class="nf">mov</span>     <span class="nb">edx</span><span class="p">,</span> <span class="mi">1</span>              <span class="c1">; number of bytes to read (we will read 1 byte at a time)</span>
<span class="ln">60</span>    <span class="nf">mov</span>     <span class="nb">ecx</span><span class="p">,</span> <span class="nv">buffer</span>         <span class="c1">; move the memory address of our buffer variable into ecx</span>
<span class="ln">61</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">edi</span>            <span class="c1">; move edi into ebx (created socket file descriptor)</span>
<span class="ln">62</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">3</span>              <span class="c1">; invoke SYS_READ (kernel opcode 3)</span>
<span class="ln">63</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">64</span> 
<span class="ln">65</span>    <span class="nf">cmp</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">0</span>              <span class="c1">; if return value of SYS_READ in eax is zero, we have reached the end of the file</span>
<span class="ln">66</span>    <span class="nf">jz</span>      <span class="nv">_close</span>              <span class="c1">; jmp to _close if we have reached the end of the file (zero flag set)</span>
<span class="ln">67</span> 
<span class="ln">68</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="nv">buffer</span>         <span class="c1">; move the memory address of our buffer variable into eax for printing</span>
<span class="ln">69</span>    <span class="nf">call</span>    <span class="nb">sp</span><span class="nv">rint</span>              <span class="c1">; call our string printing function</span>
<span class="ln">70</span>    <span class="nf">jmp</span>     <span class="nv">_read</span>               <span class="c1">; jmp to _read</span>
<span class="ln">71</span> 
<span class="ln">72</span><span class="nl">_close:</span>
<span class="ln">73</span> 
<span class="ln">74</span>    <span class="nf">mov</span>     <span class="nb">ebx</span><span class="p">,</span> <span class="nb">edi</span>            <span class="c1">; move edi into ebx (connected socket file descriptor)</span>
<span class="ln">75</span>    <span class="nf">mov</span>     <span class="nb">eax</span><span class="p">,</span> <span class="mi">6</span>              <span class="c1">; invoke SYS_CLOSE (kernel opcode 6)</span>
<span class="ln">76</span>    <span class="nf">int</span>     <span class="mh">80h</span>                 <span class="c1">; call the kernel</span>
<span class="ln">77</span> 
<span class="ln">78</span><span class="nl">_exit:</span>
<span class="ln">79</span> 
<span class="ln">80</span>    <span class="nf">call</span>    <span class="nv">quit</span>                <span class="c1">; call our quit function</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln"> 1</span>$ nasm -f elf crawler.asm
<span class="ln"> 2</span>$ ld -m elf_i386 crawler.o -o crawler
<span class="ln"> 3</span>$ ./crawler
<span class="ln"> 4</span>HTTP/1.1 <span class="m">200</span> OK
<span class="ln"> 5</span>Content-Type: text/html
<span class="ln"> 6</span> 
<span class="ln"> 7</span>&lt;!DOCTYPE html&gt;
<span class="ln"> 8</span>&lt;html <span class="nv">lang</span><span class="o">=</span><span class="s2">&#34;en&#34;</span>&gt;
<span class="ln"> 9</span>...
<span class="ln">10</span>&lt;/html&gt;
</code></pre></div><p>$$
The\ End.
$$</p>
<hr>
<p>æœ¬æ–‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/">çŸ¥è¯†å…±äº«ç½²åè®¸å¯åè®®ï¼ˆCC-BY 4.0ï¼‰</a>è¿›è¡Œè®¸å¯ï¼Œè½¬è½½æ³¨æ˜æ¥æºå³å¯ã€‚å¦‚æœ‰é”™è¯¯åŠ³çƒ¦è¯„è®ºæˆ–é‚®ä»¶æŒ‡å‡ºã€‚<img src="/images/site/CC-BY_icon.svg" alt=""></p>
<hr>
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "newlooper" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  </article>
<aside class="sidebar">
  <section class="sidebar_inner">
        <h2>Dylan Cheng</h2>
      <div class="author_bio">
        ç¨‹åºå‘˜ï¼Œç¾é£Ÿ|æ›²è‰º|æ£‹ç‰Œçˆ±å¥½è€…
      </div>
      <a href='/about/' class="button mt-1" role="button" title='é˜…è¯»æ›´å¤š'>é˜…è¯»æ›´å¤š</a>
    <h2 class="mt-4">ç²¾é€‰æ–‡ç« </h2>
    <ul>
      <li>
        <a href="/post/original/cs/io/eof/" class="nav-link" title="EOFï¼Œåˆ°åº•æ€ä¹ˆå›äº‹">EOFï¼Œåˆ°åº•æ€ä¹ˆå›äº‹</a>
      </li>
    </ul>
    <h2 class="mt-4">æœ€æ–°æ–‡ç« </h2>
    <ul class="flex-column">
      <li>
        <a href="/post/original/cs/blog/hugowithstaticman/" class="nav-link" title="Hugo æ·»åŠ  Staticman è¯„è®ºåŠŸèƒ½">Hugo æ·»åŠ  Staticman è¯„è®ºåŠŸèƒ½</a>
      </li>
      <li>
        <a href="/post/original/cs/io/eof/" class="nav-link" title="EOFï¼Œåˆ°åº•æ€ä¹ˆå›äº‹">EOFï¼Œåˆ°åº•æ€ä¹ˆå›äº‹</a>
      </li>
      <li>
        <a href="/post/original/cs/vm/wsl/migrate_distributions/" class="nav-link" title="WSL2 è¿ç§» Linux å‘è¡Œç‰ˆ">WSL2 è¿ç§» Linux å‘è¡Œç‰ˆ</a>
      </li>
      <li>
        <a href="/post/original/cs/os/memory/memory_paging/" class="nav-link" title="åˆ†é¡µå†…å­˜åœ°å€è½¬æ¢ç‚¹æ»´">åˆ†é¡µå†…å­˜åœ°å€è½¬æ¢ç‚¹æ»´</a>
      </li>
      <li>
        <a href="/post/trans/cs/editor/ed/" class="nav-link" title="The GNU ed line editor [è¯‘]">The GNU ed line editor [è¯‘]</a>
      </li>
      <li>
        <a href="/post/original/gitlab/docker_smtp/" class="nav-link" title="GitLab on Docker é…ç½® SMTP æœåŠ¡">GitLab on Docker é…ç½® SMTP æœåŠ¡</a>
      </li>
      <li>
        <a href="/post/original/cs/math/permutation/" class="nav-link" title="é‚»ä½å¯¹æ¢æ³•ç”Ÿæˆå…¨æ’åˆ—">é‚»ä½å¯¹æ¢æ³•ç”Ÿæˆå…¨æ’åˆ—</a>
      </li>
    </ul>
    <div>
      <h2 class="mt-4 taxonomy" id="categories-section">åˆ†ç±»</h2>
      <nav class="tags_nav">
        <a href='/categories/concept/' class="post_tag button button_translucent" title="concept">
          CONCEPT
          <span class="button_tally">2</span>
        </a>
        
        <a href='/categories/tricks/' class="post_tag button button_translucent" title="tricks">
          TRICKS
          <span class="button_tally">2</span>
        </a>
        
        <a href='/categories/manual/' class="post_tag button button_translucent" title="manual">
          MANUAL
          <span class="button_tally">1</span>
        </a>
        
        <a href='/categories/theory/' class="post_tag button button_translucent" title="theory">
          THEORY
          <span class="button_tally">1</span>
        </a>
        
        <a href='/categories/translation/' class="post_tag button button_translucent" title="translation">
          TRANSLATION
          <span class="button_tally">1</span>
        </a>
        
        <a href='/categories/tutorial/' class="post_tag button button_translucent" title="tutorial">
          TUTORIAL
          <span class="button_tally">1</span>
        </a>
        
        
      </nav>
    </div>
    <div>
      <h2 class="mt-4 taxonomy" id="tags-section">æ ‡ç­¾</h2>
      <nav class="tags_nav">
        <a href='/tags/programming/' class="post_tag button button_translucent" title="programming">
          PROGRAMMING
          <span class="button_tally">3</span>
        </a>
        
        <a href='/tags/vm/' class="post_tag button button_translucent" title="vm">
          VM
          <span class="button_tally">2</span>
        </a>
        
        <a href='/tags/algorithm/' class="post_tag button button_translucent" title="algorithm">
          ALGORITHM
          <span class="button_tally">1</span>
        </a>
        
        <a href='/tags/assembly-language/' class="post_tag button button_translucent" title="assembly-language">
          ASSEMBLY-LANGUAGE
          <span class="button_tally">1</span>
        </a>
        
        <a href='/tags/docker/' class="post_tag button button_translucent" title="docker">
          DOCKER
          <span class="button_tally">1</span>
        </a>
        
        <a href='/tags/editor/' class="post_tag button button_translucent" title="editor">
          EDITOR
          <span class="button_tally">1</span>
        </a>
        
        <a href='/tags/eof/' class="post_tag button button_translucent" title="eof">
          EOF
          <span class="button_tally">1</span>
        </a>
        
        <a href='/tags/github/' class="post_tag button button_translucent" title="github">
          GITHUB
          <span class="button_tally">1</span>
        </a>
        
        <a href='/tags/gitlab/' class="post_tag button button_translucent" title="gitlab">
          GITLAB
          <span class="button_tally">1</span>
        </a>
        
        <a href='/tags/heroku/' class="post_tag button button_translucent" title="heroku">
          HEROKU
          <span class="button_tally">1</span>
        </a>
        
        <a href='/tags/hugo/' class="post_tag button button_translucent" title="hugo">
          HUGO
          <span class="button_tally">1</span>
        </a>
        
        <a href='/tags/math/' class="post_tag button button_translucent" title="math">
          MATH
          <span class="button_tally">1</span>
        </a>
        
        <a href='/tags/memory/' class="post_tag button button_translucent" title="memory">
          MEMORY
          <span class="button_tally">1</span>
        </a>
        
        <a href='/tags/nasm/' class="post_tag button button_translucent" title="nasm">
          NASM
          <span class="button_tally">1</span>
        </a>
        
        
        <br>
        <div class="post_tags_toggle button">æ‰€æœ‰æ ‡ç­¾</div>
        <div class="post_tags">
          <div class="tags_list">
            
            <a href='/tags/algorithm/' class=" post_tag button button_translucent" data-position=1 title="algorithm">ALGORITHM<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/assembly-language/' class=" post_tag button button_translucent" data-position=1 title="assembly-language">ASSEMBLY-LANGUAGE<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/docker/' class=" post_tag button button_translucent" data-position=1 title="docker">DOCKER<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/editor/' class=" post_tag button button_translucent" data-position=1 title="editor">EDITOR<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/eof/' class=" post_tag button button_translucent" data-position=1 title="eof">EOF<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/github/' class=" post_tag button button_translucent" data-position=1 title="github">GITHUB<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/gitlab/' class=" post_tag button button_translucent" data-position=1 title="gitlab">GITLAB<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/heroku/' class=" post_tag button button_translucent" data-position=1 title="heroku">HEROKU<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/hugo/' class=" post_tag button button_translucent" data-position=1 title="hugo">HUGO<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/math/' class=" post_tag button button_translucent" data-position=1 title="math">MATH<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/memory/' class=" post_tag button button_translucent" data-position=1 title="memory">MEMORY<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/nasm/' class=" post_tag button button_translucent" data-position=1 title="nasm">NASM<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/netlify/' class=" post_tag button button_translucent" data-position=1 title="netlify">NETLIFY<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/os/' class=" post_tag button button_translucent" data-position=1 title="os">OS<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/programming/' class=" post_tag button button_translucent" data-position=3 title="programming">PROGRAMMING<span class="button_tally">3</span>
            </a>
            
            
            <a href='/tags/smtp/' class=" post_tag button button_translucent" data-position=1 title="smtp">SMTP<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/staticman/' class=" post_tag button button_translucent" data-position=1 title="staticman">STATICMAN<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/terminal/' class=" post_tag button button_translucent" data-position=1 title="terminal">TERMINAL<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/unix/' class=" post_tag button button_translucent" data-position=1 title="unix">UNIX<span class="button_tally">1</span>
            </a>
            
            
            <a href='/tags/vm/' class=" post_tag button button_translucent" data-position=2 title="vm">VM<span class="button_tally">2</span>
            </a>
            
            
            <a href='/tags/wsl/' class=" post_tag button button_translucent" data-position=1 title="wsl">WSL<span class="button_tally">1</span>
            </a>
            
            <div class="tags_sort"><span title="sort alphabetically">[A~Z]</span><span title="sort by count">[0~9]</span>
            </div>
            <span class="tags_hide"><svg class="icon">
            <use xlink:href="#closeme"></use>
          </svg></span>
          </div>
        </div>
      </nav>
    </div>
  </section>

<nav class="toc hide-on-mobile section-nav">
<h3 class="ml-1">Table of contents</h3>
<nav id="TableOfContents">
  <ul>
    <li><a href="#index-0">Index-0</a></li>
    <li><a href="#tldr">TL;DR</a></li>
    <li><a href="#lesson-1-hello-world">Lesson 1 Hello, world!</a></li>
    <li><a href="#lesson-2-ç¨‹åºé€€å‡ºçš„æ­£ç¡®å§¿åŠ¿">Lesson 2 ç¨‹åºé€€å‡ºçš„æ­£ç¡®å§¿åŠ¿</a></li>
    <li><a href="#lesson-3-è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦">Lesson 3 è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦</a></li>
    <li><a href="#lesson-4-å­ä¾‹ç¨‹">Lesson 4 å­ä¾‹ç¨‹</a></li>
    <li><a href="#lesson-5-å¤–éƒ¨åŒ…å«æ–‡ä»¶">Lesson 5 å¤–éƒ¨åŒ…å«æ–‡ä»¶</a></li>
    <li><a href="#lesson-6-null-ç»ˆæ­¢ç¬¦">Lesson 6 NULL ç»ˆæ­¢ç¬¦</a></li>
    <li><a href="#lesson-7-æ¢è¡Œ">Lesson 7 æ¢è¡Œ</a></li>
    <li><a href="#lesson-8-å‘½ä»¤è¡Œå‚æ•°">Lesson 8 å‘½ä»¤è¡Œå‚æ•°</a></li>
    <li><a href="#lesson-9-å¤„ç†ç”¨æˆ·è¾“å‡º">Lesson 9 å¤„ç†ç”¨æˆ·è¾“å‡º</a></li>
    <li><a href="#lesson-10-æ•°åˆ°å">Lesson 10 æ•°åˆ°å</a></li>
    <li><a href="#lesson-11-æ•°åˆ°å-itoa">Lesson 11 æ•°åˆ°å (itoa)</a></li>
    <li><a href="#lesson-12-è®¡ç®—åŠ æ³•">Lesson 12 è®¡ç®—â€”â€”åŠ æ³•</a></li>
    <li><a href="#lesson-13-è®¡ç®—å‡æ³•">Lesson 13 è®¡ç®—â€”â€”å‡æ³•</a></li>
    <li><a href="#lesson-14-è®¡ç®—ä¹˜æ³•">Lesson 14 è®¡ç®—â€”â€”ä¹˜æ³•</a></li>
    <li><a href="#lesson-15-è®¡ç®—é™¤æ³•">Lesson 15 è®¡ç®—â€”â€”é™¤æ³•</a></li>
    <li><a href="#lesson-16-è®¡ç®—atoi">Lesson 16 è®¡ç®—â€”â€”atoi</a></li>
    <li><a href="#lesson-17-å‘½åç©ºé—´">Lesson 17 å‘½åç©ºé—´</a></li>
    <li><a href="#lesson-18-fizzbuzz-æ¸¸æˆ">Lesson 18 FizzBuzz æ¸¸æˆ</a></li>
    <li><a href="#lesson-19-æ‰§è¡Œå‘½ä»¤">Lesson 19 æ‰§è¡Œå‘½ä»¤</a></li>
    <li><a href="#lesson-20-process-forking">Lesson 20 Process Forking</a></li>
    <li><a href="#lesson-21-è¾“å‡ºæ—¶é—´">Lesson 21 è¾“å‡ºæ—¶é—´</a></li>
    <li><a href="#lesson-22-æ–‡ä»¶æ“ä½œcreate">Lesson 22 æ–‡ä»¶æ“ä½œâ€”â€”Create</a></li>
    <li><a href="#lesson-23-æ–‡ä»¶æ“ä½œwrite">Lesson 23 æ–‡ä»¶æ“ä½œâ€”â€”Write</a></li>
    <li><a href="#lesson-24-æ–‡ä»¶æ“ä½œopen">Lesson 24 æ–‡ä»¶æ“ä½œâ€”â€”Open</a></li>
    <li><a href="#lesson-25-æ–‡ä»¶æ“ä½œread">Lesson 25 æ–‡ä»¶æ“ä½œâ€”â€”Read</a></li>
    <li><a href="#lesson-26-æ–‡ä»¶æ“ä½œclose">Lesson 26 æ–‡ä»¶æ“ä½œâ€”â€”Close</a></li>
    <li><a href="#lesson-27-æ–‡ä»¶æ“ä½œseek">Lesson 27 æ–‡ä»¶æ“ä½œâ€”â€”Seek</a></li>
    <li><a href="#lesson-28-æ–‡ä»¶æ“ä½œdelete">Lesson 28 æ–‡ä»¶æ“ä½œâ€”â€”Delete</a></li>
    <li><a href="#lesson-29-å¥—æ¥å­—create">Lesson 29 å¥—æ¥å­—â€”â€”Create</a></li>
    <li><a href="#lesson-30-å¥—æ¥å­—bind">Lesson 30 å¥—æ¥å­—â€”â€”Bind</a></li>
    <li><a href="#lesson-31-å¥—æ¥å­—listen">Lesson 31 å¥—æ¥å­—â€”â€”Listen</a></li>
    <li><a href="#lesson-32-å¥—æ¥å­—accept">Lesson 32 å¥—æ¥å­—â€”â€”Accept</a></li>
    <li><a href="#lesson-33-å¥—æ¥å­—read">Lesson 33 å¥—æ¥å­—â€”â€”Read</a></li>
    <li><a href="#lesson-34-å¥—æ¥å­—write">Lesson 34 å¥—æ¥å­—â€”â€”Write</a></li>
    <li><a href="#lesson-35-å¥—æ¥å­—close">Lesson 35 å¥—æ¥å­—â€”â€”Close</a></li>
    <li><a href="#lesson-36-å¥—æ¥å­—ä¸‹è½½ç½‘é¡µ">Lesson 36 å¥—æ¥å­—â€”â€”ä¸‹è½½ç½‘é¡µ</a></li>
  </ul>
</nav>

</nav>
</aside>

  
</div>
    </main><svg width="0" height="0" class="hidden">
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter">
    <path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68 0 0 1-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043 0-1.924.366-2.643 1.078a3.56 3.56 0 0 0-1.076 2.605c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846 0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47 0 .929.273 1.705.82 2.388a3.623 3.623 0 0 0 2.115 1.291c-.312.08-.641.118-.979.118-.312 0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652 0 0 0 2.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422 0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139 0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77 0 0 0 1.172-4.892v-.468a7.788 7.788 0 0 0 1.84-1.921 8.142 8.142 0 0 1-2.11.593z"
      ></path>
  </symbol>
  <symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail">
    <path  d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar">
    <path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916 0 100v352c0 33.084 26.916 60 60 60h392c33.084 0 60-26.916 60-60V100c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028 0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028 0 20 8.972 20 20v48z"></path>
    <path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github">
    <path d="M255.968 5.329C114.624 5.329 0 120.401 0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384 0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008 0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992 0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584 0 34.368-.32 62.08-.32 70.496 0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab">
    <path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6 0L12.3 74.8z" />
    <path d="M12.3 74.7L.5 111c-1 3.2 0 6.8 3 8.8l101.6 74-92.5-119z"/>
    <path d="M105 193.7l-38.6-119h-54l92.7 119z"/>
    <path d="M105 193.7l38.7-119H66.4l38.7 119z"/>
    <path d="M105 193.7l38.7-119H198l-93 119z"/>
    <path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/>
    <path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6 0L198 74.8z"/> 
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss">
    <circle cx="3.429" cy="20.571" r="3.429"></circle>
    <path d="M11.429 24h4.57C15.999 15.179 8.821 8.001 0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"></path>
    <path d="M24 24C24 10.766 13.234 0 0 0v4.571c10.714 0 19.43 8.714 19.43 19.429z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h362c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="arrow">
    <path d="M604.501 440.509L325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298 0 36.323s26.223 10.024 36.222 0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221 0 9.999-10.023 9.999-26.298 0-36.323z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly">
    <path d="M504.971 239.029L448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c19.851 0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002 0 0 0 400 320v108c0 19.851-16.149 36-36 36h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c46.318 0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568 0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255 0 24-10.745 24-24S205.255 0 192 0h-44c-46.318 0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568 0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255 0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851 0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002 0 0 0 112 192z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy">
    <path d="M23 2.75A2.75 2.75 0 0 0 20.25 0H8.75A2.75 2.75 0 0 0 6 2.75v13.5A2.75 2.75 0 0 0 8.75 19h11.5A2.75 2.75 0 0 0 23 16.25zM18.25 14.5h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5z"></path>
    <path d="M8.75 20.5a4.255 4.255 0 0 1-4.25-4.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752 0 0 0 1 5.25v16A2.752 2.752 0 0 0 3.75 24h12a2.752 2.752 0 0 0 2.75-2.75v-.75z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme">
    <path d="M284.286 256.002L506.143 34.144c7.811-7.811 7.811-20.475 0-28.285-7.811-7.81-20.475-7.811-28.285 0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285 0-7.81 7.811-7.811 20.475 0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475 0 28.285a19.938 19.938 0 0 0 14.143 5.857 19.94 19.94 0 0 0 14.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475 0-28.285L284.286 256.002z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu">
    <path d="M492 236H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954 0 96s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram">
    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id=youtube>
    <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow">
    <path d="M21 27v-8h3v11H0V19h3v8h18z"></path><path d="M17.1.2L15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8l13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"></path>
  </symbol>
</svg>


  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
				{left: "$$", right: "$$", display: true},
				{left: "\\[", right: "\\]", display: true},
				{left: "$", right: "$", display: false},
				{left: "\\(", right: "\\)", display: false}
          ],
          
          throwOnError : false
        });
    });
</script>
<footer class="footer">
  <div class="footer_inner wrap pale">
    <img src='/icons/copy.svg' class="icon icon_2 transparent" alt="Looper çš„åšå®¢">
    <p>Copyright&nbsp;<span class="year"></span>&nbsp;LOOPER çš„åšå®¢. All Rights Reserved</p><a class="to_top" href="#documentTop">
  <svg class="icon">
  <use xlink:href="#arrow"></use>
</svg>
</a>

  </div>
</footer>

    <script type="text/javascript" src="/js/bundle.min.14825dc619648aeca2e4e66c65ef7d06ea216e6a64cd503f64d2fe77950ee425c47fc0f2cf993c2d656f534914619a2c47c8313438a810ed5008db38a46a812d.js" integrity="sha512-FIJdxhlkiuyi5OZsZe99BuohbmpkzVA/ZNL&#43;d5UO5CXEf8Dyz5k8LWVvU0kUYZosR8gxNDioEO1QCNs4pGqBLQ==" crossorigin="anonymous"></script><script type="text/javascript" src="/js/custom.js" ></script>
    
  </body>
</html>
